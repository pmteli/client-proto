!function(){var e=window.d3plus||{};window.d3plus=e,e.version="1.2.3 - Royal",e.ie=!1,e.rtl="rtl"==d3.select("html").attr("dir"),e.prefix=function(){if("-webkit-transform"in document.body.style)var t="-webkit-";else if("-moz-transform"in document.body.style)var t="-moz-";else if("-ms-transform"in document.body.style)var t="-ms-";else if("-o-transform"in document.body.style)var t="-o-";else var t="";return e.prefix=function(){return t},t},e.scrollbar=function(){var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var a=document.createElement("div");a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.visibility="hidden",a.style.width="200px",a.style.height="150px",a.style.overflow="hidden",a.appendChild(t),document.body.appendChild(a);var l=t.offsetWidth;a.style.overflow="scroll";var s=t.offsetWidth;l==s&&(s=a.clientWidth),document.body.removeChild(a);var i=l-s;return e.scrollbar=function(){return i},i},d3.select(window).on("load.d3plus_scrollbar",function(){e.prefix(),e.scrollbar()}),e.evt={},e.touch=window.Modernizr&&Modernizr.touch,e.touch?(e.evt.click="click",e.evt.down="touchstart",e.evt.up="touchend",e.evt.over="touchstart",e.evt.out="touchend",e.evt.move="touchmove"):(e.evt.click="click",e.evt.down="mousedown",e.evt.up="mouseup",e.ie?(e.evt.over="mouseenter",e.evt.out="mouseleave"):(e.evt.over="mouseover",e.evt.out="mouseout"),e.evt.move="mousemove"),e.apps={},e.color={},e.data={},e.draw={},e.font={},e.forms={},e.ui={},e.shape={},e.styles={},e.tooltip={},e.util={},e.variable={},e.zoom={},e.console={},e.console.print=function(t,a,l){e.ie?console.log("[d3plus] "+a):console[t]("%c[d3plus]%c "+a,"font-weight:bold;",l)},e.console.log=function(t,a){if(!a)var a="font-weight:bold;";e.console.print("log",t,a)},e.console.group=function(t,a){if(!a)var a="font-weight:bold;";e.console.print("group",t,a)},e.console.warning=function(t,a){if(!a)var a="font-weight:bold;color:red;";t="WARNING: "+t,e.console.print("log",t,a)},e.console.groupEnd=function(){e.ie||console.groupEnd()},e.console.time=function(t){e.ie||console.time(t)},e.console.timeEnd=function(t){e.ie||console.timeEnd(t)},e.forms=function(t){var a={before:null,callback:!1,data:[],dev:!1,enabled:!1,filter:"",flipped:!1,format:e.public.text_format.value,highlight:!1,hover:!1,id:"default",init:!1,large:200,"max-height":600,"max-width":600,parent:d3.select("body"),previous:!1,propagation:!0,selected:!1,text:"text",timing:200,update:!0},l={align:"left",border:"all",color:"#ffffff",corners:0,display:"inline-block",drop:{},"font-family":"'Helvetica Neue', 'HelveticaNeue', 'Helvetica', 'Arial', 'sans-serif'","font-size":12,"font-spacing":0,"font-weight":200,height:!1,margin:0,padding:4,secondary:e.color.darker("#ffffff",.05),shadow:5,stroke:1,width:!1};l["font-align"]=e.rtl?"right":"left",l.icon=e.font.awesome?"fa-angle-down":"&#x27A4;",t&&(l=e.util.merge(l,t)),a.forms=function(t,s){var i=a.data.array instanceof Array&&a.data.array.length>a.large,s=!a.init||i||e.ie?0:a.timing;if(a.data instanceof Array&&"function"!=typeof a.data.select)a.data={array:a.data};else if("object"!=typeof a.data||a.data.array||a.data instanceof Array)a.data&&!a.data.array&&("string"!=typeof a.data||d3.select(a.data).empty()?e.util.d3selection(a.data)&&(a.element=a.data,a.data.node().id&&(a.before="#"+a.data.node().id)):(a.element=d3.selectAll(a.data),"#"==a.data.charAt(0)&&(a.before=a.data)),a.data={array:[]});else{a.data.array||(a.data.array=[]),a.element&&e.forms.element(a),e.forms.data(a);var n=a.data.array.filter(function(e){return e.value==a.focus})[0];n||(a.data.array[0].selected=!0,a.focus=a.data.array[0].value),a.data.changed}0==a.data.array.length&&a.element&&(a.parent=d3.select(a.element.node().parentNode),e.forms.element(a)),"string"==typeof a.data.array?e.console.warning('Cannot create UI element for "'+a.data.array+'", no data found.'):a.data.array instanceof Array?(a.focus||(a.data.array[0].selected=!0,a.focus=a.data.array[0].value,a.dev&&e.console.log('"value" set to "'+a.focus+'"')),a.data.array.length>10&&!("search"in a)&&(a.search=!0,a.dev&&e.console.log("search enabled")),a.element&&(a.element.style("position","absolute").style("overflow","hidden").style("clip","rect(0 0 0 0)").style("width","1px").style("height","1px").style("margin","-1px").style("padding","0").style("border","0"),a.data.changed&&"drop"==a.type&&(options=a.element.selectAll("option").data(a.data.array,function(e){return e?e.value:!1}),options.enter().append("option").each(function(e){for(k in e)["alt","value","text","selected"].indexOf(k)>=0?d3.select(this).attr(k,e[k]):d3.select(this).attr("data-"+k,e[k]);this.selected=e.value==a.focus?!0:!1}),options.exit().remove())),a.init||(a.container=a.parent.selectAll("div#d3plus_"+a.type+"_"+a.id).data(["container"]),a.container.enter().insert("div",a.before).attr("id","d3plus_"+a.type+"_"+a.id).style("display",l.display).style("position","relative").style("overflow","visible").style("vertical-align","top"),a.tester=e.font.tester()),s?a.container.transition().duration(s).each("start",function(){"drop"==a.type&&a.enabled&&d3.select(this).style("z-index",9999)}).style("margin",l.margin+"px").each("end",function(){"drop"!=a.type||a.enabled||d3.select(this).style("z-index","auto")}):a.container.style("margin",l.margin+"px").style("z-index",function(){return"drop"==a.type&&a.enabled?9999:"auto"}),a.dev&&e.console.group('drawing "'+a.type+'"'),e.forms[a.type](a,l,s),a.dev&&e.console.groupEnd(),a.init=!0,a.update=!0,a.data.changed=!1):e.console.warning("Cannot create UI element, no data found.")};var s=["callback","data","dev","element","highlight","hover","hover_previous","id","large","parent","previous","propagation","search","selected","timing","text","type","update"];s.forEach(function(t){a.forms[t]=function(t){return function(l){if(a.dev){var s=void 0===l?"":l.toString();if(s.length>50||void 0===l)var s="";else var s=' to "'+s+'"'}return"hover"==t&&(a.hover_previous=a.hover),arguments.length?(["element","parent"].indexOf(t)>=0?("string"!=typeof l||d3.select(l).empty()?e.util.d3selection(l)?(a.dev&&e.console.log('"'+t+'" set'+s),a[t]=l):e.console.warning('Cannot set "'+t+'" as "'+l.toString()+'"'):(a.dev&&e.console.log('"'+t+'" set'+s),a[t]=d3.selectAll(l)),a[t]&&"element"==t&&(a[t].node().id&&(a.before="#"+a[t].node().id),a.parent=d3.select(a[t].node().parentNode))):(a.dev&&e.console.log('"'+t+'" set'+s),a[t]=l),a.forms):a[t]}}(t)});var i=["align","icon","border","color","corners","display","font","margin","padding","shadows"];return i.forEach(function(t){a.forms[t]=function(t){return function(s){function i(t,l){if("string"==typeof l&&(a.dev&&e.console.log('"font-family" set'+s),t["font-family"]=l),"number"==typeof l)a.dev&&e.console.log('"font-size" set'+s),t["font-size"]=l;else if("object"==typeof l)for(style in l)if("drop"==style)i(t.drop,l[style]);else{if("align"==style&&e.rtl&&("left"==l[style]?l[style]="right":"right"==l[style]&&(l[style]="left")),a.dev){var s=l[style].toString();if(s.length>50)var s="";else var s=' to "'+s+'"';e.console.log('"font-'+style+'" set'+s)}t["font-"+style]=l[style]}}if(!arguments.length)return"font"==t?l:l[t];if(a.dev){var n=s.toString();if(n.length>50)var n="";else var n=' to "'+n+'"'}return"font"==t?i(l,s):("color"==t&&l.secondary==e.color.darker(l.color,.05)&&(l.secondary=e.color.darker(s,.05)),a.dev&&e.console.log('"'+t+'" set'+n),l[t]=s),a.forms}}(t)}),a.forms.disable=function(){return a.dev&&e.console.log("disable"),a.enabled=!1,a.init&&a.parent.call(a.forms),a.forms},a.forms.enable=function(){return a.dev&&e.console.log("enable"),a.enabled=!0,!a.data.fetch||a.data.loaded&&!a.data.continuous||e.forms.json(a),a.init&&a.parent.call(a.forms),a.forms},a.forms.draw=function(e){return a.parent.call(a.forms,e),a.forms},a.forms.height=function(t){return arguments.length?(a.dev&&e.console.log('"height" set to "'+t+'"'),l.height=t,a.forms):a.container[0][0].offsetHeight},a.forms.remove=function(){a.container.remove()},a.forms.select=function(e){return a.container.select(e)},a.forms.value=function(t){return arguments.length?("string"==typeof t&&(t=a.data.array.filter(function(e){return e.value==t})[0]),t.value!=a.focus&&("select"==a.tag?a.element.selectAll("option").each(function(e,l){this.value==t.value&&(a.element.node().selectedIndex=l)}):"input"==a.tag&&"radio"==a.element.attr("type")&&a.element.each(function(){this.checked=this.value==t.value?!0:!1}),a.callback&&a.callback(t.value),a.dev&&e.console.log('"value" set to "'+t.value+'"'),a.previous=a.focus,a.focus=t.value),a.enabled=!1,a.highlight=!1,a.init&&a.parent.call(a.forms),a.forms):a.focus},a.forms.toggle=function(){return a.dev&&e.console.log("toggle"),a.update=!1,a.enabled?a.forms.disable():a.forms.enable(),a.forms},a.forms.width=function(t){if(!arguments.length){var s=[];return a.container.selectAll("div.d3plus_node").each(function(){s.push(this.offsetWidth)}),s.length>1?s.sort():1==s.length?s[0]:a.container.node().offsetWidth}return a.dev&&e.console.log('"width" set to "'+t+'"'),l.width=t,a.forms},a.forms},e.viz=function(){function t(l){for(key in l)if(null!==l[key]&&"object"==typeof l[key]&&!(l[key]instanceof Array)){if("family"in l[key])if(l[key].family in a.fonts)l[key].family=a.fonts[l[key].family];else{var s=l[key].family;l[key].family=e.font.validate(l[key].family),a.fonts[s]=l[key].family}t(l[key])}}var a={back:function(){if(a.history.states.length>0){var e=a.history.states.pop();"function"==typeof e&&e()}},connected:function(e){var t=a.focus.value;if(t){var l=e[a.edges.source][a.id.key],s=e[a.edges.target][a.id.key];if(l==t||s==t)return!0}return!1},connections:function(e,t){if(!a.edges.value)return[];var l=a.edges.restricted||a.edges.value,s=[];if(!e)return l;var i=l.filter(function(l){var i=!1;return l[a.edges.source][a.id.key]==e?(i=!0,t&&s.push(l[a.edges.target])):l[a.edges.target][a.id.key]==e&&(i=!0,t&&s.push(l[a.edges.source])),i});return t?s:i},filtered:!1,fonts:{},format:function(e,t){return"number"==typeof e?a.number_format.value(e,t,a):"string"==typeof e?a.text_format.value(e,t,a):JSON.stringify(e)},frozen:!1,g:{apps:{}},init:!1,margin:{top:0,right:0,bottom:0,left:0},mute:[],solo:[],style:e.styles.default,timing:e.styles.default.timing.transitions,touchEvent:function(){var t=a.zoom.scale>a.zoom_behavior.scaleExtent()[0],l=e.apps[a.type.value].zoom&&a.zoom.value&&a.zoom.scroll.value,s=d3.event.touches.length>1&&l;s||t||d3.event.stopPropagation()},update:!0,zoom_behavior:d3.behavior.zoom().scaleExtent([1,1]),zoom_direction:function(){var t=a.id.nesting.length-1,l=a.depth.value,s=e.apps[a.type.value].nesting===!1;return s?0:t>l?1:l!=t||!a.small&&a.html.value?0:-1}};return t(a.style),a.viz=function(t){return t.each(function(){function t(){r.length?l():(a.dev.value&&e.console.groupEnd(),a.parent.style("cursor","auto"))}function l(){var l=r.shift(),s=a.g.message&&a.g.message.text()==l.message,i="check"in l?l.check(a):!0;if(i)if(!s&&a.update){a.dev.value&&(e.console.groupEnd(),e.console.group(l.message));var n="string"==typeof a.messages.value?a.messages.value:l.message;e.ui.message(a,n),setTimeout(function(){l.function instanceof Array?l.function.forEach(function(e){e(a,t)}):"function"==typeof l.function&&l.function(a,t),l.wait||t()},10)}else l.function instanceof Array?l.function.forEach(function(e){e(a,t)}):"function"==typeof l.function&&l.function(a,t),l.wait||t();else"otherwise"in l&&l.otherwise(a),t()}a.frozen=!0,a.internal_error=null,e.draw.container(a);var s=a.width.value<=a.width.small,i=a.height.value<=a.height.small;if(a.small=s||i,a.error.value){a.messages.style="large";var n=a.error.value===!0?"Error":a.error.value;a.dev.value&&e.console.warning(n),e.ui.message(a,n)}else{var r=e.draw.steps(a);a.parent.style("cursor","wait"),a.messages.style=a.data.app?"small":"large",l()}}),a.viz},a.viz.csv=function(t){if(t instanceof Array)var l=t;var s=[],i=[],n=a.title.value||"My D3plus App Data";if(n=e.util.strip(n),!l){var l=[a.id.key];a.time.key&&l.push(a.time.key),a.size.key&&l.push(a.size.key),a.text.key&&l.push(a.text.key)}l.forEach(function(e){i.push(a.format(e))}),s.push(i),a.returned.nodes.forEach(function(t){var i=[];l.forEach(function(l){i.push(e.variable.value(a,t,l))}),s.push(i)});var r="data:text/csv;charset=utf-8,";if(s.forEach(function(e,t){dataString=e.join(","),r+=t<s.length?dataString+"\n":dataString}),e.ie){var o=new Blob([r],{type:"text/csv;charset=utf-8;"});navigator.msSaveBlob(o,n+".csv")}else{var d=encodeURI(r),u=document.createElement("a");u.setAttribute("href",d),u.setAttribute("download",n+".csv"),u.click()}return s},a.viz.draw=function(){return a.container.value?d3.select(a.container.value).empty()?e.console.warning('Cannot find <div> on page matching: "'+a.container+'"'):d3.select(a.container.value).call(a.viz):e.console.warning("Please define a container div using .container()"),a.viz},a.viz.style=function(t){function l(t,s,i){if("object"!=typeof i||i instanceof Array)void 0===t[s]?e.console.warning('"'+s+'" cannot be set'):("family"==s&&(i=i in a.fonts?a.fonts[i]:e.font.validate(i)),t[s]=i);else for(d in i)void 0===t[s]?e.console.warning('"'+s+'" cannot be set'):l(t[s],d,i[d])}function s(e,t){for(t in e)null!==e[t]&&"object"==typeof e[t]&&("font"in e[t]&&l(e,t,i),s(e[t]))}if(!arguments.length)return a.style;if("object"==typeof t){if("font"in t){var i=e.util.copy(t.font);i={font:i},s(a.style)}l(a,"style",t)}else"string"==typeof t?e.styles[t]?a.style=plus.styles[t]:e.console.warning('Style "'+t+'" does not exist. Installed styles are: "'+Object.keys(e.styles).join('", "')+'"'):e.console.warning(".style() only accepts strings or keyed objects.");return a.viz},Object.keys(e.public).forEach(function(t){function l(s){for(o in s)"deprecates"==o?s[o].forEach(function(l){a.viz[l]=function(t,l){return function(){return e.console.warning("."+t+"() method has been deprecated, please use the new ."+l+"() method."),a.viz}}(l,t)}):"object"==typeof s[o]&&l(s[o])}a[t]=e.util.copy(e.public[t]),"type"==t&&(a[t].accepted=Object.keys(e.apps)),a[t]&&l(a[t]),a.viz[t]=function(t){return function(l,s){function i(t,a,l){if(void 0===t[a])e.console.warning('"'+a+'" cannot be set.');else if("object"!=typeof l||l instanceof Array)r(t,a,l);else{if("object"==typeof t[a]&&null!==t[a])if(void 0!==t[a].key)var s="key";else if(void 0!==t[a].value)var s="value";else var s=null;else var s=null;if(a==s)r(t,s,l);else if(["key","value"].indexOf(a)>=0)r(t,a,l);else if("object"==typeof t[a]&&null!==t[a]&&t[a].object===!0)r(t[a],s,l);else for(d in l)i(t[a],d,l[d])}}function n(e,t){return t instanceof Array?e=t:e.indexOf(t)>=0?e.splice(e.indexOf(t),1):e.push(t),e}function r(l,s,i){if("type"==t&&(l.accepted||(l.accepted=Object.keys(e.apps)),l.accepted.indexOf(i)<0))for(app in e.apps)e.apps[app].deprecates&&e.apps[app].deprecates.indexOf(i)>=0&&(e.console.warning(JSON.stringify(i)+" has been deprecated by "+JSON.stringify(app)+", please update your code."),i=app);if("value"!=s&&"key"!=s&&s)var r='"'+s+'" of .'+t+"()";else var r="."+t+"()";if("value"!=s&&"key"!=s||!l.accepted)if("object"==typeof l[s]&&null!==l[s]&&l[s].accepted)var o=l[s].accepted;else var o=!1;else var o=l.accepted;var d=!0;if(o)if("string"==typeof o[0])var d=o.indexOf(i)>=0,u=o;else{var d=o.indexOf(i.constructor)>=0,u=[];o.forEach(function(e){var t=e.toString().split("()")[0].substring(9);u.push(t)})}if(o&&!d)e.console.warning(""+JSON.stringify(i)+" is not an accepted value for "+r+', please use one of the following: "'+u.join('", "')+'"');else if(!(l[s]instanceof Array)&&l[s]==i||l[s]&&(l[s].key===i||l[s].value===i))a.dev.value&&e.console.log(r+" was not updated because it did not change.");else{if("solo"==s||"mute"==s){l[s].value=n(l[s].value,i),l[s].changed=!0;var p=l[s].value;["time","coords"].indexOf(t)<0&&(p.length&&a[s].indexOf(t)<0?a[s].push(t):!p.length&&a[s].indexOf(t)>=0&&a[s].splice(a[s].indexOf(t),1))}else if("id"==t&&"key"==s)i instanceof Array?(a.id.nesting=i,a.depth.value<i.length?a.id.key=i[a.depth.value]:(a.id.key=i[0],a.depth.value=0)):(a.id.key=i,a.id.nesting=[i],a.depth.value=0),l.changed=!0;else if("text"==t&&"key"==s){if(a.text.array||(a.text.array={}),"string"==typeof i)a.text.array[a.id.key]=[i];else if(i instanceof Array)a.text.array[a.id.key]=i;else{a.text.array=i;var c=i[a.id.key]?i[a.id.key]:i[Object.keys(i)[0]];a.text.array[a.id.key]="string"==typeof c?[c]:c}a.text.key=a.text.array[a.id.key][0],l.changed=!0}else if("depth"==t){if(a.depth.value=i>=a.id.nesting.length?a.id.nesting.length-1:0>i?0:i,a.id.key=a.id.nesting[a.depth.value],a.text.array){var c=a.text.array[a.id.key];c&&(a.text.array[a.id.key]="string"==typeof c?[c]:c,a.text.key=a.text.array[a.id.key][0])}l.changed=!0}else if("aggs"==t)for(agg in i)l[s][agg]&&l[s][agg]==i[agg]?a.dev.value&&e.console.log('Aggregation for "'+agg+'" is already set to "'+i[agg]+'"'):(l[s][agg]=i[agg],l.changed=!0);else{if("object"==typeof l[s]&&null!=l[s]&&(void 0!==l[s].key||void 0!==l[s].value)){var f=void 0!==l[s].key?"key":"value";l=l[s],s=f}l.previous=l[s],l[s]=i,l.changed=!0}(a.dev.value||"dev"==t)&&(l.changed||["solo","mute"].indexOf(s)>=0)&&e.console.log("function"!=typeof l[s]&&JSON.stringify(l[s]).length<260?r+" has been set to "+JSON.stringify(l[s])+".":r+" has been set.")}}if(!arguments.length)return a[t];if(a[t].reset&&a[t].reset.forEach(function(e){a[e]=null}),s&&(a[t].callback=s),void 0!==a[t].key)var o="key";else if(void 0!==a[t].value)var o="value";else var o=null;return("object"!=typeof l||null===l||!o||l[o]||Object.keys(l)[0]in a[t])&&"object"==typeof l&&null!==l?"object"==typeof l?i(a,t,l):e.console.warning("Incompatible format for ."+t+"() method."):r(a[t],o,l),a.viz}}(t)}),a.viz},e.public={},e.public.active={key:null,mute:{value:[]},solo:{value:[]},spotlight:{accepted:[Boolean],value:!1,deprecates:["spotlight"]}},e.public.aggs={deprecated:["nesting_aggs"],value:{}},e.public.axes={mirror:{accepted:[Boolean],deprecates:["mirror_axis","mirror_axes"],value:!1},values:["x","y"]},e.public.attrs={value:{}},e.public.color={deprecates:["color_var"],key:null,mute:{value:[]},solo:{value:[]}},e.public.container={value:null},e.public.coords={center:[0,0],fit:{accepted:["auto","height","width"],value:"auto"},mute:{value:[]},padding:20,projection:{accepted:["mercator","equirectangular"],value:"mercator"},solo:{value:[]},threshold:.1,value:null},e.public.data={large:400,value:[]},e.public.depth={value:0},e.public.descs={value:{}},e.public.dev={accepted:[Boolean],value:!1},e.public.edges={arrows:{accepted:[Boolean],direction:{accepted:["source","target"],value:"target"},value:!1},deprecates:["edges"],label:!1,large:100,limit:!1,size:!1,source:"source",target:"target",value:null},e.public.error={value:!1},e.public.focus={deprecates:["highlight"],tooltip:{accepted:[Boolean],value:!0},value:null},e.public.footer={link:null,value:!1},e.public.height={small:300,value:null},e.public.history={accepted:[Boolean],states:[],value:!0},e.public.html={deprecates:["click_function"],value:null},e.public.icon={deprecates:["icon_var"],key:"icon",style:{deprecates:["icon_style"],object:!0,value:"default"}},e.public.id={data_filter:!0,deprecates:["id_var","nesting"],key:"id",mute:{value:[],deprecates:["filter"]},nesting:["id"],solo:{value:[],deprecates:["solo"]}},e.public.labels={accepted:[Boolean],resize:{accepted:[Boolean],value:!0},value:!0},e.public.legend={accepted:[Boolean],label:null,order:{accepted:["alpha","color"],sort:{accepted:["asc","desc"],value:"asc"},value:"color"},value:!0},e.public.messages={accepted:[Boolean,String],value:!0},e.public.nodes={value:null},e.public.number_format={value:function(e,t,a){var l=a&&a.time.key?[a.time.key]:["year","date"];if(t&&l.indexOf(t.toLowerCase())>=0)return e;if(10>e&&e>-10)return d3.round(e,2);if(e.toString().split(".")[0].length>4){var s=d3.formatPrefix(e).symbol;return s=s.replace("G","B"),e=d3.formatPrefix(e).scale(e),e=parseFloat(d3.format(".3g")(e)),e+s}return"share"==t?d3.format(".2f")(e):d3.format(",f")(e)}},e.public.order={key:null,sort:{accepted:["asc","desc"],value:"asc",deprecates:["sort"]}},e.public.shape={accepted:["circle","donut","line","square","area","coordinates"],interpolate:{accepted:["linear","step","step-before","step-after","basis","basis-open","cardinal","cardinal-open","monotone"],value:"linear",deprecates:["stack_type"]},value:null},e.public.size={data_filter:!0,deprecates:["value"],key:null,mute:{value:[]},scale:{accepted:["sqrt","linear","log"],deprecates:["size_scale"],value:"sqrt"},solo:{value:[]},threshold:!0},e.public.temp={deprecates:["else_var","else"],key:null,mute:{value:[]},solo:{value:[]}},e.public.text={deprecates:["name_array","text_var"],key:null,mute:{value:[]},solo:{value:[]}},e.public.text_format={value:function(e){if(!e)return"";var t=["a","and","of","to"];return e.replace(/\w\S*/g,function(e,a){return t.indexOf(e)>=0&&0!=a?e:e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}},e.public.time={data_filter:!0,deprecates:["year","year_var"],fixed:{accepted:[Boolean],value:!0,deprecates:["static_axis","static_axes"]},key:null,mute:{value:[]},solo:{value:[]}},e.public.timeline={accepted:[Boolean],handles:{accepted:[Boolean],value:!0},label:null,value:!0},e.public.title={link:null,sub:{link:null,value:null,deprecates:["sub_title"]},total:{link:null,value:!1,deprecates:["total_bar"],object:!0},value:null},e.public.tooltip={deprecates:["tooltip_info"],object:!0,value:[]},e.public.total={deprecates:["total_var"],key:null,mute:{value:[]},solo:{value:[]}},e.public.type={mode:{accepted:["squarify","slice","dice","slice-dice"],value:"squarify"},value:"tree_map"},e.public.width={small:400,value:null},e.public.x={data_filter:!0,deprecates:["xaxis","xaxis_val","xaxis_var"],domain:null,key:null,lines:[],mute:{value:[]},reset:["x_range"],scale:{accepted:["linear","log","continuous","share"],value:"linear",deprecates:["layout","unique_axis","xaxis_scale"]},solo:{value:[]},stacked:{accepted:[Boolean],value:!1},zerofill:{accepted:[Boolean],value:!1}},e.public.y={data_filter:!0,deprecates:["yaxis","yaxis_val","yaxis_var"],domain:null,key:null,lines:[],mute:{value:[]},reset:["y_range"],scale:{accepted:["linear","log","continuous","share"],value:"linear",deprecates:["layout","unique_axis","yaxis_scale"]},solo:{value:[]},stacked:{accepted:[Boolean],value:!1},zerofill:{accepted:[Boolean],value:!1}},e.public.zoom={accepted:[Boolean],click:{accepted:[Boolean],value:!0},pan:{accepted:[Boolean],value:!0},scroll:{accepted:[Boolean],value:!0,deprecates:["scroll_zoom"]},value:!0}}(),d3plus.apps.bubbles={},d3plus.apps.bubbles.fill=!0,d3plus.apps.bubbles.requirements=["data"],d3plus.apps.bubbles.tooltip="static",d3plus.apps.bubbles.shapes=["circle","donut"],d3plus.apps.bubbles.scale=1.05,d3plus.apps.bubbles.draw=function(e){function t(t){t.attr("x",function(e){return e.d3plus.x}).attr("y",function(e){return e.d3plus.y-e.r-e.d3plus.label_height-u}).attr("text-anchor","middle").attr("font-weight",e.style.font.weight).attr("font-family",e.style.font.family).attr("font-size","12px").style("fill",function(t){var a=d3plus.variable.color(e,t);return d3plus.color.legible(a)}).each(function(t){if(t.r>10&&a>10){var l=d3plus.variable.text(e,t,t.depth);d3plus.util.wordwrap({text:l,parent:this,width:n-2*u,height:a})}}).attr("y",function(e){return e.d3plus.label_height=d3.select(this).node().getBBox().height,e.d3plus.y-e.r-e.d3plus.label_height-u}).selectAll("tspan").attr("x",function(e){return e.d3plus.x})}var a=e.labels.value&&!e.small?50:0,l=e.order.key||e.size.key;if(e.data.app.sort(function(t,a){var s=d3plus.variable.value(e,t,l),i=d3plus.variable.value(e,a,l);return"asc"==e.order.sort.value?s-i:i-s}),1==e.data.app.length)var s=1,i=1;else if(e.data.app.length<4)var s=e.data.app.length,i=1;else var i=Math.ceil(Math.sqrt(e.data.app.length/(e.app_width/e.app_height))),s=Math.ceil(Math.sqrt(e.data.app.length*(e.app_width/e.app_height)));if(e.data.app.length>0)for(;(i-1)*s>=e.data.app.length;)i--;var n=e.app_width/s,r=e.app_height/i;e.data.app||(e.data.app=[]);var o=d3.min(e.data.app,function(t){return e.size.key?d3plus.variable.value(e,t,e.size.key,null,"min"):0}),d=d3.max(e.data.app,function(t){return e.size.key?d3plus.variable.value(e,t,e.size.key):0}),u=5,p=20,c=d3.min([n,r])/2-2*u;c-=a;var f=d3.scale[e.size.scale.value]().domain([o,d]).range([p,c]),v=d3.layout.pack().size([n-2*u,r-2*u-a]).value(function(t){return e.size.key?d3plus.variable.value(e,t,e.size.key):0}).padding(u).radius(function(e){return f(e)}),g=[],h=0;e.data.app.forEach(function(t,l){var i=v.nodes(t),o=n*l%e.app_width,d=r*h;i.forEach(function(t){t.d3plus||(t.d3plus={}),t.d3plus.depth||(t.d3plus.depth=t.depth),t.xoffset=o,t.yoffset=d+a,t.d3plus.static=t.depth<e.depth.value?!0:!1,t.d3plus.label=1==i.length?!1:!0}),g=g.concat(i),(l+1)%s==0&&h++});var y=c/d3.max(g,function(e){return e.r});g.forEach(function(e){e.x=(e.x-n/2)*y+n/2,e.d3plus.x=e.x+e.xoffset,e.y=(e.y-r/2)*y+r/2,e.d3plus.y=e.y+e.yoffset,e.r=e.r*y,e.d3plus.r=e.r}),g.sort(function(e,t){return e.depth-t.depth});var m=g.filter(function(e){return 0==e.depth}),x=e.group.selectAll("text.d3plus_bubble_label").data(m,function(t){return t.d3plus.label_height||(t.d3plus.label_height=0),t[e.id.nesting[t.depth]]});return x.enter().append("text").attr("class","d3plus_bubble_label").call(t).attr("opacity",0),x.transition().duration(e.style.timing.transitions).call(t).attr("opacity",1),x.exit().attr("opacity",0).remove(),g},d3plus.apps.chart={},d3plus.apps.chart.fill=!0,d3plus.apps.chart.requirements=["data","x","y"],d3plus.apps.chart.tooltip="static",d3plus.apps.chart.shapes=["circle","donut","line","square","area"],d3plus.apps.chart.scale={circle:1.1,donut:1.1,square:1.1},d3plus.apps.chart.draw=function(e){function t(t,a){t.attr("stroke",e.style.ticks.color).attr("stroke-width",e.style.ticks.width).attr("shape-rendering",e.style.rendering).style("opacity",function(t){var l="log"==e[a].scale.value&&"1"!=t.toString().charAt(0);return l?.25:1})}function a(t,a){t.attr("x1",function(t){return"x"==a?e.x_scale(t):0}).attr("x2",function(t){return"x"==a?e.x_scale(t):r.width}).attr("y1",function(t){return"y"==a?e.y_scale(t):0}).attr("y2",function(t){return"y"==a?e.y_scale(t):r.height})}function l(e){return"number"==typeof e||"string"==typeof e?null:Object.keys(e)[0]}function s(e){if("number"==typeof e)return e;if("string"==typeof e)return parseFloat(e);var t=e[Object.keys(e)[0]];return"string"==typeof t?parseFloat(t):t}function i(t,a){t.attr("x1",function(e){return"y"==a?0:e.d3plus.x-r.margin.left}).attr("x2",function(e){return"y"==a?-5:e.d3plus.x-r.margin.left}).attr("y1",function(e){return"x"==a?r.height:e.d3plus.y-r.margin.top}).attr("y2",function(e){return"x"==a?r.height+5:e.d3plus.y-r.margin.top}).style("stroke",function(t){return d3plus.color.legible(d3plus.variable.color(e,t))}).style("stroke-width",e.style.data.stroke.width).attr("shape-rendering",e.style.rendering)}function n(t){function a(e){e.attr("x2",function(e){var t="x"==e.axis?e.x:e.x-e.r;return t}).attr("y2",function(e){var t="y"==e.axis?e.y:e.y+e.r;return t}).style("stroke-width",0).attr("opacity",0)}var l=d3.event.type==d3plus.evt.click&&(e.tooltip.value.long||e.html.value),s=[d3plus.evt.over,d3plus.evt.move].indexOf(d3.event.type)>=0;if(!l&&s&&"area"!=e.shape.value){if(t.data)var t=t.data;var i=[d3plus.util.copy(t.d3plus),d3plus.util.copy(t.d3plus)];i[0].axis="x",i[1].axis="y"}else var i=[];var n=j.selectAll("line.d3plus_axis_label").data(i,function(e){return e.axis+"_"+e.id});n.enter().append("line").attr("class","d3plus_axis_label").call(a).attr("x1",function(e){return"x"==e.axis?e.x:e.x-e.r}).attr("y1",function(e){return"y"==e.axis?e.y:e.y+e.r}).style("stroke",function(){return d3plus.variable.color(e,t)}).attr("shape-rendering",e.style.rendering),n.transition().duration(e.style.timing.mouseevents).attr("class","d3plus_axis_label").attr("x2",function(t){return"x"==t.axis?t.x:r.margin.left-e.style.ticks.size}).attr("y2",function(t){return"y"==t.axis?t.y:r.height+r.margin.top+e.style.ticks.size}).style("stroke",function(){return d3plus.color.legible(d3plus.variable.color(e,t))}).style("stroke-width",e.style.data.stroke.width).attr("opacity",1),n.exit().transition().duration(e.style.timing.mouseevents).call(a).remove();var o=j.selectAll("text.d3plus_axis_label").data(i,function(e){return e.axis+"_"+e.id});o.enter().append("text").attr("class","d3plus_axis_label").attr("id",function(e){return e.axis+"_"+e.id}).text(function(a){var l=d3plus.variable.value(e,t,e[a.axis].key);return e.format(l,e[a.axis].key)}).attr("x",function(t){return"x"==t.axis?t.x:r.margin.left-5-e.style.ticks.size}).attr("y",function(t){return"y"==t.axis?t.y:r.height+r.margin.top+5+e.style.ticks.size}).attr("dy",function(t){return"y"==t.axis?.35*e.style.ticks.font.size:e.style.ticks.font.size}).attr("text-anchor",function(e){return"y"==e.axis?"end":"middle"}).style("fill",function(){return d3plus.color.legible(d3plus.variable.color(e,t))}).style("font-size",e.style.ticks.font.size).attr("font-family",e.style.font.family).attr("font-weight",e.style.font.weight).attr("opacity",0),o.transition().duration(e.style.timing.mouseevents).delay(e.style.timing.mouseevents).attr("opacity",1),o.exit().transition().duration(e.style.timing.mouseevents).attr("opacity",0).remove();var d=j.selectAll("rect.d3plus_axis_label").data(i,function(e){return e.axis+"_"+e.id});d.enter().insert("rect","text").attr("class","d3plus_axis_label").attr("x",function(t){var a=d3.select("text#"+t.axis+"_"+t.id).node().getBBox().width,l="x"==t.axis?t.x:r.margin.left-e.style.ticks.size;return"x"==t.axis?l-a/2-5:l-a-10}).attr("y",function(t){var a=d3.select("text#"+t.axis+"_"+t.id).node().getBBox().height,l="y"==t.axis?t.y:r.height+r.margin.top;return"x"==t.axis?l+e.style.ticks.size:l-a/2-5}).attr("width",function(e){var t=d3.select("text#"+e.axis+"_"+e.id).node().getBBox();return t.width+10}).attr("height",function(e){var t=d3.select("text#"+e.axis+"_"+e.id).node().getBBox();return t.height+10}).style("stroke",function(){return d3plus.color.legible(d3plus.variable.color(e,t))}).style("fill","white").style("stroke-width",e.style.data.stroke.width).attr("shape-rendering",e.style.rendering).attr("opacity",0),d.transition().duration(e.style.timing.mouseevents).delay(e.style.timing.mouseevents).attr("opacity",1),d.exit().transition().duration(e.style.timing.mouseevents).attr("opacity",0).remove()}if(e.small)var r={margin:{top:0,right:0,bottom:0,left:0}};else var r={margin:{top:10,right:10,bottom:40,left:40}};if(r.width=e.app_width-r.margin.left-r.margin.right,r.height=e.app_height-r.margin.top-r.margin.bottom,e.data.app.length){if(e.tickValues||(e.tickValues={}),e.continuous_axis=null,e.opp_axis=null,e.stacked_axis=null,e.axes.values.forEach(function(t){if(e[t].stacked.value&&(e.stacked_axis=t),e.continuous_axis||"continuous"!=e[t].scale.value||(e.continuous_axis=t,e.opp_axis="x"==t?"y":"x"),e.data.changed||e.depth.changed||!e[t+"_range"]||e.time.fixed.value){if(e.dev.value&&d3plus.console.time("determining "+t+"-axis"),"share"==e[t].scale.value)e[t+"_range"]=[0,1],e.tickValues[t]=d3plus.util.buckets([0,1],11),e.stacked_axis=t;else if(e[t].stacked.value){if(e.time.fixed.value)var a=e.data.app;else var a=e.data.restricted.all;var l=d3.nest().key(function(t){return t[e.x.key]}).rollup(function(a){return d3.sum(a,function(a){return parseFloat(d3plus.variable.value(e,a,e[t].key))})}).entries(a);e[t+"_range"]=[0,d3.max(l,function(e){return e.values})]}else if(e[t].domain instanceof Array)e[t+"_range"]=e[t].domain,e.tickValues[t]=d3plus.util.uniques(e.data.app,e[t].key),e.tickValues[t]=e.tickValues[t].filter(function(a){return a>=e[t+"_range"][0]&&a<=e[t+"_range"][1]});else if(e.time.fixed.value)e[t+"_range"]=d3.extent(e.data.app,function(a){return parseFloat(d3plus.variable.value(e,a,e[t].key))}),e.tickValues[t]=d3plus.util.uniques(e.data.app,e[t].key);else{var s=[];for(id in e.id.nesting)s=s.concat(e.data.grouped[e.id.nesting[id]].all);e[t+"_range"]=d3.extent(s,function(a){return parseFloat(d3plus.variable.value(e,a,e[t].key))}),e.tickValues[t]=d3plus.util.uniques(e.data.restricted.all,e[t].key)
}e[t+"_range"][0]==e[t+"_range"][1]&&(e[t+"_range"][0]-=1,e[t+"_range"][1]+=1),"y"==t&&(e.y_range=e.y_range.reverse()),e.dev.value&&d3plus.console.timeEnd("determining "+t+"-axis")}else e[t+"_range"]||(e[t+"_range"]=[-1,1])}),e.axes.mirror.value){var o=e.y_range.concat(e.x_range);e.x_range=d3.extent(o),e.y_range=d3.extent(o).reverse()}e.dev.value&&d3plus.console.time("removing data outside of axes");var u=e.data.app.length;if("share"==e.y.scale.value)var p=e.data.app;else var p=e.data.app.filter(function(t){var a=parseFloat(d3plus.variable.value(e,t,e.y.key)),l=null!=a&&a<=e.y_range[0]&&a>=e.y_range[1];if(l){var a=parseFloat(d3plus.variable.value(e,t,e.x.key));return null!=a&&a>=e.x_range[0]&&a<=e.x_range[1]}return!1});e.dev.value&&d3plus.console.timeEnd("removing data outside of axes");var c=u-p.length;if(c&&e.dev.value&&console.log("removed "+c+" nodes"),p){if(e.dev.value&&d3plus.console.time("determining size scale"),e.size.key){if(e.time.fixed.value)var f=d3.extent(e.data.app,function(t){var a=d3plus.variable.value(e,t,e.size.key);return 0==a?null:a});else{var v=[];for(id in e.id.nesting)v=v.concat(e.data.grouped[e.id.nesting[id]].all);var f=d3.extent(v,function(t){var a=d3plus.variable.value(e,t,e.size.key);return 0==a?null:a})}f[0]&&f[1]||(f=[0,0])}else var f=[0,0];var g=Math.floor(d3.max([d3.min([r.width,r.height])/15,10])),h=10;if(f[0]==f[1])var h=g;var y=[h,g],m=d3.scale[e.size.scale.value]().domain(f).range(y);e.dev.value&&d3plus.console.timeEnd("determining size scale")}e.axes.values.forEach(function(t){var a="x"==t?r.width:r.height;if(["continuous","share"].indexOf(e[t].scale.value)>=0)var l="linear";else var l=e[t].scale.value;e[t+"_scale"]=d3.scale[l]().domain(e[t+"_range"]).range([0,a]);var s=["continuous","share"].indexOf(e[t].scale.value)>=0;if(["square","circle","donut"].indexOf(e.shape.value)>=0&&!s&&"log"!=e[t].scale.value){var i=e[t+"_scale"],n=d3.scale[l]().domain(i.range()).range(i.domain()),o=2*m.range()[1];o=n(o);var d=o-i.domain()[0];d=e.stacked_axis?0:d,e[t+"_scale"].domain([i.domain()[0]-d,i.domain()[1]+d])}var u="x"==t?"bottom":"left";e[t+"_axis"]=d3.svg.axis().tickSize(e.style.ticks.size).tickPadding(5).orient(u).scale(e[t+"_scale"]).tickFormat(function(a){var l=!0;if(e[t].key==e.time.key&&a%1!=0&&(l=!1),("log"==e[t].scale.value&&"1"==a.toString().charAt(0)||"log"!=e[t].scale.value)&&l){if("share"==e[t].scale.value)var s=100*a+"%";else var s=e.format(a,e[t].key);if(d3.select(this).style("font-size",e.style.ticks.font.size).style("fill",e.style.ticks.font.color).attr("font-family",e.style.font.family).attr("font-weight",e.style.font.weight).text(s),"x"==t){var i=this.getBBox().width,n=this.getBBox().height;d3.select(this).attr("transform","translate(18,8)rotate(70)");var o=Math.cos(25)*i+5;o>r.yoffset&&!e.small&&(r.yoffset=o);var d=Math.cos(25)*n+5;d>r.rightoffset&&!e.small&&(r.rightoffset=d)}else{var d=this.getBBox().width;d>r.offset&&!e.small&&(r.offset=d)}}else var s=null;return s}),"continuous"==e[t].scale.value&&e.tickValues[t]&&e[t+"_axis"].tickValues(e.tickValues[t])})}if(!p)var p=[];var x=e.group.selectAll("g#plane").data(["plane"]);x.enter().append("g").attr("id","plane").attr("transform","translate("+r.margin.left+","+r.margin.top+")");var b=x.selectAll("rect#background").data(["background"]);b.enter().append("rect").attr("id","background").attr("x",0).attr("y",0).attr("width",r.width).attr("height",r.height).attr("stroke-width",1).attr("stroke","#ccc").attr("shape-rendering",e.style.rendering).style("fill","#fafafa");var k=x.selectAll("path#mirror").data(["mirror"]);k.enter().append("path").attr("id","mirror").attr("fill","#000").attr("fill-opacity",.03).attr("stroke-width",1).attr("stroke","#ccc").attr("stroke-dasharray","10,10").attr("opacity",0);var _=e.group.selectAll("g#axes").data(["axes"]);_.enter().append("g").attr("id","axes");var w=x.selectAll("g#xgrid").data(["xgrid"]);w.enter().append("g").attr("id","xgrid");var z=x.selectAll("g#ygrid").data(["ygrid"]);z.enter().append("g").attr("id","ygrid");var A=x.selectAll("g#xaxis").data(["xaxis"]);A.enter().append("g").attr("id","xaxis").attr("transform","translate(0,"+r.height+")");var E=x.selectAll("g#yaxis").data(["yaxis"]);E.enter().append("g").attr("id","yaxis");var O=_.selectAll("text#xlabel").data(["xlabel"]);O.enter().append("text").attr("id","xlabel").attr("x",e.app_width/2).attr("y",e.app_height-10).text(e.format(e.x.key)).attr("font-family",e.style.font.family).attr("font-weight",e.style.font.weight).attr("font-size",e.style.labels.size).attr("fill",e.style.labels.color).attr("text-anchor",e.style.labels.align);var B=_.selectAll("text#ylabel").data(["ylabel"]);B.enter().append("text").attr("id","ylabel").attr("y",15).attr("x",-(r.height/2+r.margin.top)).text(e.format(e.y.key)).attr("transform","rotate(-90)").attr("font-family",e.style.font.family).attr("font-weight",e.style.font.weight).attr("font-size",e.style.labels.size).attr("fill",e.style.labels.color).attr("text-anchor",e.style.labels.align);var j=e.group.selectAll("g#mouseevents").data(["mouseevents"]);j.enter().append("g").attr("id","mouseevents"),r.offset=0,E.call(e.y_axis).selectAll("line").call(t,"y"),r.margin.left+=r.offset,r.width-=r.offset,e.x_scale.range([0,r.width]),r.yoffset=0,r.rightoffset=0,A.call(e.x_axis).selectAll("line").call(t,"x"),r.height-=r.yoffset,r.width-=r.rightoffset,e.x_scale.range([0,r.width]),e.y_scale.range([0,r.height]),E.call(e.y_axis),A.call(e.x_axis),x.transition().duration(e.style.timing.transitions).attr("transform","translate("+r.margin.left+","+r.margin.top+")"),b.attr("width",r.width).attr("height",r.height),k.transition().duration(e.style.timing.transitions).attr("opacity",function(){return e.axes.mirror.value?1:0}).attr("d",function(){var e=r.width,t=r.height;return"M "+e+" "+t+" L 0 "+t+" L "+e+" 0 Z"}),E.transition().duration(e.style.timing.transitions).call(e.y_axis.scale(e.y_scale)),E.selectAll("line").transition().duration(e.style.timing.transitions).call(t,"y"),E.selectAll("path").style("fill","none"),A.transition().duration(e.style.timing.transitions).attr("transform","translate(0,"+r.height+")").call(e.x_axis.scale(e.x_scale)).selectAll("g.tick").select("text").style("text-anchor","start"),A.selectAll("line").transition().duration(e.style.timing.transitions).call(t,"x"),A.selectAll("path").style("fill","none");var N=z.selectAll("line").data(e.y_scale.ticks());N.enter().append("line").style("opacity",0).call(a,"y").call(t,"y"),N.transition().duration(e.style.timing.transitions).style("opacity",1).call(a,"y").call(t,"y"),N.exit().transition().duration(e.style.timing.transitions).style("opacity",0).remove();var M=w.selectAll("line").data(e.x_scale.ticks());M.enter().append("line").style("opacity",0).call(a,"x").call(t,"x"),M.transition().duration(e.style.timing.transitions).style("opacity",1).call(a,"x").call(t,"x"),M.exit().transition().duration(e.style.timing.transitions).style("opacity",0).remove(),O.text(e.format(e.x.key)).attr("x",e.app_width/2).attr("y",e.app_height-10).attr("opacity",function(){return 0==e.data.app.length?0:1}),B.text(e.format(e.y.key)).attr("y",15).attr("x",-(r.height/2+r.margin.top)).attr("opacity",function(){return 0==e.data.app.length?0:1}),e.axes.values.forEach(function(t){var a=x.selectAll("g.d3plus_"+t+"line").data(e[t].lines,function(e){return"number"==typeof e||"string"==typeof e?e:Object.keys(e)[0]}),i=a.enter().append("g").attr("class","d3plus_"+t+"line"),n="x"==t?"height":"width",o="x"==t?r.height-8+"px":"10px",u="x"==t?10:20;i.append("line").attr(t+"1",0).attr(t+"2",r[n]).attr("stroke","#ccc").attr("stroke-width",3).attr("stroke-dasharray","10,10"),i.append("text").style("font-size",e.style.ticks.font.size).style("fill",e.style.ticks.font.color).attr("text-align","start").attr(t,o),a.selectAll("line").transition().duration(e.style.timing.transitions).attr(t+"1",function(a){return s(a)?e[t+"_scale"](s(a)):0}).attr(t+"2",function(a){return s(a)?e[t+"_scale"](s(a)):0}).attr("opacity",function(a){var l=s(a)>e[t+"_scale"].domain()[1]&&s(a)<e[t+"_scale"].domain()[0];return null!=s(a)&&l?1:0}),a.selectAll("text").transition().duration(e.style.timing.transitions).text(function(){if(null!=s(d)){var t=e.format(s(d),y_name);return l(d)?e.format(l(d))+": "+t:t}return null}).attr(t,function(a){return e[t+"_scale"](s(a))+u+"px"})}),["line","area"].indexOf(e.shape.value)>=0&&m.range([2,2]),e.axis_offset={x:r.margin.left,y:r.margin.top},p.forEach(function(t){t.d3plus.x=e.x_scale(d3plus.variable.value(e,t,e.x.key)),t.d3plus.x+=e.axis_offset.x,t.d3plus.r=m(d3plus.variable.value(e,t,e.size.key)),e.stacked_axis||(t.d3plus.y=e.y_scale(d3plus.variable.value(e,t,e.y.key)),t.d3plus.y+=e.axis_offset.y,"area"==e.shape.value&&(t.d3plus[e.opp_axis+"0"]=e[e.opp_axis+"_scale"].range()[1],t.d3plus[e.opp_axis+"0"]+=e.axis_offset[e.opp_axis]))}),["line","area"].indexOf(e.shape.value)>=0&&(p=d3.nest().key(function(t){var a=d3plus.variable.value(e,t,e.id.key),l=t.d3plus.depth?t.d3plus.depth:0;return d3plus.util.strip(a)+"_"+l+"_"+e.shape.value}).rollup(function(t){var a=d3plus.util.uniques(t,e[e.continuous_axis].key),l=!1;return e.tickValues[e.continuous_axis].forEach(function(s,i,n){if(a.indexOf(s)<0){var r={};if(r[e[e.continuous_axis].key]=s,r[e.id.key]=t[0][e.id.key],r[e[e.opp_axis].key]=e[e.opp_axis+"_scale"].domain()[1],r.d3plus={},r.d3plus.r=m(m.domain()[0]),r.d3plus[e.continuous_axis]+=e.axis_offset[e.continuous_axis],e.stacked_axis||(r.d3plus[e.opp_axis]=e[e.opp_axis+"_scale"].range()[1],r.d3plus[e.opp_axis]+=e.axis_offset[e.opp_axis],r.d3plus[e.opp_axis+"0"]=r.d3plus[e.opp_axis]),e[e.continuous_axis].zerofill.value||e[e.opp_axis].stacked.value){var o=e[e.continuous_axis+"_scale"](s);o+=e.axis_offset[e.continuous_axis],r.d3plus[e.continuous_axis]=o,t.push(r)}else if("line"!=e.shape.value){if(!l&&i>0){var o=e[e.continuous_axis+"_scale"](n[i-1]);o+=e.axis_offset[e.continuous_axis],r.d3plus[e.continuous_axis]=o,t.push(r)}if(i<n.length-1){var o=e[e.continuous_axis+"_scale"](n[i+1]);o+=e.axis_offset[e.continuous_axis];var d=d3plus.util.copy(r);d.d3plus[e.continuous_axis]=o,t.push(d)}}l=!0}else l=!1}),t.sort(function(t,a){var l=t.d3plus[e.continuous_axis]-a.d3plus[e.continuous_axis];if(l)return l;var s=t[e[e.continuous_axis].key]-a[e[e.continuous_axis].key];return s}),t}).entries(p),p.forEach(function(t){e.id.nesting.forEach(function(a,l){l<=e.depth.value&&!t[a]&&(t[a]=d3plus.util.uniques(t.values,a).filter(function(e){return e&&"undefined"!=e})[0])})}));var T=null;if(e.order.key?T=e.order.key:e.continuous_axis?T=e[e.opp_axis].key:e.size.key&&(T=e.size.key),T&&p.sort(function(t,a){return t.values instanceof Array?(a_value=0,t.values.forEach(function(t){var a=d3plus.variable.value(e,t,T);a&&("number"==typeof a?a_value+=a:a_value=a)})):a_value=d3plus.variable.value(e,t,T),a.values instanceof Array?(b_value=0,a.values.forEach(function(t){var a=d3plus.variable.value(e,t,T);a&&("number"==typeof a?b_value+=a:b_value=a)})):b_value=d3plus.variable.value(e,a,T),e.color.key&&T==e.color.key&&(a_value=d3plus.variable.color(e,t),b_value=d3plus.variable.color(e,a),a_value=d3.rgb(a_value).hsl(),b_value=d3.rgb(b_value).hsl(),a_value=0==a_value.s?361:a_value.h,b_value=0==b_value.s?361:b_value.h),b_value>a_value?"desc"==e.order.sort.value?-1:1:a_value>b_value?"desc"==e.order.sort.value?1:-1:0}),e.stacked_axis)var q=d3.layout.stack().values(function(e){return e.values}).x(function(e){return e.d3plus.x}).x(function(e){return e.d3plus.y}).y(function(t){var a=r.height,l=d3plus.variable.value(e,t,e.y.key);return a-e.y_scale(l)}).out(function(t,a,l){var s=r.height;"share"==e[e.stacked_axis].scale.value?(t.d3plus.y0=(1-a)*s,t.d3plus.y=t.d3plus.y0-l*s):(t.d3plus.y0=s-a,t.d3plus.y=t.d3plus.y0-l),t.d3plus.y+=r.margin.top,t.d3plus.y0+=r.margin.top}),H="share"==e[e.stacked_axis].scale.value?"expand":"zero",p=q.offset(H)(p);else if(["area","line"].indexOf(e.shape.value)<0){var F=x.selectAll("g.d3plus_data_ticks").data(p,function(t){return t[e.id.key]+"_"+t.d3plus.depth}),C=F.enter().append("g").attr("class","d3plus_data_ticks").attr("opacity",0);C.append("line").attr("class","d3plus_data_y").call(i,"y"),F.selectAll("line.d3plus_data_y").call(i,"y"),C.append("line").attr("class","d3plus_data_x").call(i,"x"),F.selectAll("line.d3plus_data_x").call(i,"x"),F.transition().duration(e.style.timing.transitions).attr("opacity",1),F.exit().transition().duration(e.style.timing.transitions).attr("opacity",0).remove()}return e.mouse=n,p},d3plus.apps.geo_map={},d3plus.apps.geo_map.libs=["topojson"],d3plus.apps.geo_map.requirements=["color","coords"],d3plus.apps.geo_map.tooltip="follow",d3plus.apps.geo_map.shapes=["coordinates"],d3plus.apps.geo_map.scale=1,d3plus.apps.geo_map.nesting=!1,d3plus.apps.geo_map.zoom=!0,d3plus.apps.geo_map.draw=function(e){topojson.presimplify(e.coords.value);var t=e.coords.value,a=Object.keys(t.objects)[0];topo=topojson.feature(t,t.objects[a]),l=topo.features;var l=l.filter(function(t){return t[e.id.key]=t.id,e.coords.solo.value.length?e.coords.solo.value.indexOf(t.id)>=0:e.coords.mute.value.length?e.coords.mute.value.indexOf(t.id)<0:!0});return l},d3plus.apps.line={},d3plus.apps.line.requirements=["data","x","y"],d3plus.apps.line.tooltip="static",d3plus.apps.line.shapes=["line"],d3plus.apps.line.setup=function(e){e.x.scale.value="continuous"},d3plus.apps.line.draw=function(e){return d3plus.apps.chart.draw(e)},d3plus.apps.network={},d3plus.apps.network.requirements=["nodes","edges"],d3plus.apps.network.tooltip="static",d3plus.apps.network.shapes=["circle","square","donut"],d3plus.apps.network.scale=1.05,d3plus.apps.network.nesting=!1,d3plus.apps.network.zoom=!0,d3plus.apps.network.draw=function(e){var t=e.nodes.restricted||e.nodes.value,a=e.edges.restricted||e.edges.value,l=d3.extent(t,function(e){return e.x}),s=d3.extent(t,function(e){return e.y}),i=d3.extent(t,function(t){var a=d3plus.variable.value(e,t,e.size.key);return 0==a?null:a});"undefined"==typeof i[0]&&(i=[1,1]);var n=d3.min(d3plus.util.distances(t));if(n=e.edges.arrows.value?.45*n:.6*n,i[0]==i[1])var r=n;else{var o=l[1]+1.1*n-(l[0]-1.1*n),d=s[1]+1.1*n-(s[0]-1.1*n);if(aspect=o/d,app=e.app_width/e.app_height,app>aspect)var u=e.app_height/d;else var u=e.app_width/o;var r=.25*n;3>r*u&&(r=3/u)}var p=d3.scale[e.size.scale.value]().domain(i).range([r,n]);e.zoom.bounds=[[l[0]-1.1*n,s[0]-1.1*n],[l[1]+1.1*n,s[1]+1.1*n]];var c=[],f={};return t.forEach(function(t){var a=e.data.app.filter(function(a){return a[e.id.key]==t[e.id.key]})[0];if(a)var l=d3plus.util.merge(t,a);else var l=d3plus.util.copy(t);l.d3plus={},l.d3plus.x=t.x,l.d3plus.y=t.y;var s=d3plus.variable.value(e,l,e.size.key);l.d3plus.r=s?p(s):p.range()[0],f[l[e.id.key]]={x:l.d3plus.x,y:l.d3plus.y,r:l.d3plus.r},c.push(l)}),c.sort(function(e,t){return t.d3plus.r-e.d3plus.r}),a.forEach(function(t){t[e.edges.source]=d3plus.util.copy(t[e.edges.source]),t[e.edges.source].d3plus={};var a=f[t[e.edges.source][e.id.key]];t[e.edges.source].d3plus.r=a.r,t[e.edges.source].d3plus.x=a.x,t[e.edges.source].d3plus.y=a.y,t[e.edges.target]=d3plus.util.copy(t[e.edges.target]),t[e.edges.target].d3plus={};var l=f[t[e.edges.target][e.id.key]];t[e.edges.target].d3plus.r=l.r,t[e.edges.target].d3plus.x=l.x,t[e.edges.target].d3plus.y=l.y}),{nodes:c,edges:a}},d3plus.apps.rings={},d3plus.apps.rings.requirements=["edges","focus"],d3plus.apps.rings.tooltip="static",d3plus.apps.rings.shapes=["circle","square","donut"],d3plus.apps.rings.scale=1,d3plus.apps.rings.nesting=!1,d3plus.apps.rings.filter=function(e,t){var a=e.connections(e.focus.value,!0),l=[];a.forEach(function(t){l=l.concat(e.connections(t[e.id.key],!0))});var s=a.concat(l),i=d3plus.util.uniques(s,e.id.key);return t.filter(function(t){return i.indexOf(t[e.id.key])>=0})},d3plus.apps.rings.draw=function(e){function t(t,a){return a_value=d3plus.variable.value(e,t,c),b_value=d3plus.variable.value(e,a,c),e.color.key&&c==e.color.key?(a_value=d3plus.variable.color(e,t),b_value=d3plus.variable.color(e,a),a_value=d3.rgb(a_value).hsl(),b_value=d3.rgb(b_value).hsl(),a_value=0==a_value.s?361:a_value.h,b_value=0==b_value.s?361:b_value.h):(a_value=d3plus.variable.value(e,t,c),b_value=d3plus.variable.value(e,a,c)),b_value>a_value?"desc"==e.order.sort.value?-1:1:a_value>b_value?"desc"==e.order.sort.value?1:-1:void 0}var l=d3.min([e.app_height,e.app_width])/2,s=e.small||!e.labels.value?(l-2*e.style.labels.padding)/2:l/3,i=e.small||!e.labels.value?1.4*s:s,n=2*s,r=[],o=[],d=e.data.app.filter(function(t){return t[e.id.key]==e.focus.value})[0];d||(d={d3plus:{}},d[e.id.key]=e.focus.value),d.d3plus.x=e.app_width/2,d.d3plus.y=e.app_height/2,d.d3plus.r=.65*i;var u=[],p=[e.focus.value];e.connections(e.focus.value).forEach(function(t){var a=t[e.edges.source][e.id.key]==e.focus.value?t[e.edges.target]:t[e.edges.source],l=e.data.app.filter(function(t){return t[e.id.key]==a[e.id.key]})[0];l||(l={d3plus:{}},l[e.id.key]=a[e.id.key]),l.d3plus.edges=e.connections(l[e.id.key]).filter(function(t){return t[e.edges.source][e.id.key]!=e.focus.value&&t[e.edges.target][e.id.key]!=e.focus.value}),l.d3plus.edge=t,p.push(l[e.id.key]),u.push(l)});var c=null;c=e.order.key?e.order.key:e.color.key?e.color.key:e.size.key?e.size.key:e.id.key,u.sort(function(e,a){var l=e.d3plus.edges.length-a.d3plus.edges.length;return l?l:t(e,a)}),"number"==typeof e.edges.limit?u=u.slice(0,e.edges.limit):"function"==typeof e.edges.limit&&(u=e.edges.limit(u));var f=[],v=0;u.forEach(function(t){var a=t[e.id.key];t.d3plus.edges=t.d3plus.edges.filter(function(t){var l=t[e.edges.source][e.id.key],s=t[e.edges.target][e.id.key];return p.indexOf(l)<0&&s==a||p.indexOf(s)<0&&l==a}),v+=t.d3plus.edges.length||1,t.d3plus.edges.forEach(function(t){var l=t[e.edges.source],s=t[e.edges.target],i=s[e.id.key]==a?l:s;p.push(i[e.id.key])})}),u.sort(t);var g=0,h=2*Math.PI,y=0;u.forEach(function(l,s){var r=l.d3plus.edges.length||1,o=h/v*r;0==s&&(y=d,g-=o/2);var d=g+o/2;d-=h/4,l.d3plus.radians=d,l.d3plus.x=e.app_width/2+i*Math.cos(d),l.d3plus.y=e.app_height/2+i*Math.sin(d),g+=o,l.d3plus.edges.sort(function(a,s){var a=a[e.edges.source][e.id.key]==l[e.id.key]?a[e.edges.target]:a[e.edges.source],s=s[e.edges.source][e.id.key]==l[e.id.key]?s[e.edges.target]:s[e.edges.source];return t(a,s)}),l.d3plus.edges.forEach(function(t,s){var i=t[e.edges.source][e.id.key]==l[e.id.key]?t[e.edges.target]:t[e.edges.source],o=h/v,u=e.data.app.filter(function(t){return t[e.id.key]==i[e.id.key]})[0];u||(u={d3plus:{}},u[e.id.key]=i[e.id.key]),a=d-o*r/2+o/2+o*s,u.d3plus.radians=a,u.d3plus.x=e.app_width/2+n*Math.cos(a),u.d3plus.y=e.app_height/2+n*Math.sin(a),f.push(u)})});var m=d3.min(d3plus.util.distances(u,function(e){return[e.d3plus.x,e.d3plus.y]})),x=d3.min(d3plus.util.distances(f,function(e){return[e.d3plus.x,e.d3plus.y]}));if(m||(m=s/2),x||(x=s/4),8>m/2-4)var b=d3.min([m/2,8]);else var b=m/2-4;if(4>x/2-4)var k=d3.min([x/2,4]);else var k=x/2-4;k>s/10&&(k=s/10),b>1.5*k&&(b=1.5*k);var _=d3plus.util.uniques(u,e.id.key);_=_.concat(d3plus.util.uniques(f,e.id.key)),_.push(e.focus.value);var w=e.data.app.filter(function(t){return _.indexOf(t[e.id.key])>=0});if(e.size.key){var z=d3.extent(w,function(t){return d3plus.variable.value(e,t,e.size.key)});z[0]==z[1]&&(z[0]=0);var l=d3.scale.linear().domain(z).range([3,d3.min([b,k])]),A=d3plus.variable.value(e,d,e.size.key);d.d3plus.r=l(A)}else var l=d3.scale.linear().domain([1,2]).range([b,k]);return f.forEach(function(t){t.d3plus.ring=2;var a=e.size.key?d3plus.variable.value(e,t,e.size.key):2;t.d3plus.r=l(a)}),u.forEach(function(t){t.d3plus.ring=1;var a=e.size.key?d3plus.variable.value(e,t,e.size.key):1;t.d3plus.r=l(a);var s=[e.edges.source,e.edges.target];s.forEach(function(a){t.d3plus.edge[a].d3plus=t.d3plus.edge[a][e.id.key]==d[e.id.key]?{x:d.d3plus.x,y:d.d3plus.y,r:d.d3plus.r}:{x:t.d3plus.x,y:t.d3plus.y,r:t.d3plus.r}}),delete t.d3plus.edge.d3plus,r.push(t.d3plus.edge),e.connections(t[e.id.key]).forEach(function(a){var l=a[e.edges.source][e.id.key]==t[e.id.key]?a[e.edges.target]:a[e.edges.source];if(l[e.id.key]!=d[e.id.key]){var s=f.filter(function(t){return t[e.id.key]==l[e.id.key]})[0];if(s)var o=n;else{var o=i;s=u.filter(function(t){return t[e.id.key]==l[e.id.key]})[0]}if(s){a.d3plus={spline:!0,translate:{x:e.app_width/2,y:e.app_height/2}};var p=[e.edges.source,e.edges.target];p.forEach(function(l){a[l].d3plus=a[l][e.id.key]==t[e.id.key]?{a:t.d3plus.radians,r:i+t.d3plus.r,depth:1}:{a:s.d3plus.radians,r:o-s.d3plus.r,depth:2}}),r.push(a)}}})}),o=[d].concat(u).concat(f),o.forEach(function(t){if(!e.small&&e.labels.value)if(t[e.id.key]!=e.focus.value){t.d3plus.rotate=t.d3plus.radians*(180/Math.PI);var a=t.d3plus.rotate,l=s-3*e.style.labels.padding-t.d3plus.r;if(-90>a||a>90){a-=180;var n=-(t.d3plus.r+l/2+e.style.labels.padding),r="end"}else var n=t.d3plus.r+l/2+e.style.labels.padding,r="start";var o=u.indexOf(t)>=0?!0:!1,d=1==t.d3plus.ring?m:x;d+=2*e.style.labels.padding,t.d3plus.label={x:n,y:0,w:l,h:d,angle:a,anchor:r,valign:"center",color:d3plus.color.legible(d3plus.variable.color(e,t[e.id.key])),resize:[8,e.style.labels.font.size],background:o,mouse:!0}}else if(e.size.key){var d=i-t.d3plus.r-2*e.style.labels.padding;t.d3plus.label={x:0,y:t.d3plus.r+d/2,w:i,h:d,color:d3plus.color.legible(d3plus.variable.color(e,t[e.id.key])),resize:[10,40],background:!0,mouse:!0}}else delete t.d3plus.rotate,delete t.d3plus.label;else delete t.d3plus.rotate,delete t.d3plus.label}),e.mouse[d3plus.evt.click]=function(t){t[e.id.key]!=e.focus.value&&(d3plus.tooltip.remove(e.type.value),e.viz.focus(t[e.id.key]).draw())},{edges:r,nodes:o,data:w}},d3plus.apps.scatter={},d3plus.apps.chart.fill=!0,d3plus.apps.chart.deprecates=["pie_scatter"],d3plus.apps.scatter.requirements=["data","x","y"],d3plus.apps.scatter.tooltip="static",d3plus.apps.scatter.shapes=["circle","square","donut"],d3plus.apps.scatter.scale=d3plus.apps.chart.scale,d3plus.apps.scatter.draw=function(e){return d3plus.apps.chart.draw(e)},d3plus.apps.stacked={},d3plus.apps.stacked.requirements=["data","x","y"],d3plus.apps.stacked.tooltip="static",d3plus.apps.stacked.shapes=["area"],d3plus.apps.stacked.threshold=.03,d3plus.apps.stacked.setup=function(e){e.dev.value&&d3plus.console.time("setting local variables"),e.x.scale.value="continuous",e.dev.value&&console.log('"x" scale set to "continuous"'),e.x.zerofill.value=!0,e.dev.value&&console.log('"x" zerofill set to "true"'),e.y.stacked.value=!0,!e.y.key&&e.size.key||e.size.changed&&e.size.previous==e.y.key?(e.y.key=e.size.key,e.y.changed=!0):(!e.size.key&&e.y.key||e.y.changed&&e.y.previous==e.size.key)&&(e.size.key=e.y.key,e.size.changed=!0),e.dev.value&&console.log('"y" stacked set to "true"'),e.dev.value&&d3plus.console.timeEnd("setting local variables")},d3plus.apps.stacked.draw=function(e){return d3plus.data.threshold(e,e.x.key),d3plus.apps.chart.draw(e)},d3plus.apps.tree_map={},d3plus.apps.tree_map.modes=["squarify","slice","dice","slice-dice"],d3plus.apps.tree_map.requirements=["data","size"],d3plus.apps.tree_map.tooltip="follow",d3plus.apps.tree_map.shapes=["square"],d3plus.apps.tree_map.threshold=5e-4,d3plus.apps.tree_map.draw=function(e){d3plus.data.threshold(e);var t=d3.nest();e.id.nesting.forEach(function(a,l){l<e.depth.value&&t.key(function(e){return e[a]})}),t=t.entries(e.data.app);var a=d3.layout.treemap().mode(e.type.mode.value).round(!0).size([e.app_width,e.app_height]).children(function(e){return e.values}).padding(1).sort(function(e,t){return e.value-t.value}).value(function(t){return d3plus.variable.value(e,t,e.size.key)}).nodes({name:"root",values:t}).filter(function(e){return!e.values&&e.area});if(a.length){for(var l=a[0];l.parent;)l=l.parent;a.forEach(function(e){e.d3plus.x=e.x+e.dx/2,e.d3plus.y=e.y+e.dy/2,e.d3plus.width=e.dx,e.d3plus.height=e.dy,e.d3plus.share=e.value/l.value})}return a},d3plus.color.darker=function(e,t){var a=d3.hsl(e);if(!t)var t=.2;return a.l-=t,a.l<.1&&(a.l=.1),a.toString()},d3plus.color.legible=function(e){var t=d3.hsl(e);return t.s>.9&&(t.s=.9),t.l>.4&&(t.l=.4),t.toString()},d3plus.color.lighter=function(e,t){var a=d3.hsl(e);if(!t)var t=.1;return a.l+=t,a.s-=t/2,a.l>.95&&(a.l=.95),a.s<.05&&(a.s=.05),a.toString()},d3plus.color.mix=function(e,t,a,l){if(!a)var a=1;if(!l)var l=1;e=d3.rgb(e),t=d3.rgb(t);var s=(a*e.r+l*t.r-a*l*t.r)/(a+l-a*l),i=(a*e.g+l*t.g-a*l*t.g)/(a+l-a*l),n=(a*e.b+l*t.b-a*l*t.b)/(a+l-a*l);return d3.rgb(s,i,n).toString()},d3plus.color.random=function(e){var t=e||Math.floor(20*Math.random());return d3plus.color.scale.default(t)},d3plus.color.scale={},d3plus.color.scale.default=d3.scale.ordinal().range(["#b35c1e","#C9853A","#E4BA79","#F5DD9E","#F3D261","#C4B346","#94B153","#254322","#4F6456","#759E80","#9ED3E3","#27366C","#7B91D3","#C6CBF7","#D59DC2","#E5B3BB","#E06363","#AF3500","#D74B03","#843012","#9A4400"]),d3plus.color.text=function(e){var t=d3.hsl(e),a="#f7f7f7",l="#444444";return t.l>.65?l:t.l<.49?a:t.h>35&&t.s>=.3?l:a},d3plus.data.analyze=function(){},d3plus.data.color=function(e){e.dev.value&&d3plus.console.time("get data range");var t=[];if(e.data.pool.forEach(function(a){var l=parseFloat(d3plus.variable.value(e,a,e.color.key));"number"==typeof l&&!isNaN(l)&&t.indexOf(l)<0&&t.push(l)}),e.dev.value&&d3plus.console.timeEnd("get data range"),t.length>1){if(e.dev.value&&d3plus.console.time("create color scale"),t=d3.extent(t),t[0]<0&&t[1]>0){var a=e.style.color.range;3==a.length&&(t.push(t[1]),t[1]=0)}else if(t[1]>0&&t[0]>0){var a=e.style.color.heatmap;t=d3plus.util.buckets(t,a.length)}else{var a=e.style.color.range.slice(0);t[0]<0?a.pop():a.shift()}e.color.scale=d3.scale.sqrt().domain(t).range(a).interpolate(d3.interpolateRgb),e.dev.value&&d3plus.console.timeEnd("create color scale")}else e.color.scale=null},d3plus.data.edges=function(e){var t=d3plus.apps[e.type.value].requirements.indexOf("nodes")>=0,a=t&&!e.nodes.value;if(a){e.nodes.value=[];var l=[];e.nodes.changed=!0}e.edges.value.forEach(function(t){if("object"!=typeof t[e.edges.source]){var s={};s[e.id.key]=t[e.edges.source],t[e.edges.source]=s}if("object"!=typeof t[e.edges.target]){var s={};s[e.id.key]=t[e.edges.target],t[e.edges.target]=s}"keys"in e.data||(e.data.keys={}),e.id.key in e.data.keys||(e.data.keys[e.id.key]=typeof t[e.edges.source][e.id.key]),a&&(l.indexOf(t[e.edges.source][e.id.key])<0&&(l.push(t[e.edges.source][e.id.key]),e.nodes.value.push(t[e.edges.source])),l.indexOf(t[e.edges.target][e.id.key])<0&&(l.push(t[e.edges.target][e.id.key]),e.nodes.value.push(t[e.edges.target])))}),e.edges.linked=!0},d3plus.data.fetch=function(e,t,a){var l=[];if(e.dev.value&&d3plus.console.group('Fetching "'+t+'" data'),!a)if(e.time.solo.value.length){var a=[];e.time.solo.value.forEach(function(t){"function"==typeof t?e.data.time.forEach(function(e){t(e)&&a.push(e)}):a.push(t)})}else if(e.time.mute.value.length){var s=[];e.time.mute.value.forEach(function(t){"function"==typeof t?e.data.time.forEach(function(e){t(e)&&s.push(e)}):s.push(t)});var a=e.data.time.filter(function(e){return s.indexOf(e)<0})}else var a=["all"];if(e.dev.value&&console.log("years: "+a.join(",")),"restricted"==t)var i=e.data.restricted;else var i=e.data[t][e.id.nesting[e.depth.value]];if(1==a.length)l=i[a[0]];else{var n=[];a.forEach(function(e){i[e]?l=l.concat(i[e]):n.push(e)}),0==l.length&&n.length&&!e.internal_error&&(e.internal_error="No Data Available for "+n.join(", "),d3plus.console.warning(e.internal_error))}if(a.length>1){var r=!1;if(e.axes.values.forEach(function(t){e[t].key==e.time.key&&"continuous"==e[t].scale.value&&(r=!0)}),!r){var o=e.id.nesting.slice(0,e.depth.value+1);l=d3plus.data.nest(e,l,o,"grouped"==t)}}return l||(l=[]),e.dev.value&&d3plus.console.groupEnd(),l},d3plus.data.filter=function(e){if(e.check.indexOf("time")>=0&&(e.check.splice(e.check.indexOf("time"),1),e.data.filtered&&(e.data.filtered={all:e.data.filtered.all})),e.filters?e.check.forEach(function(t){var a=e[t].value?e[t].value:e[t].key;!a&&e.filters.indexOf(t)>=0&&e.filters.splice(e.filters.indexOf(t),1)}):e.filters=e.check.slice(0),e.check.length>=1){e.dev.value&&d3plus.console.group("Filtering Data by Required Variables");var t=e.filters.join(", ");e.dev.value&&d3plus.console.time(t);var a="value";e.filters.forEach(function(t){"xaxis"==t?e.x_range=null:"yaxis"==t&&(e.y_range=null),e.data.filtered=e.data[a].filter(function(a){var l=e[t].value?e[t].value:e[t].key,s=d3plus.variable.value(e,a,l);return"size"==t?s>0?!0:!1:null!=s}),a="filtered"}),e.data.filtered={all:e.data.filtered},e.dev.value&&d3plus.console.timeEnd(t),e.dev.value&&d3plus.console.groupEnd()}else e.data.filtered||(e.data.filtered={all:e.data.value});if(e.time.key&&1==Object.keys(e.data.filtered).length){e.dev.value&&d3plus.console.group("Disaggregating by Year"),e.data.time=d3plus.util.uniques(e.data.filtered.all,e.time.key);for(var l=0;l<e.data.time.length;l++)e.data.time[l]=parseInt(e.data.time[l]);e.data.time=e.data.time.filter(function(e){return e}),e.data.time.sort(),e.data.time.length&&(e.dev.value&&d3plus.console.time(e.data.time.length+" years"),e.data.time.forEach(function(t){e.data.filtered[t]=e.data.filtered.all.filter(function(a){return d3plus.variable.value(e,a,e.time.key)==t})}),e.dev.value&&d3plus.console.timeEnd(e.data.time.length+" years")),e.dev.value&&d3plus.console.groupEnd()}},d3plus.data.format=function(e,t){if(!t)var t="grouped";return return_data={},e.dev.value&&d3plus.console.group('Formatting "'+t+'" Data'),e.id.nesting.forEach(function(a){e.dev.value&&d3plus.console.time(a);var l=e.id.nesting.slice(0,e.id.nesting.indexOf(a)+1);return_data[a]={};for(y in e.data.restricted)return_data[a][y]="grouped"==t?d3plus.data.nest(e,e.data.restricted[y],l,!0):e.data.restricted[y];e.dev.value&&d3plus.console.timeEnd(a)}),e.dev.value&&d3plus.console.groupEnd(),return_data},d3plus.data.json=function(e,t,a){var l=e[t].url||e[t].value;e[t].url=l,e[t].value=[],d3.json(l,function(s,i){if(!s&&i)if("function"==typeof e[t].callback){var n=e[t].callback(i);if(n)if("object"==typeof n&&!(n instanceof Array)&&t in n)for(k in n)k in e&&(e[k].value=n[k]);else e[t].value=n}else e[t].value=i;else e.internal_error='Could not load data from: "'+l+'"';a()})},d3plus.data.keys=function(e,t){function l(a,s){if(a instanceof Array)a.forEach(function(e){l(e)});else if("object"==typeof a){for(var i in a)"object"==typeof a[i]?l(a[i]):i in e[t].keys||!a[i]||(e[t].keys[i]=typeof a[i]);s&&(a.d3plus={})}}if(e.dev.value&&d3plus.console.time("key analysis"),e[t].keys={},"object"==typeof e[t].value)for(a in e[t].value)l(e[t].value[a],"data"==t);else l(e[t].value,"data"==t);e.dev.value&&d3plus.console.timeEnd("key analysis")},d3plus.data.nest=function(e,t,a,l){var s=d3.nest(),i=[],n=["active","temp","total"];return a.forEach(function(t,r){s.key(function(a){return d3plus.variable.value(e,a,t)}),e.axes.values.forEach(function(t){d3plus.apps[e.type.value].requirements&&d3plus.apps[e.type.value].requirements.indexOf(t)>=0&&e[t].key&&"continuous"==e[t].scale.value&&s.key(function(a){return d3plus.variable.value(e,a,e[t].key)})}),r==a.length-1&&s.rollup(function(s){to_return={d3plus:{depth:r}},n.forEach(function(t){var a=e[t].key?e[t].key:t;to_return[a]=d3.sum(s,function(a){if(e[t].key){var l=d3plus.variable.value(e,a,e[t].key);if("number"!=typeof l)var l=l?1:0}else if("total"==t)var l=1;else var l=0;return l}),to_return.d3plus[a]=to_return[a]});var o=d3plus.variable.value(e,s[0],t);to_return[t]=o;for(key in e.data.keys)(a.indexOf(t)>=0&&a.indexOf(key)<=a.indexOf(t)||e.id.nesting.indexOf(t)>=0&&e.id.nesting.indexOf(key)<=e.id.nesting.indexOf(t))&&key in s[0]&&(!e.active.key||key!=e.active.key)&&"d3plus"!=key&&("function"==typeof e.aggs.value[key]?to_return[key]=e.aggs.value[key](s):"string"==typeof e.aggs.value[key]?to_return[key]=d3[e.aggs.value[key]](s,function(e){return e[key]}):[e.time.key,e.icon].indexOf(key)>=0||key==t&&!to_return[key]||e.x.key==key&&"continuous"==e.x.scale.value||e.y.key==key&&"continuous"==e.y.scale.value?to_return[key]=s[0][key]:"number"===e.data.keys[key]&&e.id.nesting.indexOf(key)<0?to_return[key]=d3.sum(s,function(e){return e[key]}):key&&(to_return[key]=s[0][key]));return l&&i.push(to_return),to_return})}),rename_key_value=function(e){return e.values&&e.values.length?(e.children=e.values.map(function(e){return rename_key_value(e)
}),delete e.values,e):e.values?e.values:e},find_keys=function(t,l,s){if(t.children){"number"==e.data.keys[a[l]]&&(t.key=parseFloat(t.key)),s[a[l]]=t.key,delete t.key;for(k in s)t[k]=s[k];l++,t.children.forEach(function(e){find_keys(e,l,s)})}},s=s.entries(t).map(rename_key_value).map(function(e){return find_keys(e,0,{}),e}),l?i:s},d3plus.data.nodes=function(e){var t=e.nodes.value.filter(function(e){return"number"==typeof e.x&&"number"==typeof e.y}).length;if(t==e.nodes.value.length)e.nodes.positions=!0;else{var a=d3.layout.force().size([e.app_width,e.app_height]).nodes(e.nodes.value).links(e.edges.value),l=50,s=.01;a.start();for(var i=l;i>0&&(a.tick(),!(a.alpha()<s));--i);a.stop(),e.nodes.positions=!0}},d3plus.data.restrict=function(e){e.filtered=!0;var t=e.solo.length?"solo":"mute";if(e.data.grouped=null,e.data.restricted={},e[t].length){var a="filtered";e[t].forEach(function(l){function s(a){if(e[l][t]instanceof Array)var s=e[l][t];else var s=e[l][t].value;"id"==l&&"solo"==t&&e.focus.value&&s.indexOf(e.focus.value)<0&&s.push(e.focus.value);var i=!1;return s.forEach(function(e){"function"==typeof e?i=e(a):e==a&&(i=!0)}),i}function i(a){var i=!1;if(e[l].nesting)e[l].nesting.forEach(function(t){i||(i=s(d3plus.variable.value(e,a,t)))});else{var n=e[l].value?e[l].value:e[l].key;i=s(d3plus.variable.value(e,a,n))}return"solo"==t?i:"mute"==t?!i:void 0}e.dev.value&&d3plus.console.time(l);for(y in e.data[a])e.data.restricted[y]=e.data[a][y].filter(i);"id"==l&&(e.nodes.value&&(e.dev.value&&d3plus.console.log("Filtering Nodes"),e.nodes.restricted=e.nodes.value.filter(i)),e.edges.value&&(e.dev.value&&d3plus.console.log("Filtering Connections"),e.edges.restricted=e.edges.value.filter(function(t){var a=i(t[e.edges.source]),l=i(t[e.edges.target]);return a&&l}))),a="restricted",e.dev.value&&d3plus.console.timeEnd(l)})}else e.data.restricted=e.data.filtered},d3plus.data.threshold=function(e,t){if(e.size.threshold)if("number"==typeof e.size.threshold)var a=e.size.threshold;else if("number"==typeof d3plus.apps[e.type.value].threshold)var a=d3plus.apps[e.type.value].threshold;else var a=.02;else var a=0;if("number"==typeof a&&a>0){var l=[],s=0==e.depth.value?0:{},i=[],n={},r=d3.nest();t&&r.key(function(a){return d3plus.variable.value(e,a,t)}),r.rollup(function(a){var l=a.length;e.aggs[e.size.key]?"function"==typeof e.aggs[e.size.key]?l=e.aggs[e.size.key](a):"string"==typeof e.aggs[e.size.key]&&(l=d3[e.aggs[e.size.key]](a,function(t){return d3plus.variable.value(e,t,e.size.key)})):l=d3.sum(a,function(t){return d3plus.variable.value(e,t,e.size.key)});var s=t?d3plus.variable.value(e,a[0],t):"all";return n[s]=l,l}).entries(e.data.app),e.data.app=e.data.app.filter(function(r){var o=d3plus.variable.value(e,r,e.id.key),d=d3plus.variable.value(e,r,e.size.key),u=t?d3plus.variable.value(e,r,t):"all";if(l.indexOf(o)<0&&d/n[u]>=a&&l.push(o),l.indexOf(o)<0){if(0==e.depth.value)d>s&&(s=d);else{var p=r[e.id.nesting[e.depth.value-1]];p in s||(s[p]=0),d>s[p]&&(s[p]=d)}return i.push(r),!1}return!0});var o=e.id.nesting.slice(0,e.depth.value),d=o.concat([e.x.key]),u=d3plus.data.nest(e,i,d,!0).filter(function(t){return d3plus.variable.value(e,t,e.size.key)>0});u.forEach(function(t){var l=e.id.nesting[e.depth.value-1];if(t.d3plus={},e.id.nesting.forEach(function(a,l){if(e.depth.value==l){var s=t[e.id.nesting[l-1]];t[a]=s?"d3plus_other_"+s:"d3plus_other"}else l>e.depth.value&&delete t[a]}),e.color.key&&"string"==e.color.type&&(t[e.color.key]=0==e.depth.value?e.style.color.missing:d3plus.variable.color(e,t[l],l)),e.icon.key&&0!=e.depth.value&&(t[e.icon.key]=d3plus.variable.value(e,t[l],e.icon.key,l),t.d3plus.depth=e.id.nesting.indexOf(l)),e.text.key){if(0==e.depth.value)t[e.text.key]=e.format("Values"),t[e.text.key]+=" < "+e.format(s);else{var n=d3plus.variable.value(e,t,e.text.key,l);t[e.text.key]=n,t[e.text.key]+=" < "+e.format(s[t[l]],e.size.key)}t[e.text.key]+=" ("+e.format(100*a)+"%)",t.d3plus.threshold=s,l?(t.d3plus.merged=[],i.forEach(function(a){t[l]==a[l]&&t.d3plus.merged.push(a[e.id.key])})):t.d3plus.merged=d3plus.util.uniques(i,e.id.key)}}),e.data.app=e.data.app.concat(u)}},d3plus.draw.app=function(e){if(e.group=e.g.apps[e.type.value],e.mouse={},e.internal_error)var t=null;else{e.dev.value&&d3plus.console.group('Calculating "'+e.type.value+'"');var t=d3plus.apps[e.type.value].draw(e);e.dev.value&&d3plus.console.groupEnd()}e.returned={nodes:null,edges:null},t instanceof Array?e.returned.nodes=t:t&&(t.nodes&&(e.returned.nodes=t.nodes),t.edges&&(e.returned.edges=t.edges));var a=e.returned.nodes;a&&a instanceof Array&&a.length||(e.dev.value&&d3plus.console.log("No data returned by app."),e.returned.nodes=[])},d3plus.draw.container=function(e){if(e.container.changed){e.parent=d3.select(e.container.value),e.parent.style("overflow","hidden").style("position",function(){var e=d3.select(this).style("position"),t=["absolute","fixed"].indexOf(e)>=0;return t?e:"relative"}).html("");var t=["width","height"];t.forEach(function(t){function a(l){if("BODY"==l.tagName){var s=window["inner"+t.charAt(0).toUpperCase()+t.slice(1)];"width"==t?(s-=parseFloat(d3.select(l).style("margin-left"),10),s-=parseFloat(d3.select(l).style("margin-right"),10),s-=parseFloat(d3.select(l).style("padding-left"),10),s-=parseFloat(d3.select(l).style("padding-right"),10)):"height"==t&&(s-=parseFloat(d3.select(l).style("margin-top"),10),s-=parseFloat(d3.select(l).style("margin-bottom"),10),s-=parseFloat(d3.select(l).style("padding-top"),10),s-=parseFloat(d3.select(l).style("padding-bottom"),10)),1==d3.selectAll("body > *:not(script)").size()&&d3.select("body").style("overflow","hidden"),e[t].value=s}else{var s=parseFloat(d3.select(l).style(t),10);"number"==typeof s&&s>0?e[t].value=s:"BODY"!=l.tagName&&a(l.parentNode)}}e[t].value||a(e.parent.node())}),e.parent.style("width",e.width.value+"px").style("height",e.height.value+"px")}e.app_width=e.width.value,e.app_height=e.height.value},d3plus.draw.enter=function(e){e.svg=e.parent.selectAll("svg#d3plus").data([0]),e.svg.enter().insert("svg","#d3plus_message").attr("id","d3plus").attr("width",e.width.value).attr("height",e.height.value).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink"),e.g.bg=e.svg.selectAll("rect#bg").data(["bg"]),e.g.bg.enter().append("rect").attr("id","bg").attr("fill",e.style.background).attr("width",e.width.value).attr("height",e.height.value),e.g.timeline=e.svg.selectAll("g#timeline").data(["timeline"]),e.g.timeline.enter().append("g").attr("id","timeline").attr("transform","translate(0,"+e.height.value+")"),e.g.legend=e.svg.selectAll("g#key").data(["key"]),e.g.legend.enter().append("g").attr("id","key").attr("transform","translate(0,"+e.height.value+")"),e.g.footer=e.svg.selectAll("g#footer").data(["footer"]),e.g.footer.enter().append("g").attr("id","footer").attr("transform","translate(0,"+e.height.value+")"),e.g.clipping=e.svg.selectAll("#clipping").data(["clipping"]),e.g.clipping.enter().append("clipPath").attr("id","clipping").append("rect").attr("width",e.app_width).attr("height",e.app_height),e.g.container=e.svg.selectAll("g#container").data(["container"]),e.g.container.enter().append("g").attr("id","container").attr("clip-path","url(#clipping)").attr("transform","translate("+e.margin.left+","+e.margin.top+")"),e.g.zoom=e.g.container.selectAll("g#zoom").data(["zoom"]),e.g.zoom.enter().append("g").attr("id","zoom"),e.g.viz=e.g.zoom.selectAll("g#d3plus_viz").data(["d3plus_viz"]),e.g.viz.enter().append("g").attr("id","d3plus_viz"),e.g.overlay=e.g.viz.selectAll("rect#d3plus_overlay").data([{id:"d3plus_overlay"}]),e.g.overlay.enter().append("rect").attr("id","d3plus_overlay").attr("width",e.width.value).attr("height",e.height.value).attr("opacity",0),d3plus.touch?e.g.overlay.on(d3plus.evt.over,e.touchEvent).on(d3plus.evt.move,e.touchEvent).on(d3plus.evt.out,e.touchEvent):e.g.overlay.on(d3plus.evt.move,function(t){t.dragging||(d3plus.apps[e.type.value].zoom&&e.zoom.pan.value&&e.zoom_behavior.scaleExtent()[0]<e.zoom.scale?d3.select(this).style("cursor",d3plus.prefix()+"grab"):d3.select(this).style("cursor","auto"))}).on(d3plus.evt.up,function(t){d3plus.apps[e.type.value].zoom&&e.zoom.pan.value&&e.zoom_behavior.scaleExtent()[0]<e.zoom.scale?(t.dragging=!1,d3.select(this).style("cursor",d3plus.prefix()+"grab")):d3.select(this).style("cursor","auto")}).on(d3plus.evt.down,function(t){d3plus.apps[e.type.value].zoom&&e.zoom.pan.value&&e.zoom_behavior.scaleExtent()[0]<e.zoom.scale?(t.dragging=!0,d3.select(this).style("cursor",d3plus.prefix()+"grabbing")):d3.select(this).style("cursor","auto")}),e.g.app=e.g.viz.selectAll("g#app").data(["app"]),e.g.app.enter().append("g").attr("id","app"),e.g.edges=e.g.viz.selectAll("g#edges").data(["edges"]),e.g.edges.enter().append("g").attr("id","edges").attr("opacity",0),e.g.edge_focus=e.g.viz.selectAll("g#focus").data(["focus"]),e.g.edge_focus.enter().append("g").attr("id","focus"),e.g.edge_hover=e.g.viz.selectAll("g#edge_hover").data(["edge_hover"]),e.g.edge_hover.enter().append("g").attr("id","edge_hover").attr("opacity",0),e.g.data=e.g.viz.selectAll("g#data").data(["data"]),e.g.data.enter().append("g").attr("id","data").attr("opacity",0),e.g.data_focus=e.g.viz.selectAll("g#data_focus").data(["data_focus"]),e.g.data_focus.enter().append("g").attr("id","data_focus"),e.g.labels=e.g.viz.selectAll("g#d3plus_labels").data(["d3plus_labels"]),e.g.labels.enter().append("g").attr("id","d3plus_labels"),e.defs=e.svg.selectAll("defs").data(["defs"]),e.defs.enter().append("defs")},d3plus.draw.errors=function(e){var t=["id"];d3plus.apps[e.type.value].requirements&&(t=t.concat(d3plus.apps[e.type.value].requirements));var a=[];if(t.forEach(function(t){var l="key"in e[t]?"key":"value";e[t][l]||a.push(t)}),a.length&&(e.internal_error="The following variables need to be set: "+a.join(", ")),!e.internal_error&&t.indexOf("edges")>=0&&t.indexOf("focus")>=0){var l=e.connections(e.focus.value);if(0==l.length){var s=d3plus.variable.text(e,e.focus.value,e.depth.value);e.internal_error='No Connections Available for "'+s+'"'}}var t=["d3"];d3plus.apps[e.type.value].libs&&(t=t.concat(d3plus.apps[e.type.value].libs));var a=[];if(t.forEach(function(e){window[e]||a.push(e)}),a.length){var i=a.join(", ");e.internal_error="The following libraries need to be loaded: "+i}if(e.shape.value){if(d3plus.apps[e.type.value].shapes.indexOf(e.shape.value)<0){var n=d3plus.apps[e.type.value].shapes.join('", "');d3plus.console.warning('"'+e.shape.value+'" is not an accepted shape for the "'+e.type.value+'" app, please use one of the following: "'+n+'"'),e.shape.previous=e.shape.value,e.shape.value=d3plus.apps[e.type.value].shapes[0],d3plus.console.log('Defaulting shape to "'+e.shape.value+'"')}}else e.shape.value=d3plus.apps[e.type.value].shapes[0];if("modes"in d3plus.apps[e.type.value])if(e.type.mode.value){if(d3plus.apps[e.type.value].modes.indexOf(e.type.mode.value)<0){var r=d3plus.apps[e.type.value].modes.join('", "');d3plus.console.warning('"'+e.type.mode.value+'" is not an accepted mode for the "'+e.type.value+'" app, please use one of the following: "'+r+'"'),e.type.mode.previous=e.type.mode.value,e.type.mode.value=d3plus.apps[e.type.value].modes[0],d3plus.console.log('Defaulting mode to "'+e.type.mode.value+'"')}}else e.type.mode.value=d3plus.apps[e.type.value].modes[0]},d3plus.draw.finish=function(e){function t(e){e.changed&&(e.changed=!1);for(o in e)null==e[o]||"object"!=typeof e[o]||e[o]instanceof Array||t(e[o])}d3plus.apps[e.type.value].zoom&&e.zoom.value?(e.dev.value&&d3plus.console.time("calculating zoom"),!e.init&&e.zoom.bounds&&d3plus.zoom.bounds(e,e.zoom.bounds,0),(e.focus.changed||e.height.changed||e.width.changed)&&(e.zoom.viewport?d3plus.zoom.bounds(e,e.zoom.viewport):d3plus.zoom.bounds(e,e.zoom.bounds)),e.dev.value&&d3plus.console.timeEnd("calculating zoom")):e.zoom.scale=1;var a=e.zoom.size?e.zoom.size.width:e.app_width,l=e.zoom.size?e.zoom.size.height:e.app_height,s=e.zoom.bounds?e.zoom.bounds[0][0]:0,i=e.zoom.bounds?e.zoom.bounds[0][1]:0;if(e.g.overlay.attr("width",a).attr("height",l).attr("x",s).attr("y",i),e.update?(d3plus.shape.edges(e),(e.timing||!d3plus.apps[e.type.value].zoom&&!e.timing)&&(e.dev.value&&d3plus.console.time("data labels"),d3plus.shape.labels(e,e.g.data.selectAll("g")),e.dev.value&&d3plus.console.timeEnd("data labels"),e.edges.label&&setTimeout(function(){e.dev.value&&d3plus.console.time("edge labels"),d3plus.shape.labels(e,e.g.edges.selectAll("g")),e.dev.value&&d3plus.console.timeEnd("edge labels")},e.timing))):d3plus.apps[e.type.value].zoom&&e.zoom.value&&e.timing&&setTimeout(function(){d3plus.zoom.labels(e)},e.timing),d3plus.apps[e.type.value].zoom&&e.zoom.value&&e.focus.value&&!e.timing&&(e.dev.value&&d3plus.console.time("focus labels"),d3plus.shape.labels(e,e.g.data_focus.selectAll("g")),e.edges.label&&setTimeout(function(){d3plus.shape.labels(e,e.g.edge_focus.selectAll("g"))},e.timing),e.dev.value&&d3plus.console.timeEnd("focus labels")),!e.internal_error){var n=d3plus.apps[e.type.value].requirements.indexOf("data")>=0;e.data.app&&e.returned.nodes.length||!n||(e.internal_error="No Data Available")}var r=e.type.previous;r&&e.type.value!=r&&e.g.apps[r]&&(e.dev.value&&d3plus.console.group('Hiding "'+r+'"'),e.timing?e.g.apps[r].transition().duration(e.timing).attr("opacity",0):e.g.apps[r].attr("opacity",0),e.dev.value&&d3plus.console.groupEnd());var n=d3plus.apps[e.type.value].requirements.indexOf("data")>=0,d=n&&0==e.data.app.length||e.internal_error?0:e.focus.value&&d3plus.apps[e.type.value].zoom&&e.zoom.value?.4:1,u=e.group.attr("opacity");if(d!=u){var p=e.style.timing.transitions;e.group.transition().duration(p).attr("opacity",d),e.g.data.transition().duration(p).attr("opacity",d),e.g.edges.transition().duration(p).attr("opacity",d)}t(e),e.internal_error?(d3plus.ui.message(e,e.internal_error),e.internal_error=null):d3plus.ui.message(e),setTimeout(function(){e.frozen=!1,e.update=!0,e.init=!0,d3plus.apps[e.type.value].zoom&&e.zoom.value?(e.g.zoom.datum(e).call(e.zoom_behavior.on("zoom",d3plus.zoom.mouse)),e.zoom.scroll.value||e.g.zoom.on("wheel.zoom",null),e.zoom.click.value||e.g.zoom.on("dblclick.zoom",null),e.zoom.pan.value||(e.g.zoom.on("mousemove.zoom",null),e.g.zoom.on("mousedown.zoom",null))):e.g.zoom.call(e.zoom_behavior.on("zoom",null))},e.timing)},d3plus.draw.focus=function(t){if(t.g.edge_focus.selectAll("g").remove(),t.g.data_focus.selectAll("g").remove(),t.focus.value&&d3plus.apps[t.type.value].zoom&&t.zoom.value){t.dev.value&&d3plus.console.time("drawing focus elements");var a=t.g.edges.selectAll("g");if(a.size()>0){a.each(function(e){var a=e[t.edges.source][t.id.key],l=e[t.edges.target][t.id.key];if(a==t.focus.value||l==t.focus.value){var s=t.g.edge_focus.node().appendChild(this.cloneNode(!0));d3.select(s).datum(e).attr("opacity",1).selectAll("line, path").datum(e)}});var l=t.edges.arrows.value;t.g.edge_focus.selectAll("line, path").attr("vector-effect","non-scaling-stroke").style("stroke",t.style.highlight.focus).style("stroke-width",function(){return t.edges.size?d3.select(this).style("stroke-width"):2*t.style.data.stroke.width}).attr("marker-start",function(e){var a=t.edges.arrows.direction.value;if("bucket"in e.d3plus)var s="_"+e.d3plus.bucket;else var s="";return"source"==a&&l?"url(#d3plus_edge_marker_focus"+s+")":"none"}).attr("marker-end",function(e){var a=t.edges.arrows.direction.value;if("bucket"in e.d3plus)var s="_"+e.d3plus.bucket;else var s="";return"target"==a&&l?"url(#d3plus_edge_marker_focus"+s+")":"none"}),t.g.edge_focus.selectAll("text").style("fill",t.style.highlight.focus)}var s=d3plus.util.uniques(t.connections(t.focus.value,!0),t.id.key);s.push(t.focus.value);{var i=[],n=[],r=[0],o=[0];t.g.data.selectAll("g").each(function(a){if(s.indexOf(a[t.id.key])>=0){var l=t.g.data_focus.node().appendChild(this.cloneNode(!0)),l=d3.select(l).datum(a).attr("opacity",1);"coordinates"==t.shape.value?t.zoom.viewport=t.path.bounds(t.zoom.coords[a.d3plus.id]):"d3plus"in a&&("x"in a.d3plus&&i.push(a.d3plus.x),"y"in a.d3plus&&n.push(a.d3plus.y),"r"in a.d3plus?(r.push(a.d3plus.r),o.push(a.d3plus.r)):("width"in a.d3plus&&r.push(a.d3plus.width/2),"height"in a.d3plus&&o.push(a.d3plus.height/2)));for(e in d3plus.evt){var d=d3.select(this).on(d3plus.evt[e]);d&&l.on(d3plus.evt[e],d)}}})}if(i.length&&n.length){var d=d3.extent(i),u=d3.extent(n),p=d3.max(r),c=d3.max(o);t.zoom.viewport=[[d[0]-p,u[0]-c],[d[1]+p,u[1]+c]]}t.g.data_focus.selectAll("path").style("stroke-width",2*t.style.data.stroke.width),t.dev.value&&d3plus.console.timeEnd("drawing focus elements")}else t.zoom.viewport=null},d3plus.draw.steps=function(e){var t=[],a=["data","attrs","coords","nodes","edges"];return a.forEach(function(a){("string"==typeof e[a].value||!e[a].value&&e[a].url)&&t.push({"function":function(e,t){d3plus.data.json(e,a,t)},message:"Loading Data",wait:!0})}),t.push({check:function(e){return e.update&&"function"==typeof d3plus.apps[e.type.value].setup},"function":d3plus.apps[e.type.value].setup,message:'Initializing "'+e.type.value+'"'}),t.push({"function":function(e){e.type.previous&&e.type.value!=e.type.previous&&d3plus.tooltip.remove(e.type.previous),d3plus.tooltip.remove(e.type.value)},message:"Resetting Tooltips"}),e.update&&(t.push({check:function(e){return e.container.changed},"function":d3plus.draw.enter,message:"Creating SVG Elements"}),t.push({check:function(e){return!(e.type.value in e.g.apps)},"function":function(e){e.g.apps[e.type.value]=e.g.app.selectAll("g#"+e.type.value).data([e.type.value]),e.g.apps[e.type.value].enter().append("g").attr("id",e.type.value).attr("opacity",0)},message:'Creating "'+e.type.value+'" Group'}),t.push({check:function(e){return e.data.changed},"function":function(e){e.data.filtered=null,e.data.grouped=null,e.data.app=null,e.data.restricted=null,e.nodes.restricted=null,e.edges.restricted=null,d3plus.data.keys(e,"data")},message:"Analyzing New Data"}),t.push({check:function(e){return e.attrs.changed},"function":function(e){d3plus.data.keys(e,"attrs")},message:"Analyzing New Attributes"}),t.push({check:function(e){var t=d3plus.apps[e.type.value].requirements.indexOf("edges")>=0;return(!e.edges.linked||e.edges.changed)&&t&&e.edges.value},"function":d3plus.data.edges,message:"Analyzing Network"}),t.push({check:function(e){var t=d3plus.apps[e.type.value].requirements.indexOf("nodes")>=0;return t&&(!e.nodes.positions||e.nodes.changed)&&e.nodes.value&&e.edges.value},"function":d3plus.data.nodes,message:"Analyzing Network"}),t.push({check:function(e){e.check=[];for(k in e)e[k]&&e[k].data_filter&&e[k].changed&&e.check.push(k);return!e.data.filtered||e.check.length||e.active.changed||e.temp.changed||e.total.changed},"function":function(e){e.data.grouped=null,e.data.app=null,d3plus.data.filter(e)},message:"Filtering Data"}),t.push({check:function(e){return e.mute.length>0||e.solo.length>0},"function":d3plus.data.restrict,message:"Filtering Data",otherwise:function(e){(e.filtered||!e.data.restricted||e.check.length)&&(e.data.restricted=d3plus.util.copy(e.data.filtered),e.data.grouped=null,e.data.app=null,e.nodes.restricted=null,e.edges.restricted=null,e.filtered=!1)}}),t.push({check:function(e){return!e.data.grouped},"function":function(e){e.data.grouped=d3plus.data.format(e,"grouped")},message:"Formatting Data"}),t.push({check:function(e){var t=e.time.fixed.value?null:["all"];return null===t&&(e.time.solo.changed||e.time.mute.changed||e.depth.changed)||!e.data.pool||"function"==typeof d3plus.apps[e.type.value].filter},"function":function(e){var t=e.time.fixed.value?null:["all"];e.data.pool=d3plus.data.fetch(e,"grouped",t),"function"==typeof d3plus.apps[e.type.value].filter&&(e.data.pool=d3plus.apps[e.type.value].filter(e,e.data.pool))},message:"Formatting Data"}),t.push({check:function(e){return!e.data.app||e.depth.changed||e.time.solo.changed||e.time.mute.changed||e.solo.length||e.mute.length||"function"==typeof d3plus.apps[e.type.value].filter},"function":function(e){e.data.app=d3plus.data.fetch(e,"grouped"),"function"==typeof d3plus.apps[e.type.value].filter&&(e.data.app=d3plus.apps[e.type.value].filter(e,e.data.app))},message:"Formatting Data"}),t.push({check:function(e){if(e.color.changed&&e.color.key){if("object"==typeof e.color.key)if(e.color.key[e.id.key])var t=e.color.key[e.id.key];else var t=e.color.key[Object.keys(e.color.key)[0]];else var t=e.color.key;e.color.type=e.data.keys&&t in e.data.keys?e.data.keys[t]:e.attrs.keys&&t in e.attrs.keys?e.attrs.keys[t]:void 0}else e.color.key||(e.color.type=e.data.keys[e.id.key]);return e.color.key&&"number"==e.color.type&&e.data.value&&e.color.key!=e.id.key&&(e.color.changed||e.data.changed||e.depth.changed||e.time.fixed.value&&(e.time.solo.changed||e.time.mute.changed))},"function":d3plus.data.color,message:"Calculating Colors",otherwise:function(e){"number"!=e.color.type&&(e.color.scale=null)}})),t.push({"function":function(e){if(e.margin={top:0,right:0,bottom:0,left:0},d3plus.ui.titles(e),e.update)d3plus.ui.timeline(e),d3plus.ui.legend(e);else{var t=e.g.timeline.node().getBBox();t=t.height+t.y;var a=e.g.legend.node().getBBox();if(a=a.height+a.y,a&&t)var l=3*e.style.ui.padding;else if(a||t)var l=2*e.style.ui.padding;else var l=0;e.margin.bottom+=t+a+l}d3plus.ui.history(e),e.app_height-=e.margin.top+e.margin.bottom},message:"Updating UI"}),t.push({"function":[d3plus.ui.focus,d3plus.draw.update],message:"Updating UI"}),t.push({"function":function(e){e.update&&(d3plus.draw.errors(e),d3plus.draw.app(e),d3plus.shape.draw(e)),d3plus.draw.focus(e),d3plus.draw.finish(e)},message:"Drawing Visualization"}),t},d3plus.draw.update=function(e){e.timing?(e.parent.transition().duration(e.timing).style("width",e.width.value+"px").style("height",e.height.value+"px"),e.svg.transition().duration(e.timing).attr("width",e.width.value).attr("height",e.height.value),e.g.bg.transition().duration(e.timing).attr("width",e.width.value).attr("height",e.height.value),e.g.clipping.select("rect").transition().duration(e.timing).attr("width",e.app_width).attr("height",e.app_height),e.g.container.transition().duration(e.timing).attr("transform","translate("+e.margin.left+","+e.margin.top+")")):(e.parent.style("width",e.width.value+"px").style("height",e.height.value+"px"),e.svg.attr("width",e.width.value).attr("height",e.height.value),e.g.bg.attr("width",e.width.value).attr("height",e.height.value),e.g.clipping.select("rect").attr("width",e.app_width).attr("height",e.app_height),e.g.container.attr("transform","translate("+e.margin.left+","+e.margin.top+")"))},d3plus.font.awesome=!1;for(var s=0;s<document.styleSheets.length;s++){var sheet=document.styleSheets[s];if(sheet.href&&sheet.href.indexOf("font-awesome")>=0){d3plus.font.awesome=!0;break}}d3plus.font.tester=function(){var e=d3.select("body").selectAll("div.d3plus_tester").data(["d3plus_tester"]);return e.enter().append("div").attr("class","d3plus_tester").style("position","absolute").style("left","-9999px").style("top","-9999px").style("visibility","hidden").style("display","block"),e},d3plus.font.validate=function(e){function t(e){return l.append("span").style("font-family",e).style("font-size","32px").style("padding","0px").style("margin","0px").text("abcdefghiABCDEFGHI_!@#$%^&*()_+1234567890")}function a(e,t){var a=e.node().offsetWidth,l=t.node().offsetWidth;return a!==l}e instanceof Array||(e=e.split(","));var l=d3plus.font.tester(),s=t("monospace"),i=t("sans-serif");for(font in e){var n=e[font].trim(),r=t(n+",monospace"),o=a(r,s);if(r.remove(),!o){var r=t(n+",sans-serif");o=a(r,i),r.remove()}if(o){o=n;break}}return o||(o="sans-serif"),s.remove(),i.remove(),o},d3plus.forms.button=function(e,t){function a(t){t.on(d3plus.evt.over,function(t){e.hover=t.value,1==e.data.array.length||t.value!=e.highlight?d3plus.ie||0==e.timing?d3.select(this).style("cursor","pointer").call(r):d3.select(this).style("cursor","pointer").transition().duration(100).call(r):d3.select(this).style("cursor","auto")}).on(d3plus.evt.out,function(){e.hover=!1,d3plus.ie||u.size()>=e.large?d3.select(this).style("cursor","auto").call(r):d3.select(this).style("cursor","auto").transition().duration(100).call(r)}).on("click",function(t){e.propagation||d3.event.stopPropagation(),e.callback&&t.value&&e.callback(t)})}if(e.dev&&d3plus.console.time("calculating borders and padding"),"all"==t.border)var l=t.stroke+"px",s=t.padding+"px";else{var i=["top","right","bottom","left"],l="",s="";i.forEach(function(e,a){t.border.indexOf(e)>=0?(l+=t.stroke+"px",s+=t.padding+"px"):(l+="0px",s+=t.padding+t.stroke+"px"),a<i.length-1&&(l+=" ",s+=" ")})}var n="right"==t["font-align"]&&!d3plus.rtl||d3plus.rtl&&"right"==t["font-align"];e.dev&&d3plus.console.timeEnd("calculating borders and padding");var r=function(a){a.style("background-color",function(a){return a.bg=e.highlight!=a.value?e.hover==a.value?e.highlight?d3plus.color.darker(t.secondary,.05):d3plus.color.darker(t.secondary,.05):t.secondary:e.hover==a.value&&e.enabled?d3plus.color.darker(t.color,.025):t.color,a.bg}).style("color",function(t){var a=d3plus.color.text(t.bg),l=t.image&&u.size()<e.large;return"#f7f7f7"!=a&&e.selected==t.value&&t.color&&!l?d3plus.color.legible(t.color):a}).style("border-color",t.secondary).style("opacity",function(t){return[e.selected,e.highlight].indexOf(t.value)<0?.75:1})},o=function(e){e.style("position","relative").style("margin",t.margin+"px").style("display",t.display).style("border-style","solid").style("border-width",l).style("font-family",t["font-family"]).style("font-size",t["font-size"]+"px").style("font-weight",t["font-weight"]).style("text-align",t["font-align"]).style("letter-spacing",t["font-spacing"]+"px")},d=function(a){a.text(function(t){return t[e.text]}).each(function(a){var l=[];a.image&&u.size()<e.large&&l.push("image"),t.icon?(a.icon=d3plus.util.copy(t.icon),l.push("icon")):a.value===e.selected&&(a.icon=d3plus.font.awesome?{"class":"fa fa-check",content:""}:{"class":"",content:"&#x2713;"},l.push("icon"));var s=0,i=d3.select(this).selectAll("div.d3plus_button_element").data(l,function(e){return e});if(i.enter().append("div").style("display","absolute").attr("id",function(t){return"d3plus_button_element_"+e.id+"_"+t}).attr("class",function(e){var t="";return"icon"==e&&a.icon.class&&(t=" "+a[e].class),"d3plus_button_element"+t}),i.order().html(function(e){return"icon"==e?a.icon.content:""}).style("background-image",function(e){return"image"==e?"url('"+a.image+"')":"none"}).style("background-color",function(t){return"image"==t&&"knockout"==a.style?a.color||e.color:"transparent"}).style("background-size","100%").style("text-align","center").style("position",function(e){return"text"==e?"static":"absolute"}).style("width",function(){return s=t.height?t.height-2*t.padding-2*t.stroke:t["font-size"]+t.padding+t.stroke,s+"px"}).style("height",function(e){return"image"==e?s+"px":"auto"}).style("margin-top",function(e){if(this.offsetHeight)var t=this.offsetHeight;else{var t=s;"icon"==e&&(t-=3)}return-t/2+"px"}).style("top","50%").style("left",function(e){return"image"==e&&!n||"icon"==e&&n?t.padding+"px":"auto"}).style("right",function(e){return"image"==e&&n||"icon"==e&&!n?t.padding+"px":"auto"}),i.exit().remove(),s>0){s+=2*t.padding;var r=t.padding;if(2==l.length)var o=r+"px "+s+"px";else if("image"==l[0]&&!d3plus.rtl||"icon"==l[0]&&d3plus.rtl)var o=r+"px "+r+"px "+r+"px "+s+"px";else var o=r+"px "+s+"px "+r+"px "+r+"px";d3.select(this).style("padding",o)}else d3.select(this).style("padding",t.padding+"px");if("number"==typeof t.width){var d=t.width;d-=parseFloat(d3.select(this).style("padding-left"),10),d-=parseFloat(d3.select(this).style("padding-right"),10),d-=2*t.stroke,d+="px"}else var d="auto";d3.select(this).style("width",d)})},u=e.container.selectAll("div.d3plus_node").data(e.data.array,function(e){return e.id||e.value});if(e.dev&&d3plus.console.time("enter"),u.enter().append("div").attr("id","d3plus_button_"+e.id).attr("class","d3plus_node").call(r).call(o).call(d).call(a),e.dev&&d3plus.console.timeEnd("enter"),e.update||u.size()<e.large){e.dev&&d3plus.console.time("ordering"),u.order(),e.dev&&d3plus.console.timeEnd("ordering");var p=u}else var c=[e.previous,e.selected,e.highlight,e.hover,e.hover_previous].filter(function(e){return e}),p=u.filter(function(e){return c.indexOf(e.value)>=0});e.dev&&d3plus.console.time("update"),e.timing?p.transition().duration(e.timing).call(r).call(o):p.call(r).call(o),p.call(d).call(a),e.dev&&d3plus.console.timeEnd("update"),u.exit().remove()},d3plus.forms.data=function(e){if(e.data.data){e.data.array&&!("replace"in e.data&&e.data.replace===!0)&&"replace"in e.data||(e.data.array=[]);var t=["value","alt","keywords","image","style","color","selected","text"],a=e.data.map||{};t.forEach(function(e){e in a||(a[e]=e)}),e.data.data.forEach(function(t){var l={};for(key in a)a[key]in t&&(l[key]=t[a[key]]);e.data.array.push(l)});var l="sort"in e.data?e.data.sort:"text";l&&e.data.array.sort(function(e,t){return e=e[l],t=t[l],"color"==l&&(e=d3.rgb(a_value).hsl(),t=d3.rgb(b_value).hsl(),e=0==e.s?361:e.h,t=0==t.s?361:t.h),t>e?-1:e>t?1:void 0})}e.data.changed=!0,e.loading=!1},d3plus.forms.drop=function(e,a,l){function i(t){d3.select(t).on("click."+e.id,function(){var t=d3.event.target||d3.event.toElement;t=t.id;var a="_"+e.id;t.indexOf(a)<0&&e.enabled&&e.forms.disable()});try{var a=window.parent.location.host==window.location.host}catch(l){var a=!1}a&&t.self!==window.top&&i(t.parent)}function n(t){t.style("padding",_.padding+"px").style("width",A+"px").style("border-style","solid").style("border-width","0px").style("font-family",_["font-family"]).style("font-size",_["font-size"]+"px").style("font-weight",_["font-weight"]).style("text-align",_["font-align"]).attr("placeholder",e.format("Search")).style("outline","none").style(d3plus.prefix()+"border-radius","0")}function r(t){t.style("left",function(){return"left"==a.align?"0px":"center"==a.align?-((p-h)/2)+"px":"auto"}).style("right",function(){return"right"==a.align?"0px":"auto"}).style("height",D+"px").style("padding",a.stroke+"px").style("background-color",a.secondary).style("z-index",function(){return e.enabled?"9999":"-1"}).style("width",p-2*a.stroke+"px").style("top",function(){return e.flipped?"auto":v.height()+"px"}).style("bottom",function(){return e.flipped?v.height()+"px":"auto"}).style("opacity",e.enabled?1:0)}function o(t){t.style("top",function(){return e.flipped?"auto":v.height()+"px"}).style("bottom",function(){return e.flipped?v.height()+"px":"auto"}).style("display",e.enabled?null:"none"),e.search&&e.enabled&&k.select("div.d3plus_drop_search input").node().focus()}function d(e){return function(){var t=d3.interpolateNumber(this.scrollTop,e);return function(e){this.scrollTop=t(e)}}}if(e.element&&(e.element.on("focus."+e.id,function(){e.forms.update(!1).hover(!0).draw()}),e.element.on("blur."+e.id,function(){var t=e.search?d3.event.relatedTarget!=e.container.select("input").node():!0;t&&e.forms.update(!1).hover(!1).draw()}),e.element.on("change."+e.id,function(){e.forms.value(e.data.array[this.selectedIndex])}),e.element.on("keydown.cancel_"+e.id,function(){var e=d3.event.keyCode;9!=e&&d3.event.preventDefault()})),d3.select(document).on("keydown."+e.id,function(){if(e.enabled||e.hover===!0){var t=d3.event.keyCode,a=E.select("div").selectAll("div.d3plus_node"),l=0;if(a.each("boolean"==typeof e.hover?function(t,a){t.value==e.focus&&(l=a)}:function(t,a){t.value==e.hover&&(l=a)}),[9].indexOf(t)>=0&&(!e.search||e.search&&!d3.event.shiftKey))e.forms.update(!1).disable();else if([40].indexOf(t)>=0){if(e.enabled&&(l>=a.size()-1?l=0:l+=1),"boolean"!=typeof e.hover)var s=a.data()[l].value;else var s=e.focus;e.enabled?e.forms.update(!1).hover(s).draw(60):e.forms.update(!1).hover(s).enable()}else if([38].indexOf(t)>=0){if(e.enabled&&(0>=l?l=a.size()-1:l-=1),"boolean"!=typeof e.hover)var s=a.data()[l].value;else var s=e.focus;e.enabled?e.forms.update(!1).hover(s).draw(60):e.forms.update(!1).hover(s).enable()}else[13].indexOf(t)>=0?"boolean"!=typeof e.hover?e.forms.value(e.hover).hover(!0).draw():e.forms.hover(e.focus).toggle():[27].indexOf(t)>=0&&(e.enabled?e.forms.hover(!0).disable():e.hover===!0&&e.forms.hover(!1).draw())
}}),i(window),a.icon)if(0==a.icon.indexOf("fa-"))var u={"class":"d3plus_drop_icon fa "+a.icon,content:""};else var u={"class":"d3plus_drop_icon",content:a.icon};else var u=!1;var p=d3plus.forms.value(a.width,["drop","button"]);if(!p||"number"!=typeof p){e.dev&&d3plus.console.time("calculating width");var c=d3plus.util.copy(a);c.icon=u?u:d3plus.font.awesome?{"class":"fa fa-check",content:""}:{"class":"",content:"&#x2713;"},c.display="inline-block",c.border="none",c.width=!1,c.margin=0;var f=d3plus.forms.value(e.text,["drop","button"]);f||(f="text");var v=d3plus.forms(c).type("button").text(f).data(e.data.array).parent(e.tester).id(e.id).timing(0).large(9999).draw(),g=v.width();p=d3.max(g),p+=2*a.stroke,v.remove(),e.dev&&d3plus.console.timeEnd("calculating width")}"object"!=typeof a.width&&(a.width={}),a.width.drop=p;var h=d3plus.forms.value(a.width,["button","drop"]);h&&"number"==typeof h||(h=p),a.width.button=h,e.dev&&d3plus.console.time("creating main button");var y=d3plus.util.copy(a);y.icon=u,y.width=h,y.margin=0,e.enabled&&(y.shadow=0);var f=d3plus.forms.value(e.text,["button","drop"]);f||(f="text");var c=d3plus.util.copy(e.data.array.filter(function(t){return t.value==e.focus})[0]);c.id="drop_button";var m=d3plus.util.copy(c);m.text="Test";var x=e.hover===!0?e.focus:!1;e.dev&&d3plus.console.group("main button");var v=d3plus.forms(y).type("button").text(f).parent(e.container).id(e.id).timing(l).hover(x).data([m]).callback(e.forms.toggle).highlight(e.focus).update(e.update).enable().draw(),b=v.height();v.data([c]).height(b).draw(),e.dev&&d3plus.console.groupEnd(),e.dev&&d3plus.console.timeEnd("creating main button"),e.dev&&d3plus.console.time("creating dropdown");var k=e.container.selectAll("div.d3plus_drop_selector").data(["selector"]);k.enter().append("div").attr("class","d3plus_drop_selector").style("position","absolute").style("top","0px").style("padding",a.stroke+"px").style("z-index","-1").style("overflow","hidden"),e.dev&&d3plus.console.timeEnd("creating dropdown"),e.dev&&e.search&&d3plus.console.time("creating search");var _=d3plus.util.merge(a,a.drop),w=e.search?["search"]:[],z=k.selectAll("div.d3plus_drop_search").data(w),A=a.width.drop;A-=4*a.padding,A-=2*a.stroke,l?z.transition().duration(l).style("padding",_.padding+"px").style("display","block").style("background-color",_.secondary):z.style("padding",_.padding+"px").style("display","block").style("background-color",_.secondary),l?z.select("input").transition().duration(l).call(n):z.select("input").call(n),z.enter().insert("div","#d3plus_drop_list_"+e.id).attr("class","d3plus_drop_search").attr("id","d3plus_drop_search_"+e.id).style("padding",_.padding+"px").style("display","block").style("background-color",_.secondary).append("input").attr("id","d3plus_drop_input_"+e.id).style("-webkit-appearance","none").call(n),z.select("input").on("keyup."+e.id,function(){e.filter!=this.value&&(e.filter=this.value,e.forms.draw())}),z.exit().remove(),e.dev&&e.search&&d3plus.console.timeEnd("creating search"),e.dev&&d3plus.console.time("populating list");var E=k.selectAll("div.d3plus_drop_list").data(["list"]);if(E.enter().append("div").attr("class","d3plus_drop_list").attr("id","d3plus_drop_list_"+e.id).style("overflow-y","auto").style("overflow-x","hidden"),e.loading)var c=[{text:e.format("Loading...")}];else if(e.enabled){var O=d3plus.util.strip(e.filter.toLowerCase()).split("_"),B=["value","text","alt","keywords"],O=O.filter(function(e){return""!=e});if(""==e.filter)var c=e.data.array;else var c=e.data.array.filter(function(e){var a=!1;for(key in B)if(B[key]in e&&e[B[key]]){var l=d3plus.util.strip(e[B[key]].toLowerCase()).split("_");for(t in l)for(s in O)if(0==l[t].indexOf(O[s])){a=!0;break}}return a});0==c.length&&(c=[{text:e.format("No results match")+' "'+e.filter+'"'}])}e.dev&&d3plus.console.timeEnd("populating list");var j=e.container.node().getBoundingClientRect(),N=window.innerHeight-j.top;N-=v.height(),N-=10,N<2*v.height()&&(N=j.top-10,e.flipped=!0);var M=!1;if(N>e["max-height"]&&(N=e["max-height"]),e.enabled){e.dev&&d3plus.console.time("updating list items"),e.dev&&d3plus.console.group("list buttons");var y=d3plus.util.merge(a,a.drop);y.icon=!1,y.display="block",y.border="none",y.width="auto",y.margin=0;var f=d3plus.forms.value(e.text,["drop","button"]);f||(f="text");{var T=e.data.array.length<e.large?e.large:0;d3plus.forms(y).dev(e.dev).type("button").text(f).data(c).parent(E).id(e.id+"_option").timing(l).callback(e.forms.value).previous(e.previous).selected(e.focus).hover(e.hover).hover_previous(e.hover_previous).update(e.update).large(T).draw()}e.dev&&d3plus.console.groupEnd(),e.dev&&d3plus.console.timeEnd("updating list items"),e.dev&&d3plus.console.time("calculating height");var q=!1;if("none"==k.style("display"))var q=!0;q&&k.style("display","block");var H=e.search?z[0][0].offsetHeight:0,F=k.style("height"),C=k.property("scrollTop"),I=E.style("max-height"),P=E.property("scrollTop");k.style("height","auto"),E.style("max-height","200000px");var D=parseFloat(k.style("height"),10);if(E.style("max-height",I).property("scrollTop",P),k.style("height",F).property("scrollTop",C),D>N&&(D=N,M=!0),q&&k.style("display","none"),e.dev&&d3plus.console.timeEnd("calculating height"),M){e.dev&&d3plus.console.time("calculating scroll position");var S=0,L=E.select("div").selectAll("div.d3plus_node");L.each("boolean"==typeof e.hover?function(t,a){t.value==e.focus&&(S=a)}:function(t,a){t.value==e.hover&&(S=a)});var q=!1;"none"==k.style("display")&&(q=!0);var V=L[0][S];q&&k.style("display","block");var W=V.offsetTop,U=V.offsetHeight,R=E.property("scrollTop");if(q&&k.style("display","none"),q||e.data.changed)var G=W;else{var G=R;if(R>W)var G=W;else if(W+U>R+N-H)var G=W-(N-U-H)}e.dev&&d3plus.console.timeEnd("calculating scroll position")}else var G=0}else var G=E.property("scrollTop"),D=0,H=0;e.dev&&d3plus.console.time("rotating arrow");var J="&#x27A4;"==u.content?90:0;if(e.enabled!=e.flipped)var Y="rotate(-"+(180-J)+"deg)";else var Y="rotate("+J+"deg)";v.select("div#d3plus_button_element_"+e.id+"_icon").data(["icon"]).style(d3plus.prefix()+"transition",l/1e3+"s").style(d3plus.prefix()+"transform",Y).style("opacity",function(){return e.enabled?.5:1}),e.dev&&d3plus.console.timeEnd("rotating arrow"),e.dev&&d3plus.console.time("drawing list");var Z=e.enabled?N-H:0;l?(k.transition().duration(l).each("start",function(){d3.select(this).style("display",e.enabled?"block":null)}).call(r).each("end",function(){d3.select(this).transition().duration(l).call(o)}),E.transition().duration(l).style("width",p-2*a.stroke+"px").style("max-height",Z+"px").tween("scroll",d(G))):(k.call(r).call(o),E.style("width",p-2*a.stroke+"px").style("max-height",Z+"px").property("scrollTop",G)),e.dev&&d3plus.console.timeEnd("drawing list")},d3plus.forms.element=function(e){function t(e,t){var a=["value","alt","keywords","image","style","color"];[].forEach.call(t.attributes,function(t){if(/^data-/.test(t.name)){var a=t.name.substr(5).replace(/-(.)/g,function(e,t){return t.toUpperCase()});e[a]=t.value}}),a.forEach(function(a){null!==t.getAttribute(a)&&(e[a]=t.getAttribute(a))})}e.tag=e.element.node().tagName.toLowerCase(),"select"==e.tag?(e.element.attr("id")&&"default"==e.id&&(e.id=e.element.attr("id")),e.element.selectAll("option").each(function(){var a={selected:this.selected,text:this.innerHTML};t(a,this),this.selected&&(e.focus=this.value),e.data.array.push(a)})):"input"==e.tag&&"radio"==e.element.attr("type")&&e.element.each(function(){var a={selected:this.checked};if(t(a,this),this.id){var l=d3.select("label[for="+this.id+"]");l.empty()||(a.text=l.style("display","none").html())}this.checked&&(e.focus=this.value),e.data.array.push(a)}),!e.focus&&e.data.array.length&&(e.element.node().selectedIndex=0,e.focus=e.data.array[0].value),e.type||(e.type=e.data.array.length>4?"drop":"radio")},d3plus.forms.json=function(e){e.dev&&d3plus.console.time('loading data from "'+e.data.fetch+'"'),e.loading=!0,d3.json(e.data.fetch,function(t){e.data.data=t&&1==Object.keys(t).length?t[Object.keys(t)[0]]:t&&e.data.key&&t[key]?t[key]:[],"function"==typeof e.data.callback&&(e.data.data=e.data.callback(e.data.data)),e.data.loaded=!0,e.data.changed=!0,e.dev&&d3plus.console.timeEnd('loading data from "'+e.data.fetch+'"'),d3plus.forms.data(e),setTimeout(function(){e.forms.draw()},1.5*e.timing)})},d3plus.forms.radio=function(e,t,a){e.container.transition().duration(a).style("background-color",t.secondary).style("padding",t.stroke+"px").style("margin",t.margin+"px");var l=d3plus.util.copy(t);l.icon=!1,l.display="inline-block",l.border="none",l.width=!1,l.margin=0,l.stroke=0;var s=d3plus.forms.value(e.text,["button"]);s||(s="text");d3plus.forms(l).type("button").text(s).data(e.data.array).parent(e.container).id(e.id+"_radios").callback(e.forms.value).highlight(e.focus).enable().draw()},d3plus.forms.value=function(e,t){if("object"!=typeof e||!t)return"object"!=typeof e?e:!1;for(var a=!1,l=0;l<t.length;l++)if(t[l]in e){a=e[t[l]];break}return a?a:void 0},d3plus.shape.area=function(e,t,a){var l=d3.svg.area().x(function(e){return e.d3plus.x}).y0(function(e){return e.d3plus.y0}).y1(function(e){return e.d3plus.y}).interpolate(e.shape.interpolate.value);a.append("path").attr("class","d3plus_data").attr("d",function(e){return l(e.values)}).call(d3plus.shape.style,e),t.selectAll("path.d3plus_data").data(function(t){function a(t){l.y=d3.max([l.y,t.y]),l.y0=d3.min([l.y0,t.y0]),l.x0=t.x,l.h=l.y0-l.y,l.w=l.x0-l.x;var a=l.h-2*e.style.labels.padding<15||l.w-2*e.style.labels.padding<20,i=(s.w/s.h,s.w*s.h),n=(l.w/l.h,l.w*l.h);(!a&&n>i||!s.w)&&(s={w:l.w,h:l.h,x:l.x+l.w/2,y:l.y+l.h/2}),l.h<10&&(l=d3plus.util.copy(t))}if(e.labels.value){var l=null,s={w:0,h:0,x:0,y:0};t.values.forEach(function(s,i){if(l){var n=d3plus.util.buckets([0,1],e.style.labels.segments+1);n.shift(),n.pop(),n.forEach(function(e){var l=d3plus.util.copy(s.d3plus),n=t.values[i-1].d3plus;l.x=n.x+(l.x-n.x)*e,l.y=n.y+(l.y-n.y)*e,l.y0=n.y0+(l.y0-n.y0)*e,a(l)}),a(d3plus.util.copy(s.d3plus))}else l=d3plus.util.copy(s.d3plus)}),s.w>=10&&s.h>=10&&(t.d3plus_label=s)}return[t]}),e.timing?t.selectAll("path.d3plus_data").transition().duration(e.timing).attr("d",function(e){return l(e.values)}).call(d3plus.shape.style,e):t.selectAll("path.d3plus_data").attr("d",function(e){return l(e.values)}).call(d3plus.shape.style,e)},d3plus.shape.color=function(e,t){var a=e.d3plus?e.d3plus.shapeType:t.shape.value;if("line"==t.shape.value)return"circle"==a?d3plus.variable.color(t,e):"none";if("area"==t.shape.value||"active"==a)return d3plus.variable.color(t,e);if("temp"==a)return"url(#d3plus_hatch_"+e.d3plus.id+")";if("active"==a)return d3plus.variable.color(t,e);if(e.d3plus.static)return d3plus.color.lighter(d3plus.variable.color(t,e));var l=t.active.key?d3plus.variable.value(t,e,t.active.key):e.d3plus.active,s=t.temp.key?d3plus.variable.value(t,e,t.temp.key):e.d3plus.temp,i=t.total.key?d3plus.variable.value(t,e,t.total.key):e.d3plus.total;return!t.active.key&&!t.temp.key||l===!0||l&&i&&l==i&&!s||l&&!i?d3plus.variable.color(t,e):t.active.spotlight.value?"#eee":d3plus.color.lighter(d3plus.variable.color(t,e),.4)},d3plus.shape.coordinates=function(e,t,a){var l=d3.geo[e.coords.projection.value]().center(e.coords.center);e.zoom.scale||(e.zoom.scale=1),e.zoom.area=1/e.zoom.scale/e.zoom.scale,e.path=d3.geo.path().projection(l),a.append("path").attr("id",function(e){return e.id}).attr("class","d3plus_data").attr("d",e.path).call(d3plus.shape.style,e),e.timing?t.selectAll("path.d3plus_data").transition().duration(e.timing).call(d3plus.shape.style,e):t.selectAll("path.d3plus_data").call(d3plus.shape.style,e);var s=e.old_height!=e.app_height||e.height.changed||e.old_width!=e.app_width||e.width.changed;e.old_height=e.app_height,e.old_width=e.app_width,e.coords.changed||s||e.coords.mute.changed||e.coords.solo.changed?(e.zoom.bounds=null,e.zoom.coords={},e.zoom.labels={},t.each(function(t){var a=e.path.bounds(t),l=[];t.geometry.coordinates=t.geometry.coordinates.filter(function(a,s){var i=d3plus.util.copy(t);i.geometry.coordinates=[i.geometry.coordinates[s]];var n=e.path.area(i);return n>=e.coords.threshold?(l.push(n),!0):!1}),l.sort(function(e,t){return e-t});var s=d3plus.util.copy(t),i=d3plus.util.copy(t);s.geometry.coordinates=s.geometry.coordinates.filter(function(a,s){var n=d3plus.util.copy(t);n.geometry.coordinates=[n.geometry.coordinates[s]];var r=e.path.area(n);return r==l[l.length-1]&&(i.geometry.coordinates=n.geometry.coordinates),r>=d3.quantile(l,.9)}),e.zoom.coords[t.d3plus.id]=s;var n=e.path.centroid(i),r=e.path.bounds(i);e.zoom.labels[t.d3plus.id]={anchor:"middle",group:e.g.labels,h:.35*(r[1][1]-r[0][1]),w:.35*(r[1][0]-r[0][0]),valign:"center",x:n[0],y:n[1]},e.zoom.bounds?(e.zoom.bounds[0][0]>a[0][0]&&(e.zoom.bounds[0][0]=a[0][0]),e.zoom.bounds[0][1]>a[0][1]&&(e.zoom.bounds[0][1]=a[0][1]),e.zoom.bounds[1][0]<a[1][0]&&(e.zoom.bounds[1][0]=a[1][0]),e.zoom.bounds[1][1]<a[1][1]&&(e.zoom.bounds[1][1]=a[1][1])):e.zoom.bounds=a})):e.focus.value||(e.zoom.viewport=!1)},d3plus.shape.donut=function(e,t,a,l){function s(t,a,l,s){if(!a)var a=0;if("number"!=typeof l)var l=void 0;if("number"!=typeof s)var s=void 0;t.attrTween("d",function(t){if(void 0==l)var n=t.d3plus.r?t.d3plus.r:d3.max([t.d3plus.width,t.d3plus.height]);else var n=l;if(void 0==s)var r=t.d3plus.a[t.d3plus.shapeType];else var r=s;e.arcs[t.d3plus.shapeType][t.d3plus.id]||(e.arcs[t.d3plus.shapeType][t.d3plus.id]={r:0},e.arcs[t.d3plus.shapeType][t.d3plus.id].a="donut"==t.d3plus.shapeType?2*Math.PI:0);var o=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].r,n+a),d=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].a,r);return function(a){return e.arcs[t.d3plus.shapeType][t.d3plus.id].r=o(a),e.arcs[t.d3plus.shapeType][t.d3plus.id].a=d(a),i(t)}})}e.arcs||(e.arcs={donut:{},active:{},temp:{}});var i=d3.svg.arc().startAngle(0).endAngle(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].a;return a>2*Math.PI?2*Math.PI:a}).innerRadius(function(t){if("donut"!=shape||t.d3plus.static)return 0;var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return a*e.style.data.donut.size}).outerRadius(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return"donut"!=t.d3plus.shapeType?2*a:a});l.selectAll("path.d3plus_data").transition().duration(e.timing).call(s,0,0).each("end",function(t){delete e.arcs[t.d3plus.shapeType][t.d3plus.id]}),t.selectAll("path.d3plus_data").data(function(e){return[e]}).transition().duration(e.timing).call(s).call(d3plus.shape.style,e),a.append("path").attr("class","d3plus_data").transition().duration(0).call(s,0,0).call(d3plus.shape.style,e)},d3plus.shape.draw=function(e){function t(t){var a=t.d3plus.depth?t.d3plus.depth:e.depth.value;return t.d3plus.id=d3plus.variable.value(e,t,e.id.nesting[a]),t.d3plus.id+="_"+a+"_"+shape,e.axes.values.forEach(function(a){"continuous"==e[a].scale.value&&(t.d3plus.id+="_"+d3plus.variable.value(e,t,e[a].key))}),t.d3plus.id=d3plus.util.strip(t.d3plus.id),t}function a(t,a){var l=d3plus.apps[e.type.value].scale;if(a&&l&&l[e.shape.value])var s=l[e.shape.value];else if(a&&l&&"number"==typeof l)var s=l;else var s=1;t.attr("transform",function(e){return["line","area","coordinates"].indexOf(shape)<0?"translate("+e.d3plus.x+","+e.d3plus.y+")scale("+s+")":"scale("+s+")"})}function l(t){if(t&&e.g.edges.selectAll("g").size()>0){e.g.edges.selectAll("g").each(function(a){var l=t[e.id.key],s=a[e.edges.source][e.id.key],i=a[e.edges.target][e.id.key];if(s==l||i==l){var n=e.g.edge_hover.node().appendChild(this.cloneNode(!0));d3.select(n).datum(a).attr("opacity",1).selectAll("line, path").datum(a)}});var a=e.edges.arrows.value;e.g.edge_hover.attr("opacity",0).selectAll("line, path").style("stroke",e.style.highlight.primary).style("stroke-width",function(){return e.edges.size?d3.select(this).style("stroke-width"):2*e.style.data.stroke.width}).attr("marker-start",function(t){var l=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var s="_"+t.d3plus.bucket;else var s="";return"source"==l&&a?"url(#d3plus_edge_marker_highlight"+s+")":"none"}).attr("marker-end",function(t){var l=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var s="_"+t.d3plus.bucket;else var s="";return"target"==l&&a?"url(#d3plus_edge_marker_highlight"+s+")":"none"}),e.g.edge_hover.selectAll("text").style("fill",e.style.highlight.primary),e.timing?(e.g.edge_hover.transition().duration(e.style.timing.mouseevents).attr("opacity",1),e.g.edges.transition().duration(e.style.timing.mouseevents).attr("opacity",.5)):e.g.edge_hover.attr("opacity",1)}else e.timing?(e.g.edge_hover.transition().duration(e.style.timing.mouseevents).attr("opacity",0).transition().selectAll("*").remove(),e.g.edges.transition().duration(e.style.timing.mouseevents).attr("opacity",1)):e.g.edge_hover.selectAll("*").remove()}var s=e.returned.nodes||[],i=e.returned.edges||[];e.timing=s.length<e.data.large&&i.length<e.edges.large?e.style.timing.transitions:0;var n={area:"area",circle:"rect",donut:"donut",line:"line",square:"rect",coordinates:"coordinates"},r={};s.forEach(function(t){if(t.d3plus)if(t.d3plus.shape){var a=t.d3plus.shape;t.d3plus.shapeType=a}else{var a=n[e.shape.value];t.d3plus.shapeType=a}else var a=n[e.shape.value];r[a]||(r[a]=[]),r[a].push(t)});for(shape in n)n[shape]in r&&0!==Object.keys(r).length||(e.timing?e.g.data.selectAll("g.d3plus_"+n[shape]).transition().duration(e.timing).attr("opacity",0).remove():e.g.data.selectAll("g.d3plus_"+n[shape]).remove());for(shape in r){e.dev.value&&d3plus.console.group('Drawing "'+shape+'" groups'),e.dev.value&&d3plus.console.time("filtering out small shapes");var o=r[shape].filter(function(e){if(e.d3plus){if("width"in e.d3plus&&e.d3plus.width<1)return!1;if("height"in e.d3plus&&e.d3plus.height<1)return!1;if("r"in e.d3plus&&e.d3plus.r<.5)return!1}else if(e.values){var t=!0;if(e.values.forEach(function(e){"y0"in e.d3plus?t&&"y0"in e.d3plus&&e.d3plus.y0-e.d3plus.y>=1&&(t=!1):t=!1}),t)return!1}return!0});if(e.dev.value){d3plus.console.timeEnd("filtering out small shapes");var d=r[shape].length-o.length,u=d3.round(d/r[shape].length,2);console.log("removed "+d+" out of "+r[shape].length+" shapes ("+100*u+"% reduction)")}var p=e.g.data.selectAll("g.d3plus_"+shape).data(o,function(a){if(a.d3plus||(a.d3plus={}),"coordinates"==shape)return a.d3plus.id=a.id,a.id;if(!a.d3plus.id)if(a.values)a.values.forEach(function(e){e=t(e),e.d3plus.shapeType="circle"}),a.d3plus.id=a.key;else if(a=t(a),!a.d3plus.a){a.d3plus.a={donut:2*Math.PI};var l=e.active.key?a.d3plus[e.active.key]:a.d3plus.active,s=e.temp.key?a.d3plus[e.temp.key]:a.d3plus.temp,i=e.total.key?a.d3plus[e.total.key]:a.d3plus.total;i&&(a.d3plus.a.active=l?l/i*2*Math.PI:0,a.d3plus.a.temp=s?s/i*2*Math.PI+a.d3plus.a.active:0)}return a.d3plus?a.d3plus.id:!1});if(e.timing)var c=p.exit().transition().duration(e.timing).attr("opacity",0).remove();else var c=p.exit().remove();e.timing?p.transition().duration(e.timing).call(a):p.call(a);var f=e.timing?0:1,v=p.enter().append("g").attr("class","d3plus_"+shape).attr("opacity",f).call(a);e.timing&&v.transition().duration(e.timing).attr("opacity",1),p.order(),e.dev.value&&d3plus.console.time("shapes"),d3plus.shape[shape](e,p,v,c,a),e.dev.value&&d3plus.console.timeEnd("shapes"),["rect","donut"].indexOf(shape)>=0&&d3plus.apps[e.type.value].fill&&d3plus.shape.fill(e,p,v,c,a),e.dev.value&&d3plus.console.groupEnd()}l(),d3plus.touch?e.g.data.selectAll("g").on(d3plus.evt.over,e.touchEvent).on(d3plus.evt.move,e.touchEvent).on(d3plus.evt.out,e.touchEvent):e.g.data.selectAll("g").on(d3plus.evt.over,function(t){if(!(e.frozen||t.d3plus&&t.d3plus.static)){if(d3.select(this).style("cursor","pointer").transition().duration(e.style.timing.mouseevents).call(a,!0),d3.select(this).selectAll(".d3plus_data").transition().duration(e.style.timing.mouseevents).attr("opacity",1),e.covered=!1,e.focus.value!=t[e.id.key]||!e.focus.tooltip.value){if(e.continuous_axis){var s=d3.event[e.continuous_axis];positions=d3plus.util.uniques(t.values,function(t){return t.d3plus[e.continuous_axis]}),closest=d3plus.util.closest(positions,s),t.data=t.values[positions.indexOf(closest)],t.d3plus=t.values[positions.indexOf(closest)].d3plus}var i=t.data?t.data:t;d3plus.tooltip.app({vars:e,data:i})}"function"==typeof e.mouse?e.mouse(t):e.mouse[d3plus.evt.over]&&e.mouse[d3plus.evt.over](t),l(t)}}).on(d3plus.evt.move,function(t){if(!(e.frozen||t.d3plus&&t.d3plus.static)){if(e.covered=!1,["area","line"].indexOf(e.shape.value)>=0||"follow"==d3plus.apps[e.type.value].tooltip&&e.focus.value!=t[e.id.key]||!e.focus.tooltip.value){if(e.continuous_axis){var a=d3.event[e.continuous_axis];positions=d3plus.util.uniques(t.values,function(t){return t.d3plus[e.continuous_axis]}),closest=d3plus.util.closest(positions,a),t.data=t.values[positions.indexOf(closest)],t.d3plus=t.values[positions.indexOf(closest)].d3plus}var l=t.data?t.data:t;d3plus.tooltip.app({vars:e,data:l})}"function"==typeof e.mouse?e.mouse(t):e.mouse[d3plus.evt.move]&&e.mouse[d3plus.evt.move](t)}}).on(d3plus.evt.out,function(t){var s=d3plus.util.child(this,d3.event.toElement);s||e.frozen||t.d3plus&&t.d3plus.static||(d3.select(this).transition().duration(e.style.timing.mouseevents).call(a),d3.select(this).selectAll(".d3plus_data").transition().duration(e.style.timing.mouseevents).attr("opacity",e.style.data.opacity),e.covered||d3plus.tooltip.remove(e.type.value),"function"==typeof e.mouse?e.mouse(t):e.mouse[d3plus.evt.out]&&e.mouse[d3plus.evt.out](t),l())}),e.g.data.selectAll("g").on(d3plus.evt.click,function(t){if(!(e.frozen||t.d3plus&&t.d3plus.static)){"function"==typeof e.mouse?e.mouse(t):e.mouse[d3plus.evt.out]?e.mouse[d3plus.evt.out](t):e.mouse[d3plus.evt.click]&&e.mouse[d3plus.evt.click](t);var s=e.zoom_direction(),i=e.id.solo.value,n=d3plus.variable.text(e,t)[0],r=d3plus.color.legible(d3plus.variable.color(e,t)),o=e.title.sub.value||!1,d=e.style.title.sub.font.color,u=e.style.title.total.font.color;if(t.d3plus.threshold&&t.d3plus.merged&&e.zoom.value)e.history.states.push(function(){e.viz.id({solo:i}).title({sub:o}).style({title:{sub:{font:{color:d}},total:{font:{color:u}}}}).draw()}),e.viz.id({solo:t.d3plus.merged}).title({sub:n}).style({title:{sub:{font:{color:r}},total:{font:{color:r}}}}).draw();else if(1===s&&e.zoom.value){var p=d3plus.variable.value(e,t,e.id.key);e.history.states.push(function(){e.viz.depth(e.depth.value-1).id({solo:i}).title({sub:o}).style({title:{sub:{font:{color:d}},total:{font:{color:u}}}}).draw()}),e.viz.depth(e.depth.value+1).id({solo:[p]}).title({sub:n}).style({title:{sub:{font:{color:r}},total:{font:{color:r}}}}).draw()}else if(-1===s&&e.zoom.value)e.back();else if(d3plus.apps[e.type.value].zoom&&e.zoom.value)l(),d3.select(this).transition().duration(e.style.timing.mouseevents).call(a),d3.select(this).selectAll(".d3plus_data").transition().duration(e.style.timing.mouseevents).attr("opacity",e.style.data.opacity),d3plus.tooltip.remove(e.type.value),e.update=!1,t&&t[e.id.key]!=e.focus.value?e.viz.focus(t[e.id.key]).draw():e.viz.focus(null).draw();else if(t[e.id.key]!=e.focus.value){l();var c=t.data?t.data:t;d3plus.tooltip.app({vars:e,data:c})}}})},d3plus.shape.edges=function(e){function t(t){var a=1==e.style.edges.opacity?e.style.edges.opacity:0;t.attr("opacity",a).style("stroke-width",0).style("stroke",e.style.background).style("fill","none")}function a(t){var a=e.edges.arrows.value;t.style("stroke-width",function(t){return e.edges.scale(t[e.edges.size])}).style("stroke",e.style.edges.color).attr("opacity",e.style.edges.opacity).attr("marker-start",function(t){var l=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var s="_"+t.d3plus.bucket;else var s="";return"source"==l&&a?"url(#d3plus_edge_marker_default"+s+")":"none"}).attr("marker-end",function(t){var l=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var s="_"+t.d3plus.bucket;else var s="";return"target"==l&&a?"url(#d3plus_edge_marker_default"+s+")":"none"}).attr("vector-effect","non-scaling-stroke").attr("pointer-events","none")}function l(t){t.attr("x1",function(t){return t[e.edges.source].d3plus.dx}).attr("y1",function(t){return t[e.edges.source].d3plus.dy}).attr("x2",function(t){return t[e.edges.target].d3plus.dx}).attr("y2",function(t){return t[e.edges.target].d3plus.dy})}function s(t){t.attr("d",function(t){if(t[e.edges.source].d3plus.dr){var a=t[e.edges.source].d3plus.a,l=t[e.edges.source].d3plus.dr,s=t[e.edges.target].d3plus.a,i=t[e.edges.target].d3plus.dr,n={};return n[e.edges.source]={x:a,y:l},n[e.edges.target]={x:s,y:i},c(n)}var a=t[e.edges.source].d3plus.dx,l=t[e.edges.source].d3plus.dy,s=t[e.edges.target].d3plus.dx,i=t[e.edges.target].d3plus.dy,n={};return n[e.edges.source]={x:a,y:l},n[e.edges.target]={x:s,y:i},p(n)}).attr("transform",function(e){if(e.d3plus&&e.d3plus.translate){var t=e.d3plus.translate.x||0,a=e.d3plus.translate.y||0;return"translate("+t+","+a+")"}})}function i(t){if(delete t.d3plus_label,e.g.edges.selectAll("line, path").size()<e.edges.large&&e.edges.label&&t[e.edges.label]){if("spline"in t.d3plus)var a=this.getTotalLength(),l=this.getPointAtLength(a/2),s=this.getPointAtLength(a/2-.1*a),i=this.getPointAtLength(a/2+.1*a),n=Math.atan2(i.y-s.y,i.x-s.x),r=n*(180/Math.PI),o=(this.parentNode.getBBox(),.8*a),d=t.d3plus.translate.x+l.x,u=t.d3plus.translate.y+l.y,p={x:t.d3plus.translate.x+l.x,y:t.d3plus.translate.y+l.y};else{{this.getBBox()}start={x:t[e.edges.source].d3plus.dx,y:t[e.edges.source].d3plus.dy},end={x:t[e.edges.target].d3plus.dx,y:t[e.edges.target].d3plus.dy},xdiff=end.x-start.x,ydiff=end.y-start.y,l={x:end.x-xdiff/2,y:end.y-ydiff/2},n=Math.atan2(ydiff,xdiff),r=n*(180/Math.PI),a=Math.sqrt(xdiff*xdiff+ydiff*ydiff),o=a,d=l.x,u=l.y,p={x:l.x,y:l.y}}o+=2*e.style.labels.padding;var c=0;e.edges.arrows.value&&(c=e.style.edges.arrows,c/=e.zoom_behavior.scaleExtent()[1],o-=2*c),(-90>r||r>90)&&(r-=180),a*e.zoom_behavior.scaleExtent()[0]-2*c>o&&(t.d3plus_label={x:d,y:u,translate:p,w:o,h:15+2*e.style.labels.padding,angle:r,anchor:"middle",valign:"center",color:e.style.edges.color,resize:!1,names:[e.format(t[e.edges.label])],background:1})}}var n=e.returned.edges||[],r=e.zoom_behavior.scaleExtent()[0];if("string"==typeof e.edges.size){var o=d3.extent(n,function(t){return t[e.edges.size]}),d=.6*d3.min(e.returned.nodes||[],function(e){return e.d3plus.r});e.edges.scale=d3.scale.sqrt().domain(o).range([e.style.edges.width,d*r])}else{var u="number"==typeof e.edges.size?e.edges.size:e.style.edges.width;e.edges.scale=function(){return u}}var p=d3.svg.diagonal(),c=d3.svg.diagonal().projection(function(e){var t=e.y,a=e.x;return[t*Math.cos(a),t*Math.sin(a)]}),f=e.edges.arrows.value?"string"==typeof e.edges.size?["default_0","default_1","default_2","highlight_0","highlight_1","highlight_2","focus_0","focus_1","focus_2"]:["default","highlight","focus"]:[];if("string"==typeof e.edges.size)for(var v=d3plus.util.buckets(e.edges.scale.range(),4),g=[],h=0;3>h;h++)g.push(v[h+1]+(v[1]-v[0])*(h+2));else var g="number"==typeof e.edges.size?e.edges.size/e.style.edges.arrows:e.style.edges.arrows;var y=e.defs.selectAll(".d3plus_edge_marker").data(f,String),m=function(t){t.attr("d",function(t){var a=t.split("_");if(2==a.length&&e.edges.scale){a=parseInt(a[1]);var l=g[a]}else var l=g;return"target"==e.edges.arrows.direction.value?"M 0,-"+l/2+" L "+.85*l+",0 L 0,"+l/2+" L 0,-"+l/2:"M 0,-"+l/2+" L -"+.85*l+",0 L 0,"+l/2+" L 0,-"+l/2}).attr("fill",function(t){var a=t.split("_")[0];return"default"==a?e.style.edges.color:"focus"==a?e.style.highlight.focus:e.style.highlight.primary}).attr("transform","scale("+1/r+")")};e.timing?(y.exit().transition().duration(e.timing).attr("opacity",0).remove(),y.select("path").transition().duration(e.timing).attr("opacity",1).call(m)):(y.exit().remove(),y.select("path").attr("opacity",1).call(m));var x=e.timing?0:1,b=y.enter().append("marker").attr("id",function(e){return"d3plus_edge_marker_"+e}).attr("class","d3plus_edge_marker").attr("orient","auto").attr("markerUnits","userSpaceOnUse").style("overflow","visible").append("path").attr("opacity",x).attr("vector-effect","non-scaling-stroke").call(m);e.timing&&b.transition().duration(e.timing).attr("opacity",1);var k="string"==typeof e.edges.size?d3plus.util.buckets(e.edges.scale.domain(),4):null,_=e.edges.arrows.direction.value,w=n.filter(function(t){if(!t.d3plus||t.d3plus&&!("spline"in t.d3plus)){if(t.d3plus||(t.d3plus={}),k){var a=t[e.edges.size];t.d3plus.bucket=a<k[1]?0:a<k[2]?1:2;var l=.85*g[t.d3plus.bucket]/r}else{delete t.d3plus.bucket;var l=.85*g/r}var s=t[e.edges.source],i=t[e.edges.target],n=Math.atan2(s.d3plus.y-i.d3plus.y,s.d3plus.x-i.d3plus.x),o="source"==_&&e.edges.arrows.value?s.d3plus.r+l:s.d3plus.r,d="target"==_&&e.edges.arrows.value?i.d3plus.r+l:i.d3plus.r,u=d3plus.util.offset(n,o,e.shape.value),p=d3plus.util.offset(n,d,e.shape.value);return s.d3plus.dx=s.d3plus.x-u.x,s.d3plus.dy=s.d3plus.y-u.y,i.d3plus.dx=i.d3plus.x+p.x,i.d3plus.dy=i.d3plus.y+p.y,!0}return!1}),z=e.g.edges.selectAll("g.d3plus_edge_line").data(w,function(t){return t.d3plus||(t.d3plus={}),t.d3plus.id=t[e.edges.source][e.id.key]+"_"+t[e.edges.target][e.id.key],t.d3plus.id}),A=n.filter(function(t){if(t.d3plus&&t.d3plus.spline){if(t.d3plus||(t.d3plus={}),k){var a=t[e.edges.size];t.d3plus.bucket=a<k[1]?0:a<k[2]?1:2;var l=.85*g[t.d3plus.bucket]/r}else{delete t.d3plus.bucket;var l=.85*g/r}var s=t[e.edges.source],i=t[e.edges.target],n=2==s.d3plus.depth?-l:l,o=2==i.d3plus.depth?-l:l,d="source"==_&&e.edges.arrows.value?s.d3plus.r+n:s.d3plus.r,u="target"==_&&e.edges.arrows.value?i.d3plus.r+o:i.d3plus.r;return s.d3plus.dr=d,i.d3plus.dr=u,console.log(i.id,i.d3plus),!0}return!1}),E=e.g.edges.selectAll("g.d3plus_edge_path").data(A,function(t){return t.d3plus||(t.d3plus={}),t.d3plus.id=t[e.edges.source][e.id.key]+"_"+t[e.edges.target][e.id.key],t.d3plus.id});e.timing?(z.exit().transition().duration(e.timing).attr("opacity",0).remove(),E.exit().transition().duration(e.timing).attr("opacity",0).remove(),z.selectAll("text.d3plus_label, rect.d3plus_label_bg").transition().duration(e.timing/2).attr("opacity",0).remove(),E.selectAll("text.d3plus_label, rect.d3plus_label_bg").transition().duration(e.timing/2).attr("opacity",0).remove(),z.selectAll("line").transition().duration(e.timing).call(l).call(a).each("end",i),E.selectAll("path").transition().duration(e.timing).call(s).call(a).each("end",i),z.enter().append("g").attr("class","d3plus_edge_line").append("line").call(l).call(t).transition().duration(e.timing).call(a).each("end",i),E.enter().append("g").attr("class","d3plus_edge_path").append("path").call(s).call(t).transition().duration(e.timing).call(a).each("end",i)):(z.exit().remove(),E.exit().remove(),z.selectAll("text.d3plus_label, rect.d3plus_label_bg").remove(),E.selectAll("text.d3plus_label, rect.d3plus_label_bg").remove(),z.selectAll("line").call(l).call(a).call(i),E.selectAll("path").call(s).call(a).call(i),z.enter().append("g").attr("class","d3plus_edge_line").append("line").call(l).call(t).call(a).call(i),E.enter().append("g").attr("class","d3plus_edge_path").append("path").call(s).call(t).call(a).call(i)),e.g.edges.selectAll("g").sort(function(t,a){var t=e.connected(t),a=e.connected(a);return t-a})},d3plus.shape.fill=function(e,t){function a(e){e.attr("x",0).attr("y",0).attr("width",0).attr("height",0)}function l(t,a){if(!a)var a=0;t.attr("x",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return-t/2-a/2}).attr("y",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return-t/2-a/2}).attr("width",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return t+a}).attr("height",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return t+a}).attr("rx",function(t){var l=t.d3plus.r?2*t.d3plus.r:t.d3plus.width,s=["circle","donut"].indexOf(e.shape.value)>=0;return s?(l+a)/2:0}).attr("ry",function(t){var l=t.d3plus.r?2*t.d3plus.r:t.d3plus.height,s=["circle","donut"].indexOf(e.shape.value)>=0;return s?(l+a)/2:0}).attr("shape-rendering",function(){return["square"].indexOf(e.shape.value)>=0?e.style.rendering:"auto"})}function s(t,a,l,s){if(!a)var a=0;if("number"!=typeof l)var l=void 0;
if("number"!=typeof s)var s=void 0;t.attrTween("d",function(t){if(void 0==l)var n=t.d3plus.r?t.d3plus.r:d3.max([t.d3plus.width,t.d3plus.height]);else var n=l;if(void 0==s)var r=t.d3plus.a[t.d3plus.shapeType];else var r=s;e.arcs[t.d3plus.shapeType][t.d3plus.id]||(e.arcs[t.d3plus.shapeType][t.d3plus.id]={r:0},e.arcs[t.d3plus.shapeType][t.d3plus.id].a="donut"==t.d3plus.shapeType?2*Math.PI:0);var o=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].r,n+a),d=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].a,r);return function(a){return e.arcs[t.d3plus.shapeType][t.d3plus.id].r=o(a),e.arcs[t.d3plus.shapeType][t.d3plus.id].a=d(a),i(t)}})}e.arcs||(e.arcs={donut:{},active:{},temp:{}});var i=d3.svg.arc().startAngle(0).endAngle(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].a;return a>2*Math.PI?2*Math.PI:a}).innerRadius(function(t){if("donut"!=shape||t.d3plus.static)return 0;var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return a*e.style.data.donut.size}).outerRadius(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return"donut"!=t.d3plus.shapeType?2*a:a});t.each(function(t){function i(t){t.attr("stroke",u).attr("stroke-width",1).attr("shape-rendering",e.style.rendering)}var n=e.active.key?t.d3plus[e.active.key]:t.d3plus.active,r=e.temp.key?t.d3plus[e.temp.key]:t.d3plus.temp,o=e.total.key?t.d3plus[e.total.key]:t.d3plus.total,d=d3.select(this),u=d3plus.variable.color(e,t),p=[],c=[];if(o&&d3plus.apps[e.type.value].fill){if(r){var f=d3plus.util.copy(t);f.d3plus.shapeType="temp",p.push(f),c=["temp"]}if(n&&(o>n||r)){var f=d3plus.util.copy(t);f.d3plus.shapeType="active",p.push(f)}}var v=e.defs.selectAll("pattern#d3plus_hatch_"+t.d3plus.id).data(c);e.timing?(v.selectAll("rect").transition().duration(e.timing).style("fill",u),v.selectAll("line").transition().duration(e.timing).style("stroke",u)):(v.selectAll("rect").style("fill",u),v.selectAll("line").style("stroke",u));var g=v.enter().append("pattern").attr("id","d3plus_hatch_"+t.d3plus.id).attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","10").attr("height","10").append("g");g.append("rect").attr("x","0").attr("y","0").attr("width","10").attr("height","10").attr("fill",u).attr("fill-opacity",.25),g.append("line").attr("x1","0").attr("x2","10").attr("y1","0").attr("y2","10").call(i),g.append("line").attr("x1","-1").attr("x2","1").attr("y1","9").attr("y2","11").call(i),g.append("line").attr("x1","9").attr("x2","11").attr("y1","-1").attr("y2","1").call(i);var h=p.length?[t]:[],y=d.selectAll("#d3plus_clip_"+t.d3plus.id).data(h);y.enter().insert("clipPath",".d3plus_mouse").attr("id","d3plus_clip_"+t.d3plus.id).append("rect").attr("class","d3plus_clipping").call(a),e.timing?(y.selectAll("rect").transition().duration(e.timing).call(l),y.exit().transition().delay(e.timing).remove()):(y.selectAll("rect").call(l),y.exit().remove());var m=d.selectAll("path.d3plus_fill").data(p);m.transition().duration(e.timing).call(d3plus.shape.style,e).call(s),m.enter().insert("path","rect.d3plus_mouse").attr("class","d3plus_fill").attr("clip-path","url(#d3plus_clip_"+t.d3plus.id+")").transition().duration(0).call(s,0,void 0,0).call(d3plus.shape.style,e).transition().duration(e.timing).call(s),m.exit().transition().duration(e.timing).call(s,0,void 0,0).remove()})},d3plus.shape.labels=function(e,t){var a=e.zoom_behavior.scaleExtent(),l=function(t){t.attr("opacity",function(t){if(!t)var t={scale:a[1]};var l=parseFloat(d3.select(this).attr("font-size"),10);return t.visible=l/t.scale*e.zoom.scale>=7,t.visible?1:0})};remove=function(t){e.timing?t.transition().duration(e.timing).attr("opacity",0).remove():t.remove()},style=function(t,l){function s(t){var l=t.anchor||e.style.labels.align,s="tspan"==this.tagName,i=s?"d3plus_share"==this.parentNode.className.baseVal:"d3plus_share"==this.className.baseVal,n=d3.select(this).node().getComputedTextLength()/a[1];if("middle"==l||i)var r=t.x-n/2;else if("end"==l&&!d3plus.rtl||"start"==l&&d3plus.rtl)var r=t.x+(t.w-t.padding)/2-n;else var r=t.x-(t.w-t.padding)/2;if(s){var o=this.getComputedTextLength()/a[1];"middle"==l?d3plus.rtl?r-=(n-o)/2:r+=(n-o)/2:"end"==l&&(d3plus.rtl?r-=n-o:r+=n-o)}return d3plus.rtl&&(r+=n),r*a[1]}function i(t){if(d3.select(this).select("tspan").empty())return 0;var l=e.style.labels.align,s=d3.select(this).node().getBBox().height/a[1],i=parseFloat(d3.select(this).style("font-size"),10)/5/a[1];if("d3plus_share"==this.className.baseVal){var n=d3.select(this.parentNode).datum(),r=n.d3plus.r?2*n.d3plus.r:n.d3plus.height;if(r/=a[1],"end"==l)var o=t.y-r/2+i/2;else var o=t.y+r/2-s-i/2}else if("middle"==l||"center"==t.valign)var o=t.y-s/2-i/2;else if("end"==l)var o=t.y+(t.h-t.padding)/2-s+i/2;else var o=t.y-(t.h-t.padding)/2-i;return o*a[1]}t.attr("font-weight",e.style.labels.font.weight).attr("font-family",e.style.labels.font.family).attr("text-anchor","start").attr("pointer-events",function(e){return e.mouse?"auto":"none"}).attr("fill",function(t){return t.color?t.color:d3plus.color.text(d3plus.shape.color(t.parent,e))}).attr("x",s).attr("y",i),l&&t.each(function(t){if(t.resize instanceof Array)var a=t.resize[0],l=t.resize[1];if(t.text){if(!(t.resize instanceof Array))var a=8,l=70;d3plus.util.wordwrap({text:e.format(100*t.text,"share")+"%",parent:this,width:t.w*t.scale-t.padding,height:t.h*t.scale-t.padding,resize:t.resize,font_min:a/t.scale,font_max:l*t.scale})}else{if("middle"!=e.style.labels.align)var s=t.h-t.share;else var s=t.h;if(!(t.resize instanceof Array))var a=8,l=40;d3plus.util.wordwrap({text:t.names,parent:this,width:t.w*t.scale-t.padding,height:s*t.scale-t.padding,resize:t.resize,font_min:a/t.scale,font_max:l*t.scale})}}).attr("x",s).attr("y",i),t.attr("transform",function(e){var t=e.angle||0,l=e.translate&&e.translate.x||0,s=e.translate&&e.translate.y||0;return"rotate("+t+","+l+","+s+")scale("+1/a[1]+")"}).selectAll("tspan").attr("x",s)},e.labels.value?t.each(function(t){function s(t){var l="transparent"==e.style.background?"#ffffff":e.style.background,s="string"==typeof label.background?label.background:l,i=label.angle||0,n=label.translate?f.x+f.width/2:0,r=label.translate?f.y+f.height/2:0,o="scale("+1/a[1]+")rotate("+i+","+n+","+r+")";t.attr("fill",s).attr(f).attr("transform",o)}var i=t.d3plus&&"label"in t.d3plus&&!t.d3plus.label,n=t.d3plus&&"static"in t.d3plus&&t.d3plus.static;if(label=t.d3plus_label?t.d3plus_label:e.zoom.labels?e.zoom.labels[t.d3plus.id]:null,share=t.d3plus_share,names=label&&label.names?label.names:d3plus.variable.text(e,t),group=label&&"group"in label?label.group:d3.select(this),share_size=0,fill=d3plus.apps[e.type.value].fill,label)if(["line","area"].indexOf(e.shape.value)>=0)var r=!0;else if(t&&"d3plus"in t)var o=e.active.key?t.d3plus[e.active.key]:t.d3plus.active,d=e.temp.key?t.d3plus[e.temp.key]:t.d3plus.temp,u=e.total.key?t.d3plus[e.total.key]:t.d3plus.total,r=!d&&!o||o==u;if(i||!r&&fill||n)delete t.d3plus_label,group.selectAll("text#d3plus_label_"+t.d3plus.id+", rect#d3plus_label_bg_"+t.d3plus.id).call(remove);else{if(share&&t.d3plus.share&&"middle"!=e.style.labels.align){share.resize=e.labels.resize.value===!1?!1:share&&"resize"in share?share.resize:!0,share.scale=share.resize?a[1]:a[0],share.padding=e.style.labels.padding/share.scale*2,share.text=t.d3plus.share,share.parent=t;var p=group.selectAll("text#d3plus_share_"+t.d3plus.id).data([share],function(e){return e.w+""+e.h+e.text});e.timing?(p.transition().duration(e.timing/2).call(style),p.enter().append("text").attr("font-size",e.style.labels.font.size*share.scale).attr("id","d3plus_share_"+t.d3plus.id).attr("class","d3plus_share").attr("opacity",0).call(style,!0).transition().duration(e.timing/2).delay(e.timing/2).attr("opacity",.5)):(p.attr("opacity",.5).call(style),p.enter().append("text").attr("font-size",e.style.labels.font.size*share.scale).attr("id","d3plus_share_"+t.d3plus.id).attr("class","d3plus_share").attr("opacity",.5).call(style,!0)),share_size=p.node().getBBox().height,p.exit().call(remove)}else group.selectAll("text.d3plus_share").call(remove);if(label&&(label.resize=e.labels.resize.value===!1?!1:label&&"resize"in label?label.resize:!0,label.scale=label.resize?a[1]:a[0],label.padding=e.style.labels.padding/label.scale*2),label&&label.w*label.scale-label.padding>=20&&label.h*label.scale-label.padding>=10&&names.length){label.names=names,label.share=share_size,label.parent=t;var p=group.selectAll("text#d3plus_label_"+t.d3plus.id).data([label],function(e){return e?e.w+"_"+e.h+"_"+e.x+"_"+e.y+"_"+e.names.join("_"):!1});if(e.timing?(p.transition().duration(e.timing/2).call(style),p.enter().append("text").attr("font-size",e.style.labels.font.size*label.scale).attr("id","d3plus_label_"+t.d3plus.id).attr("class","d3plus_label").attr("opacity",0).call(style,!0).transition().duration(e.timing/2).delay(e.timing/2).call(l)):(p.attr("opacity",1).call(style),p.enter().append("text").attr("font-size",e.style.labels.font.size*label.scale).attr("id","d3plus_label_"+t.d3plus.id).attr("class","d3plus_label").call(style,!0).call(l)),p.exit().call(remove),0==p.size()||""==p.html())delete t.d3plus_label,group.selectAll("text.d3plus_label, rect.d3plus_label_bg").call(remove);else{if(label.background){var c=["background"],f=p.node().getBBox();f.width+=e.style.labels.padding*a[0],f.height+=e.style.labels.padding*a[0],f.x-=e.style.labels.padding*a[0]/2,f.y-=e.style.labels.padding*a[0]/2}else var c=[],f={};var v=group.selectAll("rect#d3plus_label_bg_"+t.d3plus.id).data(c),g="number"==typeof label.background?label.background:.6;e.timing?(v.exit().transition().duration(e.timing).attr("opacity",0).remove(),v.transition().duration(e.timing).attr("opacity",g).call(s),v.enter().insert("rect",".d3plus_label").attr("id","d3plus_label_bg_"+t.d3plus.id).attr("class","d3plus_label_bg").attr("opacity",0).call(s).transition().duration(e.timing).attr("opacity",g)):(v.exit().remove(),v.enter().insert("rect",".d3plus_label").attr("id","d3plus_label_bg_"+t.d3plus.id).attr("class","d3plus_label_bg"),v.attr("opacity",g).call(s))}}else delete t.d3plus_label,group.selectAll("text#d3plus_label_"+t.d3plus.id+", rect#d3plus_label_bg_"+t.d3plus.id).call(remove)}}):(t.selectAll("text.d3plus_label, rect.d3plus_label_bg").call(remove),e.g.labels.selectAll("text.d3plus_label, rect.d3plus_label_bg").call(remove))},d3plus.shape.line=function(e,t){function a(e){e.attr("x",function(e){return e.d3plus.x}).attr("y",function(e){return e.d3plus.y}).attr("width",0).attr("height",0)}function l(e,t){if(!t)var t=0;e.attr("x",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return e.d3plus.x-(a/2+t/2)}).attr("y",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return e.d3plus.y-(a/2+t/2)}).attr("width",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return a+t}).attr("height",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return a+t}).attr("rx",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return(a+t)/2}).attr("ry",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return(a+t)/2})}var s=d3.svg.line().x(function(e){return e.d3plus.x}).y(function(e){return e.d3plus.y}).interpolate(e.shape.interpolate.value),i=e.style.data.stroke.width;30>i&&(i=30),t.each(function(t){var n=!1,r=[],o=[],d=d3plus.util.copy(t),u=d3.select(this);d.values=[],t.values.forEach(function(a,l,s){o.push(a);var i=a[e[e.continuous_axis].key],u=e.tickValues[e.continuous_axis].indexOf(i);n===!1&&(n=u),l+n==u?(d.values.push(a),d.key+="_"+r.length):(l>0&&(r.push(d),d=d3plus.util.copy(t),d.values=[]),d.values.push(a),d.key+="_"+r.length,n++),l==s.length-1&&r.push(d)});var p=u.selectAll("path.d3plus_line").data(r,function(e){return e.key}),c=u.selectAll("rect.d3plus_anchor").data(o,function(e){return e.d3plus.id});e.timing?(p.transition().duration(e.timing).attr("d",function(e){return s(e.values)}).call(d3plus.shape.style,e),p.enter().append("path").attr("class","d3plus_line").attr("d",function(e){return s(e.values)}).call(d3plus.shape.style,e),c.enter().append("rect").attr("class","d3plus_anchor").attr("id",function(e){return e.d3plus.id}).call(a).call(d3plus.shape.style,e),c.transition().duration(e.timing).call(l).call(d3plus.shape.style,e),c.exit().transition().duration(e.timing).call(a).remove()):(p.enter().append("path").attr("class","d3plus_line"),p.attr("d",function(e){return s(e.values)}).call(d3plus.shape.style,e),c.enter().append("rect").attr("class","d3plus_anchor").attr("id",function(e){return e.d3plus.id}),c.call(l).call(d3plus.shape.style,e));var f=u.selectAll("path.d3plus_mouse").data(r,function(e){return e.key});f.enter().append("path").attr("class","d3plus_mouse").attr("d",function(e){return s(e.values)}).style("stroke","black").style("stroke-width",i).style("fill","none").style("stroke-linecap","round").attr("opacity",0),f.on(d3plus.evt.over,function(){if(!e.frozen){var a=d3.event[e.continuous_axis];positions=d3plus.util.uniques(t.values,function(t){return t.d3plus[e.continuous_axis]}),closest=d3plus.util.closest(positions,a);var s=d3.select(this.parentNode).datum();s.data=t.values[positions.indexOf(closest)],s.d3plus=t.values[positions.indexOf(closest)].d3plus,d3.select(this.parentNode).selectAll("path.d3plus_line").transition().duration(e.style.timing.mouseevents).style("stroke-width",2*e.style.data.stroke.width),d3.select(this.parentNode).selectAll("rect").transition().duration(e.style.timing.mouseevents).style("stroke-width",2*e.style.data.stroke.width).call(l,2)}}).on(d3plus.evt.move,function(t){if(!e.frozen){var a=d3.event.x,l=d3plus.util.uniques(t.values,function(e){return e.d3plus.x}),s=d3plus.util.closest(l,a),i=d3.select(this.parentNode).datum();i.data=t.values[l.indexOf(s)],i.d3plus=t.values[l.indexOf(s)].d3plus}}).on(d3plus.evt.out,function(){if(!e.frozen){d3.select(this.parentNode).selectAll("path.d3plus_line").transition().duration(e.style.timing.mouseevents).style("stroke-width",e.style.data.stroke.width),d3.select(this.parentNode).selectAll("rect").transition().duration(e.style.timing.mouseevents).style("stroke-width",e.style.data.stroke.width).call(l);var t=d3.select(this.parentNode).datum();delete t.data,delete t.d3plus}}),e.timing?f.transition().duration(e.timing).attr("d",function(e){return s(e.values)}).style("stroke-width",i):f.attr("d",function(e){return s(e.values)}).style("stroke-width",i),f.exit().remove()})},d3plus.shape.rect=function(e,t,a,l){function s(t){if(e.labels.value&&!t.d3plus.label){t.d3plus_label={w:0,h:0,x:0,y:0};var a=t.d3plus.r?2*t.d3plus.r:t.d3plus.width,l=t.d3plus.r?2*t.d3plus.r:t.d3plus.height;"square"==e.shape.value?(t.d3plus_share={w:a,h:l/4,x:0,y:0},t.d3plus_label.w=a,t.d3plus_label.h=l):(t.d3plus_label.w=Math.sqrt(.8*Math.pow(a,2)),t.d3plus_label.h=Math.sqrt(.8*Math.pow(l,2)))}else t.d3plus.label&&(t.d3plus_label=t.d3plus.label);return[t]}function i(e){e.attr("x",0).attr("y",0).attr("width",0).attr("height",0)}function n(t){t.attr("x",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return-t/2}).attr("y",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return-t/2}).attr("width",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return t}).attr("height",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return t}).attr("rx",function(t){var a="circle"==e.shape.value,l=t.d3plus.r?2*t.d3plus.r:t.d3plus.width;return a?(l+2)/2:0}).attr("ry",function(t){var a="circle"==e.shape.value,l=t.d3plus.r?2*t.d3plus.r:t.d3plus.height;return a?(l+2)/2:0}).attr("transform",function(e){return"rotate"in e.d3plus?"rotate("+e.d3plus.rotate+")":""}).attr("shape-rendering",function(t){return"square"!=e.shape.value||"rotate"in t.d3plus?"auto":e.style.rendering})}e.timing?a.append("rect").attr("class","d3plus_data").call(i).call(d3plus.shape.style,e):a.append("rect").attr("class","d3plus_data"),e.timing?t.selectAll("rect.d3plus_data").data(s).transition().duration(e.timing).call(n).call(d3plus.shape.style,e):t.selectAll("rect.d3plus_data").data(s).call(n).call(d3plus.shape.style,e),e.timing&&l.selectAll("rect.d3plus_data").transition().duration(e.timing).call(i)},d3plus.shape.style=function(e,t){e.attr("fill",function(e){return e.d3plus&&e.d3plus.spline?"none":d3plus.shape.color(e,t)}).style("stroke",function(e){if(e.values)var a=d3plus.shape.color(e.values[0],t);else var a=d3plus.shape.color(e,t);return d3plus.color.legible(a)}).style("stroke-width",t.style.data.stroke.width).attr("opacity",t.style.data.opacity).attr("vector-effect","non-scaling-stroke")},d3plus.styles.default={background:"#ffffff",color:{heatmap:["#27366C","#7B91D3","#9ED3E3","#F3D261","#C9853A","#D74B03"],missing:"#eeeeee",range:["#D74B03","#eeeeee","#94B153"]},data:{donut:{size:.35},opacity:.9,stroke:{width:1}},edges:{arrows:8,color:"#d0d0d0",opacity:1,width:1},footer:{font:{align:"center",color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:10,transform:"none",weight:200},padding:5,position:"bottom"},font:{color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],transform:"none",weight:200},group:{background:!0},highlight:{focus:"#444444",primary:"#D74B03",secondary:"#E5B3BB"},labels:{align:"middle",padding:7,segments:2,font:{decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:12,transform:"none",weight:200}},legend:{align:"middle",gradient:{height:10},label:{color:"#444",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],weight:200,size:12},size:[10,30],tick:{align:"middle",color:"#444",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],weight:200,size:10}},link:{font:{color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],transform:"none",weight:200},hover:{font:{color:"#444",decoration:"underline",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],transform:"none",weight:200}}},message:{font:{color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:18,transform:"none",weight:200},opacity:.75,padding:10},rendering:"crispEdges",ticks:{color:"#ccc",font:{color:"#888",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:12,transform:"none",weight:200},size:10,width:1},timeline:{align:"middle",background:"#eeeeee",brush:{color:"#fff",opacity:1},handles:{color:"#E5E5E5",hover:"#fff",opacity:1,size:3,stroke:"#ccc"},height:20,label:{color:"#444",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],weight:200,size:12},tick:{align:"middle",color:"#E5E5E5",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],weight:200,size:10}},timing:{mouseevents:60,transitions:600},title:{font:{align:"center",color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:18,transform:"none",weight:200},height:null,padding:2,position:"top",sub:{font:{align:"center",color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:13,transform:"none",weight:200},padding:1,position:"top"},total:{font:{align:"center",color:"#444",decoration:"none",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:13,transform:"none",weight:200},padding:1,position:"top"},width:null},tooltip:{anchor:"top center",background:"white",curtain:{color:"#ffffff",opacity:.8},font:{color:"#444",family:["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],size:12,transform:"none",weight:200},large:250,small:200},ui:{padding:5}},d3plus.tooltip.app=function(e){function t(t){if(l.d3plus){l.d3plus.merged&&(s||(s={}),s.items=l.d3plus.merged.length);var c=a.active.key?d3plus.variable.value(a,l,a.active.key):l.d3plus.active,f=a.temp.key?d3plus.variable.value(a,l,a.temp.key):l.d3plus.temp,v=a.total.key?d3plus.variable.value(a,l,a.total.key):l.d3plus.total;if("number"==typeof c&&c>0&&v){s||(s={});var g=a.active.key||"active";s[g]=c+"/"+v+" ("+a.format(c/v*100,"share")+"%)"}if("number"==typeof f&&f>0&&v){s||(s={});var g=a.temp.key||"temp";s[g]=f+"/"+v+" ("+a.format(f/v*100,"share")+"%)"}l.d3plus.share&&(s||(s={}),s.share=a.format(100*l.d3plus.share,"share")+"%")}var h="depth"in e?e.depth:a.depth.value,k=d3plus.variable.text(a,l,h)[0],_=d3plus.variable.value(a,l,a.icon.key,a.id.nesting[h]),w=d3plus.tooltip.data(a,l,p,s,h);if(w.length>0||y||!l.d3plus_label&&"short"==p||l.d3plus_label&&"visible"in l.d3plus_label&&!l.d3plus_label.visible){k||(k=r);var h=l.d3plus&&"depth"in l.d3plus?a.id.nesting[l.d3plus.depth]:a.id.key;if("string"==typeof a.icon.style.value)var z=a.icon.style.value;else if("object"==typeof a.icon.style.value&&a.icon.style.value[h])var z=a.icon.style.value[h];else var z="default";if(e.width)var A=e.width;else if(d||0!=w.length)var A=a.style.tooltip.small;else var A="auto";d3plus.tooltip.create({align:u,arrow:n,background:a.style.tooltip.background,curtain:a.style.tooltip.curtain.color,curtainopacity:a.style.tooltip.curtain.opacity,fontcolor:a.style.tooltip.font.color,fontfamily:a.style.tooltip.font.family,fontsize:a.style.tooltip.font.size,fontweight:a.style.tooltip.font.weight,data:w,color:d3plus.variable.color(a,l),footer:y,fullscreen:d,html:t,icon:_,id:o,max_height:e.maxheight,max_width:a.style.tooltip.small,mouseevents:i,offset:b,parent:a.parent,style:z,title:k,width:A,x:m,y:x})}}var a=e.vars,l=e.data,s=e.ex,i=e.mouseevents?e.mouseevents:!1,n="arrow"in e?e.arrow:!0,r=d3plus.variable.value(a,l,a.id.key),o=e.id||a.type.value;if(!d3.event||"click"!=d3.event.type||!a.html.value&&!a.tooltip.value.long||"fullscreen"in e){var d=!1,u=e.anchor||a.style.tooltip.anchor,p=e.length||"short",c=a.zoom_direction();if(-1===c)var f=a.id.nesting[a.depth.value-1],v=d3plus.variable.value(a,r,f),g=a.id.solo.value.indexOf(v)>=0;if(1===c&&a.zoom.value)var h=a.format("Click to Expand");else if(-1===c&&a.zoom.value&&g)var h=a.format("Click to Collapse");else if("short"==p&&(a.html.value||a.tooltip.value.long)&&a.focus.value!=r)var h="Click for More Info";else var h=a.footer.value||"";var y=h.length?a.format(h,"footer"):!1}else{var d=!0,n=!1,i=!0,p="long",y=a.footer.value;a.covered=!0}if("x"in e)var m=e.x;else if("follow"==d3plus.apps[a.type.value].tooltip)var m=d3.mouse(a.parent.node())[0];else{var m=l.d3plus.x;a.zoom.translate&&a.zoom.scale&&(m=a.zoom.translate[0]+m*a.zoom.scale),m+=a.margin.left}if("y"in e)var x=e.y;else if("follow"==d3plus.apps[a.type.value].tooltip)var x=d3.mouse(a.parent.node())[1];else{var x=l.d3plus.y;a.zoom.translate&&a.zoom.scale&&(x=a.zoom.translate[1]+x*a.zoom.scale),x+=a.margin.top}if("offset"in e)var b=e.offset;else if("follow"==d3plus.apps[a.type.value].tooltip)var b=3;else{var b=l.d3plus.r?l.d3plus.r:l.d3plus.height/2;a.zoom.scale&&(b*=a.zoom.scale)}d?"string"==typeof a.html.value?t(a.html.value):"function"==typeof a.html.value?t(a.html.value(r)):a.html.value&&"object"==typeof a.html.value&&a.html.value.url?d3.json(a.html.value.url,function(e){var l=a.html.value.callback?a.html.value.callback(e):e;t(l)}):t(""):t("")},d3plus.tooltip.arrow=function(e){e.style("bottom",function(e){return"center"==e.anchor.y||e.flip?"auto":"-5px"}).style("top",function(e){return"center"!=e.anchor.y&&e.flip?"-5px":"center"==e.anchor.y?"50%":"auto"}).style("left",function(e){return"center"==e.anchor.y&&e.flip?"-5px":"center"!=e.anchor.y?"50%":"auto"}).style("right",function(e){return"center"!=e.anchor.y||e.flip?"auto":"-5px"}).style("margin-left",function(e){if("center"==e.anchor.y)return"auto";if("right"==e.anchor.x)var t=-e.width/2+e.arrow_offset/2;else if("left"==e.anchor.x)var t=e.width/2-2*e.arrow_offset-5;else var t=-5;if(e.cx-e.width/2-5<t)t=e.cx-e.width/2-5,t<2-e.width/2&&(t=2-e.width/2);else if(-(e.limit[0]-e.cx-e.width/2+5)>t){var t=-(e.limit[0]-e.cx-e.width/2+5);t>e.width/2-11&&(t=e.width/2-11)}return t+"px"}).style("margin-top",function(e){if("center"!=e.anchor.y)return"auto";if("bottom"==e.anchor.y)var t=-e.height/2+e.arrow_offset/2-1;else if("top"==e.anchor.y)var t=e.height/2-2*e.arrow_offset-2;else var t=-9;if(e.cy-e.height/2-e.arrow_offset<t)t=e.cy-e.height/2-e.arrow_offset,t<4-e.height/2&&(t=4-e.height/2);else if(-(e.limit[1]-e.cy-e.height/2+e.arrow_offset)>t){var t=-(e.limit[1]-e.cy-e.height/2+e.arrow_offset);t>e.height/2-22&&(t=e.height/2-22)}return t+"px"})},d3plus.tooltip.create=function(e){var t=e.fullscreen?250:200;e.width=e.width||t,e.max_width=e.max_width||386,e.id=e.id||"default",e.size=e.fullscreen||e.html?"large":"small",e.offset=e.offset||0,e.arrow_offset=e.arrow?8:0,e.x=e.x||0,e.y=e.y||0,e.color=e.color||"#333",e.parent=e.parent||d3.select("body"),e.curtain=e.curtain||"#fff",e.curtainopacity=e.curtainopacity||.8,e.background=e.background||"#fff",e.fontcolor=e.fontcolor||"#333",e.fontfamily=e.fontfamily||"sans-serif",e.fontweight=e.fontweight||"normal",e.fontsize=e.fontsize||"12px",e.style=e.style||"default",e.zindex="small"==e.size?2e3:500,e.iconsize||(e.iconsize="small"==e.size?22:50),e.limit=[parseFloat(e.parent.style("width"),10),parseFloat(e.parent.style("height"),10)];var a=function(){d3.selectAll("div.d3plus_tooltip_data_desc").style("height","0px"),d3.selectAll("div.d3plus_tooltip_data_help").style("background-color","#ccc")};if(d3plus.tooltip.remove(e.id),e.anchor={},e.fullscreen)e.anchor.x="center",e.anchor.y="center",e.x=e.parent?e.parent.node().offsetWidth/2:window.innerWidth/2,e.y=e.parent?e.parent.node().offsetHeight/2:window.innerHeight/2;else if(e.align){var l=e.align.split(" ");e.anchor.y=l[0],e.anchor.x=l[1]?l[1]:"center"}else e.anchor.x="center",e.anchor.y="top";var s=e.width-30;if(e.fullscreen){e.parent.append("div").attr("id","d3plus_tooltip_curtain_"+e.id).attr("class","d3plus_tooltip_curtain").style("background-color",e.curtain).style("opacity",e.curtainopacity).style("position","absolute").style("z-index",499).style("top","0px").style("right","0px").style("bottom","0px").style("left","0px").on(d3plus.evt.click,function(){d3plus.tooltip.remove(e.id)})}var i=e.parent.append("div").datum(e).attr("id","d3plus_tooltip_id_"+e.id).attr("class","d3plus_tooltip d3plus_tooltip_"+e.size).style("color",e.fontcolor).style("font-family",e.fontfamily).style("font-weight",e.fontweight).style("font-size",e.fontsize+"px").style("position","absolute").style("z-index",e.zindex).on(d3plus.evt.out,function(){a()});e.max_height&&i.style("max-height",e.max_height+"px"),e.fixed?(i.style("z-index",500),e.mouseevents=!0):i.style("z-index",2e3);var n=i.append("div").datum(e).attr("class","d3plus_tooltip_container").style("background-color",e.background);if(e.fullscreen&&e.html){o=e.parent?.75*e.parent.node().offsetWidth:.75*window.innerWidth,k=e.parent?.75*e.parent.node().offsetHeight:.75*window.innerHeight,n.style("width",o+"px").style("height",k+"px");var r=n.append("div").attr("class","d3plus_tooltip_body").style("display","inline-block").style("z-index",1).style("width",e.width+"px")}else{if("auto"==e.width){var o="auto";n.style("max-width",e.max_width+"px")}else var o=e.width-14+"px";var r=n.style("width",o)}if(e.title||e.icon)var d=r.append("div").attr("class","d3plus_tooltip_header").style("position","relative").style("z-index",1);if(e.fullscreen){i.append("div").attr("class","d3plus_tooltip_close").style("background-color",e.color).style("color",d3plus.color.text(e.color)).style("position","absolute").html("&times;").on(d3plus.evt.click,function(){d3plus.tooltip.remove(e.id)})}if(e.mouseevents){if(e.mouseevents!==!0){var u=d3.select(e.mouseevents).on(d3plus.evt.out),p=function(){var t=d3.event.toElement||d3.event.relatedTarget;if(t)var l="string"==typeof t.className?t.className:t.className.baseVal,s=0==l.indexOf("d3plus_tooltip");else var s=!1;t&&(c(i.node(),t)||c(e.mouseevents,t)||s)||(u(d3.select(e.mouseevents).datum()),a(),d3.select(e.mouseevents).on(d3plus.evt.out,u))},c=function(e,t){for(var a=t.parentNode;null!=a;){if(a==e)return!0;a=a.parentNode}return!1};d3.select(e.mouseevents).on(d3plus.evt.out,p),i.on(d3plus.evt.out,p);var f=d3.select(e.mouseevents).on(d3plus.evt.move);f&&i.on(d3plus.evt.move,f)}}else i.style("pointer-events","none");if(e.arrow){i.append("div").attr("class","d3plus_tooltip_arrow").style("background-color",e.background).style("position","absolute")}if(e.icon){var v=d.append("div").attr("class","d3plus_tooltip_icon").style("width",e.iconsize+"px").style("height",e.iconsize+"px").style("z-index",1).style("background-position","50%").style("background-size","100%").style("background-image","url("+e.icon+")").style("display","inline-block");"knockout"==e.style&&v.style("background-color",e.color),s-=v.node().offsetWidth}if(e.title){var g=e.max_width-6;e.icon&&(g-=e.iconsize+6),g+="px";{d.append("div").attr("class","d3plus_tooltip_title").style("max-width",g).style("vertical-align","top").style("width",s+"px").style("display","inline-block").style("overflow","hidden").style("text-overflow","ellipsis").style("word-wrap","break-word").style("z-index",1).text(e.title)}}if(e.description){r.append("div").attr("class","d3plus_tooltip_description").text(e.description)}if(e.data||e.html&&!e.fullscreen)var h=r.append("div").attr("class","d3plus_tooltip_data_container");if(e.data){var y=0,m={},x=null;e.data.forEach(function(t,l){t.group&&x!=t.group&&(x=t.group,h.append("div").attr("class","d3plus_tooltip_data_title").text(t.group));var s=h.append("div").attr("class","d3plus_tooltip_data_block").datum(t);t.highlight&&s.style("color",d3plus.color.legible(e.color));var i=s.append("div").attr("class","d3plus_tooltip_data_name").html(t.name).on(d3plus.evt.out,function(){d3.event.stopPropagation()}),n=s.append("div").attr("class","d3plus_tooltip_data_value").text(t.value).on(d3plus.evt.out,function(){d3.event.stopPropagation()});if(d3plus.rtl?n.style("left","6px"):n.style("right","6px"),e.mouseevents&&t.desc){var r=s.append("div").attr("class","d3plus_tooltip_data_desc").text(t.desc).on(d3plus.evt.out,function(){d3.event.stopPropagation()}),o=r.node().offsetHeight;r.style("height","0px");var d=i.append("div").attr("class","d3plus_tooltip_data_help").text("?").on(d3plus.evt.over,function(){var e=d3.select(this.parentNode.parentNode).style("color");d3.select(this).style("background-color",e),r.style("height",o+"px")}).on(d3plus.evt.out,function(){d3.event.stopPropagation()});i.style("cursor","pointer").on(d3plus.evt.over,function(){a();var e=d3.select(this.parentNode).style("color");d.style("background-color",e),r.style("height",o+"px")}),s.on(d3plus.evt.out,function(){d3.event.stopPropagation(),a()})}var u=parseFloat(n.style("width"),10);u>e.width/2&&(u=e.width/2),u>y&&(y=u),l!=e.data.length-1&&(t.group&&t.group==e.data[l+1].group||!t.group&&!e.data[l+1].group)&&h.append("div").attr("class","d3plus_tooltip_data_seperator")}),h.selectAll(".d3plus_tooltip_data_name").style("width",function(){var e=parseFloat(d3.select(this.parentNode).style("width"),10);return e-y-30+"px"}),h.selectAll(".d3plus_tooltip_data_value").style("width",y+"px").each(function(e){var t=parseFloat(d3.select(this).style("height"),10);m[e.name]=t}),h.selectAll(".d3plus_tooltip_data_name").style("min-height",function(e){return m[e.name]+"px"})}e.html&&!e.fullscreen&&h.append("div").html(e.html);var b=r.append("div").attr("class","d3plus_tooltip_footer");if(e.footer&&b.html(e.footer),e.height=i.node().offsetHeight,e.html&&e.fullscreen){var k=e.height-12,o=i.node().offsetWidth-e.width-44;n.append("div").attr("class","d3plus_tooltip_html").style("width",o+"px").style("height",k+"px").html(e.html)}if(e.width=i.node().offsetWidth,"center"!=e.anchor.y?e.height+=e.arrow_offset:e.width+=e.arrow_offset,e.data||!e.fullscreen&&e.html){if(e.fullscreen)var k=e.height;else var _=e.parent.node().offsetHeight,w=e.fixed?_-e.y-10:_-10,k=e.height<w?e.height:w;k-=parseFloat(n.style("padding-top"),10),k-=parseFloat(n.style("padding-bottom"),10),d&&(k-=d.node().offsetHeight,k-=parseFloat(d.style("padding-top"),10),k-=parseFloat(d.style("padding-bottom"),10)),b&&(k-=b.node().offsetHeight,k-=parseFloat(b.style("padding-top"),10),k-=parseFloat(b.style("padding-bottom"),10)),h.style("max-height",k+"px")
}e.height=i.node().offsetHeight,d3plus.tooltip.move(e.x,e.y,e.id)},d3plus.tooltip.data=function(e,t,a,l,s){function i(a,l){if(e.attrs.value[l])var s=l;else var s=null;l&&(l=e.format(l));var i=r[a]||d3plus.variable.value(e,t,a,s);if(i!==!1&&null!==i){var n=e.format(a),d=o.indexOf(a)>=0,p=e.format(i,a),c={name:n,value:p,highlight:d,group:l};e.descs.value[a]&&(c.desc=e.descs.value[a]),p&&u.push(c)}}if(e.small)return[];if(!a)var a="long";if("long"==a)var n="short";else var n="long";var r={};if(l&&"string"==typeof l)l=[l];else if(l&&"object"==typeof l){r=d3plus.util.merge(r,l);var l=[];for(k in r)l.push(k)}else if(!l)var l=[];var o=[];if(e.tooltip.value instanceof Array)var d=e.tooltip.value;else if("string"==typeof e.tooltip.value)var d=[e.tooltip.value];else{if(e.tooltip.value[e.id.nesting[s]])var d=e.tooltip.value[e.id.nesting[s]];else var d=e.tooltip.value;d instanceof Array||(d=d[a]?d[a]:d[n]?[]:d3plus.util.merge({"":[]},d)),"string"==typeof d?d=[d]:d instanceof Array||(d=d3plus.util.merge({"":[]},d))}var u=[];if(d instanceof Array)l.forEach(function(e){d.indexOf(e)<0&&d.push(e)}),d.forEach(function(e){i(e)});else{if(e.id.nesting.length&&s<e.id.nesting.length-1){var d=d3plus.util.copy(d);e.id.nesting.forEach(function(e,t){t>s&&d[e]&&delete d[e]})}if(e.tooltip.value.long&&"object"==typeof e.tooltip.value.long){var p=[];for(group in e.tooltip.value.long)l.forEach(function(t){e.tooltip.value.long[group].indexOf(t)>=0&&(d[group]&&d[group].indexOf(t)<0||!d[group])?(d[group]||(d[group]=[]),d[group].push(t),p.push(t)):d[group]&&d[group].indexOf(t)>=0&&p.push(t)});l.forEach(function(e){p.indexOf(e)<0&&(d[""]||(d[""]=[]),d[""].push(e))})}else{var c=[];for(group in d)l.forEach(function(e){d[group]instanceof Array&&d[group].indexOf(e)>=0?c.push(e):"string"==typeof d[group]&&d[group]==e&&c.push(e)});c.length!=l.length&&(d[""]||(d[""]=[]),l.forEach(function(e){c.indexOf(e)<0&&d[""].push(e)}))}d[""]&&(d[""].forEach(function(e){i(e,"")}),delete d[""]);for(group in d)d[group]instanceof Array?d[group].forEach(function(e){i(e,group)}):"string"==typeof d[group]&&i(d[group],group)}if("long"==a){var f=e.connections(t[e.id.key],!0);f.length&&f.forEach(function(t){var a=d3plus.variable.text(e,t)[0],l=d3plus.variable.color(e,t),s=e.style.tooltip.font.size,i="square"==e.shape.value?0:s;styles=["background-color: "+l,"border-color: "+d3plus.color.legible(l),"border-style: solid","border-width: "+e.style.data.stroke.width+"px","display: inline-block","height: "+s+"px","left: 0px","position: absolute","width: "+s+"px","top: 0px",d3plus.prefix()+"border-radius: "+i+"px"],node="<div style='"+styles.join("; ")+";'></div>",u.push({group:e.format("Primary Connections"),highlight:!1,name:"<div style='position:relative;padding-left:"+1.5*s+"px;'>"+node+a+"</div>",value:""})})}return u},d3plus.tooltip.move=function(e,t,a){if(a)var l=d3.select("div#d3plus_tooltip_id_"+a);else var l=d3.select("div#d3plus_tooltip_id_default");if(l.node()){var s=l.datum();s.cx=e,s.cy=t,s.fixed||("center"!=s.anchor.y?("right"==s.anchor.x?s.x=s.cx-s.arrow_offset-4:"center"==s.anchor.x?s.x=s.cx-s.width/2:"left"==s.anchor.x&&(s.x=s.cx-s.width+s.arrow_offset+2),"bottom"==s.anchor.y?s.flip=s.cy+s.height+s.offset<=s.limit[1]:"top"==s.anchor.y&&(s.flip=s.cy-s.height-s.offset<0),s.y=s.flip?s.cy+s.offset+s.arrow_offset:s.cy-s.height-s.offset-s.arrow_offset):(s.y=s.cy-s.height/2,"right"==s.anchor.x?s.flip=s.cx+s.width+s.offset<=s.limit[0]:"left"==s.anchor.x&&(s.flip=s.cx-s.width-s.offset<0),"center"==s.anchor.x?(s.flip=!1,s.x=s.cx-s.width/2):s.x=s.flip?s.cx+s.offset+s.arrow_offset:s.cx-s.width-s.offset),s.x<0?s.x=0:s.x+s.width>s.limit[0]&&(s.x=s.limit[0]-s.width),s.y<0?s.y=0:s.y+s.height>s.limit[1]&&(s.y=s.limit[1]-s.height)),l.style("top",s.y+"px").style("left",s.x+"px"),s.arrow&&l.selectAll(".d3plus_tooltip_arrow").call(d3plus.tooltip.arrow)}},d3plus.tooltip.remove=function(e){e?(d3.selectAll("div#d3plus_tooltip_curtain_"+e).remove(),d3.selectAll("div#d3plus_tooltip_id_"+e).remove()):(d3.selectAll("div#d3plus_tooltip_curtain").remove(),d3.selectAll("div.d3plus_tooltip").remove())},d3plus.ui.focus=function(e){if(!e.internal_error&&e.focus.value&&!e.small&&e.focus.tooltip.value){var t=e.data.pool.filter(function(t){return d3plus.variable.value(e,t,e.id.key)==e.focus.value});t.length>=1?t=t[0]:(t={},t[e.id.key]=e.focus.value);var a=e.style.labels.padding;d3plus.tooltip.app({anchor:"top left",arrow:!1,data:t,length:"long",fullscreen:!1,id:e.type.value+"_focus",maxheight:e.app_height-2*a,mouseevents:!0,offset:0,vars:e,x:e.width.value-e.margin.right-a,y:e.margin.top+a,width:e.style.tooltip.large}),d3.select("div#d3plus_tooltip_id_"+e.type.value+"_focus").empty()||(e.app_width-=e.style.tooltip.large+2*a)}else d3plus.tooltip.remove(e.type.value+"_focus")},d3plus.ui.history=function(e){function t(t){t.style("position","absolute").style("left",e.style.ui.padding+"px").style("top",e.margin.top/2-l/2+"px").style("color",s).style("font-family",i).style("font-weight",n).style("font-size",l+"px").style("z-index",2e3)}if(!e.small&&e.history.states.length>0){var a=e.parent.selectAll("div#d3plus_back_button").data(["d3plus_back_button"]),l=e.title.value?e.style.title.font.size:e.style.title.sub.font.size,s=e.title.sub.value?e.style.title.sub.font.color:e.style.title.font.color,i=e.title.sub.value?e.style.title.sub.font.family:e.style.title.font.family,n=e.title.sub.value?e.style.title.sub.font.weight:e.style.title.font.weight,r=e.title.sub.value?e.style.title.sub.padding:e.style.title.padding,o=l+2*r;e.margin.top<o&&(e.margin.top=o);{a.enter().append("div").attr("id","d3plus_back_button").style("opacity",0).call(t).html(function(){if(d3plus.font.awesome)var t="<span style='font-family:FontAwesome;margin-right:5px;'>&#xf104</span>";else var t="&laquo; ";return t+e.format("Back")})}a.on(d3plus.evt.over,function(){!e.small&&e.history.states.length>0&&d3.select(this).style("cursor","pointer").transition().duration(e.style.timing.mouseevents).style("color",d3plus.color.lighter(s))}).on(d3plus.evt.out,function(){!e.small&&e.history.states.length>0&&d3.select(this).style("cursor","auto").transition().duration(e.style.timing.mouseevents).style("color",s)}).on(d3plus.evt.click,function(){e.back()}).transition().duration(e.style.timing.transitions).style("opacity",1).call(t)}else e.parent.selectAll("div#d3plus_back_button").transition().duration(e.style.timing.transitions).style("opacity",0).remove()},d3plus.ui.legend=function(e){function t(t){t.attr("transform",function(t,a){var l=h+a*(e.style.ui.padding+s);return"translate("+l+","+e.style.ui.padding+")"})}function a(t){t.attr("width",s).attr("height",s).attr("fill",function(t){if(d3.select(this.parentNode).selectAll("text").remove(),t.icon){var a=d3plus.util.strip(t.icon+"_"+t.color),l=e.defs.selectAll("pattern#"+a).data([a]);if("string"==typeof e.icon.style.value)var i=e.icon.style.value;else if("object"==typeof e.icon.style.value&&e.icon.style.value[t.icon_depth])var i=e.icon.style.value[t.icon_depth];else var i="default";var n="knockout"==i?t.color:"none";l.select("rect").transition().duration(e.style.timing.transitions).attr("fill",n).attr("width",s).attr("height",s),l.select("image").transition().duration(e.style.timing.transitions).attr("width",s).attr("height",s);var r=l.enter().append("pattern").attr("id",a).attr("width",s).attr("height",s);return r.append("rect").attr("fill",n).attr("width",s).attr("height",s),r.append("image").attr("xlink:href",t.icon).attr("width",s).attr("height",s).each(function(){0==t.icon.indexOf("/")||t.icon.indexOf(window.location.hostname)>=0?d3plus.util.dataurl(t.icon,function(e){l.select("image").attr("xlink:href",e)}):l.select("image").attr("xlink:href",t.icon)}),"url(#"+a+")"}return d3.select(this.parentNode).append("text").attr("font-size",e.style.labels.font.size).attr("font-weight",e.style.font.weight).attr("font-family",e.style.font.family).attr("text-anchor","start").attr("fill",d3plus.color.text(t.color)).attr("x",0).attr("y",0).each(function(){1==t.name.length&&d3plus.util.wordwrap({text:t.name[0],parent:this,width:s-2*e.style.ui.padding,height:s-2*e.style.ui.padding,resize:e.labels.resize.value})}).attr("y",function(){var e=this.getBBox().height,t=parseFloat(d3.select(this).style("font-size"),10)/5;return s/2-e/2-t/2}).selectAll("tspan").attr("x",function(){var e=this.getComputedTextLength();return s/2-e/2}),t.color})}var l=!0,s=0,i=e.color.key||e.id.key;if(!e.small&&e.legend.value&&i){if(e.dev.value&&d3plus.console.group("Calculating Legend"),e.data.keys&&i in e.data.keys){e.data.keys[i]}else if(e.attrs.keys&&i in e.attrs.keys){e.attrs.keys[i]}else;if(e.color.scale)if(e.color.scale){e.dev.value&&d3plus.console.time("drawing color scale"),e.g.legend.selectAll("g.d3plus_color").transition().duration(e.style.timing.transitions).attr("opacity",0).remove();var n=e.color.scale.domain(),r=e.color.scale.range();n.length<=2&&(n=d3plus.util.buckets(n,6));var o=e.g.legend.selectAll("g.d3plus_scale").data(["scale"]);o.enter().append("g").attr("class","d3plus_scale").attr("opacity",0);var u=o.selectAll("#d3plus_legend_heatmap").data(["heatmap"]);u.enter().append("linearGradient").attr("id","d3plus_legend_heatmap").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");var p=u.selectAll("stop").data(d3.range(0,r.length));p.enter().append("stop").attr("stop-opacity",1),p.attr("offset",function(e){return Math.round(e/(r.length-1)*100)+"%"}).attr("stop-color",function(e){return r[e]}),p.exit().remove();var c=o.selectAll("rect#gradient").data(["gradient"]);c.enter().append("rect").attr("id","gradient").attr("x",function(){return"middle"==e.style.legend.align?e.width.value/2:"end"==e.style.legend.align?e.width.value:0}).attr("y",e.style.ui.padding).attr("width",0).attr("height",e.style.legend.gradient.height).attr("stroke",e.style.legend.tick.color).attr("stroke-width",1).style("fill","url(#d3plus_legend_heatmap)");var f=o.selectAll("text.d3plus_tick").data(d3.range(0,n.length));f.enter().append("text").attr("class","d3plus_tick").attr("x",function(){return"middle"==e.style.legend.align?e.width.value/2:"end"==e.style.legend.align?e.width.value:0}).attr("y",function(){return this.getBBox().height+e.style.legend.gradient.height+2*e.style.ui.padding});var v=0;f.order().attr("font-weight",e.style.legend.tick.weight).attr("font-family",e.style.legend.tick.family).attr("font-size",e.style.legend.tick.size).attr("text-anchor",e.style.legend.tick.align).attr("fill",e.style.legend.tick.color).text(function(t){return e.format(n[t],i)}).attr("y",function(){return this.getBBox().height+e.style.legend.gradient.height+2*e.style.ui.padding}).each(function(){var e=this.offsetWidth;e>v&&(v=e)}),v+=2*e.style.labels.padding;var g=v*(n.length-1);if(g+v<e.width.value){if(g+v<e.width.value/2&&(g=e.width.value/2,v=g/n.length,g-=v),"start"==e.style.legend.align)var h=e.style.ui.padding;else if("end"==e.style.legend.align)var h=e.width.value-e.style.ui.padding-g;else var h=e.width.value/2-g/2;f.transition().duration(e.style.timing.transitions).attr("x",function(e){return h+v*e}),f.exit().transition().duration(e.style.timing.transitions).attr("opacity",0).remove();var y=o.selectAll("rect.d3plus_tick").data(d3.range(0,n.length));y.enter().append("rect").attr("class","d3plus_tick").attr("x",function(){return"middle"==e.style.legend.align?e.width.value/2:"end"==e.style.legend.align?e.width.value:0}).attr("y",e.style.ui.padding).attr("width",0).attr("height",e.style.ui.padding+e.style.legend.gradient.height).attr("fill",e.style.legend.tick.color),y.transition().duration(e.style.timing.transitions).attr("x",function(e){var t=0==e?1:0;return h+v*e-t}).attr("y",e.style.ui.padding).attr("width",1).attr("height",e.style.ui.padding+e.style.legend.gradient.height).attr("fill",e.style.legend.tick.color),y.exit().transition().duration(e.style.timing.transitions).attr("width",0).remove(),c.transition().duration(e.style.timing.transitions).attr("x",function(){return"middle"==e.style.legend.align?e.width.value/2-g/2:"end"==e.style.legend.align?e.width.value-g-e.style.ui.padding:e.style.ui.padding}).attr("y",e.style.ui.padding).attr("width",g).attr("height",e.style.legend.gradient.height),o.transition().duration(e.style.timing.transitions).attr("opacity",1),e.dev.value&&d3plus.console.timeEnd("drawing color scale")}else l=!1}else l=!1;else{e.dev.value&&d3plus.console.time("determining color groups");var m={},x=[],b=e.nodes.restricted?e.nodes.restricted:e.nodes.value?e.nodes.value:e.data.pool;b.forEach(function(t){if(x.indexOf(t[e.id.key])<0){var a=d3plus.variable.color(e,t[e.id.key]);m[a]||(m[a]=[]),m[a].push(t),x.push(t[e.id.key])}}),e.dev.value&&d3plus.console.timeEnd("determining color groups"),e.dev.value&&d3plus.console.time("grouping colors");var r=[];for(color in m){var k={color:color,icon_depth:e.id.nesting[e.depth.value],name:[]};if(e.depth.value>0)for(var _=e.depth.value-1;_>=0;_--){var w=[];if(m[color].forEach(function(t){var a=d3plus.variable.value(e,t,e.id.nesting[_]);a&&w.indexOf(a)<0&&w.push(a)}),1==w.length){var z=d3plus.variable.text(e,w[0],_);if(z&&k.name.indexOf(z)<0&&k.name.push(z),!k.icon){var A=d3plus.variable.value(e,w[0],e.icon.key,e.id.nesting[_]);A&&(k.icon=A,k.icon_depth=e.id.nesting[_])}}if(k.name.length>0&&k.icon)break}else for(d in m[color]){var z=d3plus.variable.text(e,m[color][d],e.depth.value);if(z&&k.name.indexOf(z)<0&&k.name.push(z),!k.icon){var A=d3plus.variable.value(e,m[color][d],e.icon.key);A&&(k.icon=A)}if(k.name.length>0&&k.icon)break}k.name.sort(),r.push(k)}e.dev.value&&d3plus.console.timeEnd("grouping colors");var E=e.width.value;s=e.style.legend.size;var g=s*r.length+e.style.ui.padding*(r.length+1);if(s instanceof Array){e.dev.value&&d3plus.console.time("calculating size");for(var _=s[1];_>=s[0];_--)if(g=_*r.length+e.style.ui.padding*(r.length+1),E>=g){s=_;break}e.dev.value&&d3plus.console.timeEnd("calculating size")}else"number"!=typeof s&&s!==!1&&(s=30);if(g>E||1==r.length)l=!1;else{g-=2*e.style.ui.padding,e.dev.value&&d3plus.console.time("sorting colors");var O=e.legend.order.sort.value;if(r.sort(function(t,a){if("color"==e.legend.order.value){var l=t.color,s=a.color;l=d3.rgb(l).hsl(),s=d3.rgb(s).hsl(),l=0==l.s?361:l.h,s=0==s.s?361:s.h}else if("alpha"==e.legend.order.value)var l=t.name[0],s=a.name[0];return s>l?"asc"==O?-1:1:l>s?"asc"==O?1:-1:void 0}),e.dev.value&&d3plus.console.timeEnd("sorting colors"),"start"==e.style.legend.align)var h=e.style.ui.padding;else if("end"==e.style.legend.align)var h=E-e.style.ui.padding-g;else var h=E/2-g/2;e.g.legend.selectAll("g.d3plus_scale").transition().duration(e.style.timing.transitions).attr("opacity",0).remove();var B=e.g.legend.selectAll("g.d3plus_color").data(r,function(e){return e.url?e.color+"_"+e.url:e.color}),j=B.enter().append("g").attr("class","d3plus_color").attr("opacity",0).call(t);j.append("rect").attr("class","d3plus_color").call(a),d3plus.touch||B.on(d3plus.evt.over,function(t,a){if(d3.select(this).style("cursor","pointer"),t.name.length){d3.select(this).style("cursor","pointer");var l=h+a*(e.style.ui.padding+s),i=d3.transform(d3.select(this.parentNode).attr("transform")).translate[1];if(l+=s/2,i+=e.style.ui.padding+s/2,"string"==typeof e.icon.style.value)var n=e.icon.style.value;else if("object"==typeof e.icon.style.value&&e.icon.style.value[t.icon_depth])var n=e.icon.style.value[t.icon_depth];else var n="default";var r=[];if(t.name.forEach(function(e){r.push(e instanceof Array?e[0]:e)}),1==r.length)var o=r[0],d=null;else{var o=null;if(r.length>4){var u=r.length-4;r=r.slice(0,4),r[4]=e.format(u+" more")}if(2==r.length)var d=r.join(" "+e.format("and")+" ");else{r[r.length-1]=e.format("and")+" "+r[r.length-1];var d=r.join(", ")}}d3plus.tooltip.create({align:"top center",arrow:!0,background:e.style.tooltip.background,description:d,fontcolor:e.style.tooltip.font.color,fontfamily:e.style.tooltip.font.family,fontweight:e.style.tooltip.font.weight,color:t.color,icon:t.icon,id:"legend",offset:s/2-e.style.ui.padding,parent:e.parent,style:n,title:o,x:l,y:i,max_width:200,width:"auto"})}}).on(d3plus.evt.out,function(){d3plus.tooltip.remove("legend")}),B.order().transition().duration(e.style.timing.transitions).attr("opacity",1).call(t),B.selectAll("rect.d3plus_color").transition().duration(e.style.timing.transitions).call(a),B.exit().transition().duration(e.style.timing.transitions).attr("opacity",0).remove()}}}else l=!1;if(e.legend.value&&i&&l){if(e.dev.value&&d3plus.console.time("positioning legend"),s)var N=s;else var M=e.g.legend.node().getBBox(),N=M.height+M.y;e.g.timeline.node().getBBox().height||(e.margin.bottom+=e.style.ui.padding),e.margin.bottom+=N+e.style.ui.padding,e.g.legend.transition().duration(e.style.timing.transitions).attr("transform","translate(0,"+(e.height.value-e.margin.bottom)+")"),e.dev.value&&d3plus.console.timeEnd("positioning legend")}else e.dev.value&&d3plus.console.time("hiding legend"),e.g.legend.transition().duration(e.style.timing.transitions).attr("transform","translate(0,"+e.height.value+")"),e.dev.value&&d3plus.console.timeEnd("hiding legend");e.legend.value&&i&&e.dev.value&&d3plus.console.groupEnd()},d3plus.ui.message=function(e,t){function a(t){t.style(s).style("position","absolute").style("background",n).style("text-align","center").style("left",function(){return"center"==i?"50%":"0px"}).style("width",function(){return"center"==i?"auto":e.width.value+"px"}).style("margin-left",function(){var t=e.width.value-e.app_width;return"center"==i?-(this.offsetWidth/2+t/2)+"px":"0px"}).style("top",function(){return"center"==i?"50%":"top"==i?"0px":"auto"}).style("bottom",function(){return"bottom"==i?"0px":"auto"}).style("margin-top",function(){if("large"==l){var e=this.offsetHeight;return-e/2+"px"}return"0px"})}var t=e.messages.value?t:null,l=t==e.internal_error?"large":e.messages.style;if("large"==l)var s=e.style.message,i="center";else{if(e.footer.value)var s=e.style.footer;else if(e.title.value)var s=e.style.title;else if(e.title.sub.value)var s=e.style.title.sub;else if(e.title.total.value)var s=e.style.title.total;else var s=e.style.title.sub;var i=s.position}var s={color:s.font.color,"font-family":s.font.family,"font-weight":s.font.weight,"font-size":s.font.size+"px",padding:s.padding+"px"},n="none"!=e.style.background?e.style.background:"white";e.g.message=e.parent.selectAll("div#d3plus_message").data(["message"]),e.g.message.enter().append("div").attr("id","d3plus_message").attr("opacity",0);var r=t?1:0,o=t?t:e.g.message.text(),d=t?"inline-block":"none";e.g.message.text(o).call(a).style("opacity",r).style("display",d)},d3plus.ui.timeline=function(e){var t=e.data.time;if(!e.small&&t&&t.length>1&&e.timeline.value){if(e.time.key==e.x.key&&"continuous"==e.x.scale.value||e.time.key==e.y.key&&"continuous"==e.y.scale.value)var a=2;else var a=1;if(e.time.solo.value.length)var l=d3.extent(e.time.solo.value);else var l=d3.extent(t);var s=t[0],i=t[t.length-1],n=l[0],r=l[1],o=[],d=[];t.forEach(function(e,a){0!=a&&d.push(e-t[a-1])});{var u=d3.min(d);u*t.length}t=[];for(var p=s;i>=p;p+=u)t.push(p),o.push(d3.time.year(new Date(parseInt(p),0,1)));o.push(d3.time.year(new Date(parseInt(i+u),0,1)));var c=function(){if(null!==d3.event.sourceEvent){var l=E.extent(),s=d3plus.util.closest(o,d3.time.year.round(l[0])),i=d3plus.util.closest(o,d3.time.year.round(l[1]));s==i&&(s=d3plus.util.closest(o,d3.time.year.floor(l[0])));var n=o.indexOf(s),r=o.indexOf(i);if(r-n>=a)var d=[s,i];else if(n+a<=t.length)var d=[s,o[n+a]];else{for(var d=[s],u=1;a>=u;u++)n+u<=t.length?d.push(o[n+u]):d.unshift(o[n-(n+u-t.length)]);d=[d[0],d[d.length-1]]}d3.select(this).transition().call(E.extent(d)).each("end",function(){var a=d3.range(d[0].getFullYear(),d[1].getFullYear());a=a.filter(function(e){return t.indexOf(e)>=0}),e.viz.time({solo:a}).draw()})}},f=e.g.timeline.selectAll("rect.d3plus_timeline_background").data(["background"]);f.enter().append("rect").attr("class","d3plus_timeline_background");var v=e.g.timeline.selectAll("g#ticks").data(["ticks"]);v.enter().append("g").attr("id","ticks").attr("transform","translate("+e.width.value/2+","+e.style.ui.padding+")");var g=e.g.timeline.selectAll("g#brush").data(["brush"]);g.enter().append("g").attr("id","brush");var h=e.g.timeline.selectAll("g#labels").data(["labels"]);h.enter().append("g").attr("id","labels");var y=h.selectAll("text").data(t,function(e,t){return t});y.enter().append("text").attr("y",0).attr("dy",0).attr("x",function(){return"middle"==e.style.timeline.align?e.width.value/2:"end"==e.style.timeline.align?e.width.value:0}).attr("y",function(){var t=t=parseFloat(d3.select(this).style("font-size"),10)/5,a=e.style.ui.padding+e.style.timeline.height/2+this.getBBox().height/2-t;return a});var m=0,x=0,b=e.style.timeline.height+e.style.ui.padding;y.order().attr("font-weight",e.style.timeline.tick.weight).attr("font-family",e.style.timeline.tick.family).attr("font-size",e.style.timeline.tick.size).attr("text-anchor",e.style.timeline.tick.align).attr("opacity",0).text(function(e){return e}).each(function(){var e=this.getBBox().width,t=this.getBBox().height;e>m&&(m=e),t>x&&(x=t)});var k=m+2*e.style.ui.padding,_=k*t.length,w=e.width.value-2*e.style.ui.padding,u=1;if(_>w){for(_=w,u=Math.ceil(k/(_/t.length)),k=_/t.length,u;u<t.length-1&&(t.length-1)%u!=0;u++);b+=x}if("start"==e.style.timeline.align)var z=e.style.ui.padding;else if("end"==e.style.timeline.align)var z=e.width.value-e.style.ui.padding-_;else var z=e.width.value/2-_/2;y.text(function(e,t){return t%u==0?e:""}).attr("opacity",1),y.transition().duration(e.style.timing.transitions).attr("fill",function(t){if(t>=l[0]&&t<=l[1]){var a=e.style.timeline.background,s=e.style.timeline.brush.color,i=e.style.timeline.brush.opacity;return mixed=d3plus.color.mix(s,a,i),d3plus.color.text(mixed)}return d3plus.color.text(e.style.timeline.background)}).attr("x",function(e,t){return z+k*t+k/2}).attr("y",function(){var t=t=parseFloat(d3.select(this).style("font-size"),10)/5,a=e.style.ui.padding+e.style.timeline.height/2+this.getBBox().height/2-t;return u>1&&(a+=x+e.style.ui.padding),a}),y.exit().transition().duration(e.style.timing.transitions).attr("opacity",0).remove(),f.transition().duration(e.style.timing.transitions).attr("width",_).attr("height",e.style.timeline.height).attr("x",z).attr("y",e.style.ui.padding).attr("fill",e.style.timeline.background);var A=d3.time.scale().domain(d3.extent(o)).range([0,_]),E=d3.svg.brush().x(A).extent([o[t.indexOf(n)],o[t.indexOf(r)+1]]).on("brushend",c);v.transition().duration(e.style.timing.transitions).attr("transform","translate("+z+","+e.style.ui.padding+")").call(d3.svg.axis().scale(A).orient("top").ticks(function(){return o}).tickFormat("").tickSize(-e.style.timeline.height).tickPadding(0)).selectAll("path").attr("fill","none"),v.selectAll("line").transition().duration(e.style.timing.transitions).attr("stroke",e.style.timeline.tick.color).attr("shape-rendering",e.style.rendering),g.attr("transform","translate("+z+","+e.style.ui.padding+")").attr("opacity",1).call(E),y.attr("pointer-events","none"),g.selectAll("rect.background, rect.extent").attr("height",e.style.timeline.height),g.selectAll("rect.background").transition().duration(e.style.timing.transitions).attr("stroke",e.style.timeline.tick.color).attr("stroke-width",1).style("visibility","visible").attr("fill","none").attr("shape-rendering",e.style.rendering),g.selectAll("rect.extent").transition().duration(e.style.timing.transitions).attr("fill",e.style.timeline.brush.color).attr("fill-opacity",e.style.timeline.brush.opacity).attr("stroke",e.style.timeline.tick.color).attr("stroke-width",1).attr("shape-rendering",e.style.rendering),e.timeline.handles.value?g.selectAll("g.resize").select("rect").attr("fill",e.style.timeline.handles.color).attr("stroke",e.style.timeline.handles.stroke).attr("stroke-width",1).attr("x",-e.style.timeline.handles.size/2).attr("width",e.style.timeline.handles.size).attr("height",e.style.timeline.height).style("visibility","visible").attr("shape-rendering",e.style.rendering).attr("opacity",e.style.timeline.handles.opacity):g.selectAll("g.resize").remove(),e.style.timeline.handles.opacity&&g.selectAll("g.resize").on(d3plus.evt.over,function(){d3.select(this).select("rect").transition().duration(e.style.timing.mouseevents).attr("fill",e.style.timeline.handles.hover)}).on(d3plus.evt.out,function(){d3.select(this).select("rect").transition().duration(e.style.timing.mouseevents).attr("fill",e.style.timeline.handles.color)}),e.margin.bottom+=2*e.style.ui.padding+b,e.g.timeline.transition().duration(e.style.timing.transitions).attr("transform","translate(0,"+(e.height.value-e.margin.bottom)+")")}else e.g.timeline.transition().duration(e.style.timing.transitions).attr("transform","translate(0,"+e.height.value+")")},d3plus.ui.titles=function(e){function t(t){t.attr("text-anchor",function(e){var t=e.style.font.align;return"center"==t?"middle":"left"==t&&!d3plus.rtl||"right"==t&&d3plus.rtl?"start":"left"==t&&d3plus.rtl||"right"==t&&!d3plus.rtl?"end":void 0}).attr("x",function(t){var a=t.style.font.align;return"center"==a?e.width.value/2:"left"==a&&!d3plus.rtl||"right"==a&&d3plus.rtl?e.style.padding:"left"==a&&d3plus.rtl||"right"==a&&!d3plus.rtl?e.width.value-e.style.padding:void 0}).attr("y",0)}function a(t){t.attr("font-size",function(e){return e.style.font.size}).attr("fill",function(t){return t.link?e.style.link.font.color:t.style.font.color}).attr("font-family",function(t){return t.link?e.style.link.font.family:t.style.font.family}).attr("font-weight",function(t){return t.link?e.style.link.font.weight:t.style.font.weight}).style("text-decoration",function(t){return t.link?e.style.link.font.decoration:t.style.font.decoration}).style("text-transform",function(t){return t.link?e.style.link.font.transform:t.style.font.transform})}if(e.data.app&&e.title.total.value&&!e.small){e.dev.value&&(d3plus.console.group("Calculating Total Value"),d3plus.console.time(e.size.key));var l=e.size.key?e.size.key:"number"==e.color.type?e.color.key:null;if(e.focus.value){var s=e.data.app.filter(function(t){return t[e.id.key]==e.focus.value});s=d3.sum(s,function(t){return d3plus.variable.value(e,t,l)})}else if(l)var s=d3.sum(e.data.pool,function(t){return d3plus.variable.value(e,t,l)});if(0===s&&(s=!1),"number"==typeof s){var i="";if(e.mute.length||e.solo.length||e.focus.value){var n=d3.sum(e.data.filtered.all,function(t){if(e.time.solo.value.length>0)var a=e.time.solo.value.indexOf(d3plus.variable.value(e,t,e.time.key))>=0;else if(e.time.mute.value.length>0)var a=e.time.solo.value.indexOf(d3plus.variable.value(e,t,e.time.key))<0;else var a=!0;return a?d3plus.variable.value(e,t,l):void 0});if(n>s)var i=s/n*100,r=e.format(n,e.size.key),i=" ("+e.format(i,"share")+"% of "+r+")"}s=e.format(s,e.size.key);var o=e.title.total.value,d=o.prefix||e.format("Total")+": ";s=d+s,o.suffix?s+=o.suffix:null,s+=i}e.dev.value&&(d3plus.console.timeEnd(e.size.key),d3plus.console.groupEnd())}else var s=null;var u=[];e.footer.value&&u.push({link:e.footer.link,style:e.style.footer,type:"footer",value:e.footer.value}),e.small||(e.title.value&&u.push({link:e.title.link,style:e.style.title,type:"title",value:e.title.value}),e.title.sub.value&&u.push({link:e.title.sub.link,style:e.style.title.sub,type:"sub",value:e.title.sub.value}),e.title.total.value&&s&&u.push({link:e.title.total.link,style:e.style.title.total,type:"total",value:s})),e.dev.value&&d3plus.console.log("Drawing Titles");var p=e.svg.selectAll("g.d3plus_title").data(u,function(e){return e.type}),c=e.style.title.width||e.width.value;p.enter().append("g").attr("class","d3plus_title").attr("opacity",0).attr("transform",function(t){var a="top"==t.style.position?0:e.height.value;return"translate(0,"+a+")"}).append("text").call(t).call(a),p.each(function(t){d3plus.util.wordwrap({text:t.value,parent:d3.select(this).select("text").node(),width:c,height:e.height.value/8,resize:!1}),t.y=e.margin[t.style.position],e.margin[t.style.position]+=this.getBBox().height+2*t.style.padding}).on(d3plus.evt.over,function(t){t.link&&d3.select(this).transition().duration(e.style.timing.mouseevents).style("cursor","pointer").select("text").attr("fill",e.style.link.hover.font.color).attr("font-family",e.style.link.hover.font.family).attr("font-weight",e.style.link.hover.font.weight).style("text-decoration",e.style.link.hover.font.decoration).style("text-transform",e.style.link.hover.font.transform)}).on(d3plus.evt.out,function(t){t.link&&d3.select(this).transition().duration(e.style.timing.mouseevents).style("cursor","auto").select("text").call(a)}).on(d3plus.evt.click,function(e){if(e.link){var t="/"!=e.link.charAt(0)?"_blank":"_self";window.open(e.link,t)}}).transition().duration(e.timing).attr("opacity",1).attr("transform",function(t){var a=t.style.position,l="top"==a?0+t.y:e.height.value-t.y;return"bottom"==a?l-=this.getBBox().height+t.style.padding:l+=t.style.padding,"translate(0,"+l+")"}).select("text").call(t).call(a),p.exit().transition().duration(e.timing).attr("opacity",0).remove();var f=e.style.title.height;f&&e.margin[e.style.title.position]<f&&(e.margin[e.style.title.position]=f)},d3plus.util.buckets=function(e,t){for(var a=[],l=1/(t-1)*(e[1]-e[0]),s=l,s=e[0];s<=e[1];s+=l)a.push(s);return a.length<t&&(a[t-1]=e[1]),a[a.length-1]<e[1]&&(a[a.length-1]=e[1]),a},d3plus.util.child=function(e,t){if(!e||!t)return!1;d3plus.util.d3selection(e)&&(e=e.node()),d3plus.util.d3selection(e)&&(t=t.node());for(var a=t.parentNode;null!=a;){if(a==e)return!0;a=a.parentNode}return!1},d3plus.util.closest=function(e,t){var a=e[0];return e.forEach(function(e){Math.abs(t-e)<Math.abs(t-a)&&(a=e)}),a},d3plus.util.copy=function(e){return d3plus.util.merge(e)},d3plus.util.d3selection=function(e){return d3plus.ie?"object"==typeof e&&e instanceof Array:e instanceof d3.selection},d3plus.util.dataurl=function(e,t){var a=new Image;a.src=e,a.crossOrigin="Anonymous",a.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var a=e.getContext("2d");a.drawImage(this,0,0),t.call(this,e.toDataURL("image/png")),e=null}},d3plus.util.distances=function(e,t){var a=[],l=[];return e.forEach(function(s){var i=t?t(s):[s.x,s.y];l.push(s),e.forEach(function(e){if(l.indexOf(e)<0){var s=t?t(e):[e.x,e.y],n=Math.abs(i[0]-s[0]),r=Math.abs(i[1]-s[1]);a.push(Math.sqrt(n*n+r*r))}})}),a.sort(function(e,t){return e-t}),a},d3plus.util.merge=function(e,t){function a(e,t){for(var l in e)"undefined"!=typeof e[l]&&("object"!=typeof e[l]||e[l]instanceof Array||null===e[l]?t[l]=e[l]instanceof Array?e[l].slice(0):e[l]:("object"!=typeof t[l]&&(t[l]={}),a(e[l],t[l])))}var l={};return e&&a(e,l),t&&a(t,l),l},d3plus.util.offset=function(e,t,a){var l={x:0,y:0};if(0>e&&(e=2*Math.PI+e),"square"==a){var s=45*(Math.PI/180);if(e<=Math.PI)if(e<Math.PI/2)if(s>e){l.x+=t;var i=Math.tan(e)*t;l.y+=i}else{l.y+=t;var n=t/Math.tan(e);l.x+=n}else if(e<Math.PI-s){l.y+=t;var n=t/Math.tan(Math.PI-e);l.x-=n}else{l.x-=t;var i=Math.tan(Math.PI-e)*t;l.y+=i}else if(e<3*Math.PI/2)if(e<s+Math.PI){l.x-=t;var i=Math.tan(e-Math.PI)*t;l.y-=i}else{l.y-=t;var n=t/Math.tan(e-Math.PI);l.x-=n}else if(e<2*Math.PI-s){l.y-=t;var n=t/Math.tan(2*Math.PI-e);l.x+=n}else{l.x+=t;var i=Math.tan(2*Math.PI-e)*t;l.y-=i}}else l.x+=t*Math.cos(e),l.y+=t*Math.sin(e);return l},d3plus.util.strip=function(e){var t=["!","@","#","$","%","^","&","*","(",")","[","]","{","}",".",",","/","\\","|","'",'"',";",":","<",">","?","=","+"];return e.replace(/[^A-Za-z0-9\-_]/g,function(e){if(" "==e)return"_";if(t.indexOf(e)>=0)return"";var a=[[/[\300-\306]/g,"A"],[/[\340-\346]/g,"a"],[/[\310-\313]/g,"E"],[/[\350-\353]/g,"e"],[/[\314-\317]/g,"I"],[/[\354-\357]/g,"i"],[/[\322-\330]/g,"O"],[/[\362-\370]/g,"o"],[/[\331-\334]/g,"U"],[/[\371-\374]/g,"u"],[/[\321]/g,"N"],[/[\361]/g,"n"],[/[\307]/g,"C"],[/[\347]/g,"c"]],l="";for(d in a)if(a[d][0].test(e)){l=a[d][1];break}return l})},d3plus.util.uniques=function(e,t){var a=null;return d3.nest().key(function(e){return"string"==typeof t?(a||"undefined"==typeof e[t]||(a=typeof e[t]),e[t]):"function"==typeof t?(a||"undefined"==typeof t(e)||(a=typeof t(e)),t(e)):e
}).entries(e).reduce(function(e,t){if(a){var l=t.key;return"number"==a&&(l=parseFloat(l)),e.concat(l)}return e},[]).sort(function(e,t){return e-t})},d3plus.util.wordwrap=function(e){function t(){function e(){d3.select(l).selectAll("tspan").remove();for(var e=l.getAttribute("x"),t=d3.select(l).append("tspan").attr("x",e).text(v[0]),a=1;a<v.length;a++){var i=t.text(),n=(i.slice(-1),c.charAt(c.indexOf(i)+i.length));joiner=" "==n?" ":"",t.text(i+joiner+v[a]),t.node().getComputedTextLength()>s&&(t.text(i),t=d3.select(l).append("tspan").attr("x",e).text(v[a]))}}function f(){function e(){if(v.length){var t=v[v.length-1],a=t.charAt(t.length-1);1==t.length&&u.indexOf(t)>=0?(v.pop(),e()):(u.indexOf(a)>=0&&(t=t.substr(0,t.length-1)),d3.select(tspan).text(v.join(" ")+"..."),tspan.getComputedTextLength()>s&&(v.pop(),e()))}else d3.select(tspan).remove()}for(var t=!1;l.childNodes.length*l.getBBox().height>i&&l.lastChild&&!t;)l.removeChild(l.lastChild),l.childNodes.length*l.getBBox().height<i&&l.lastChild&&(t=!0);t&&(tspan=l.lastChild,v=d3.select(tspan).text().match(/[^\s-]+-?/g),e())}var v=c.match(p);if(n){var g=r;g=Math.floor(g),d3.select(l).attr("font-size",g),d3.select(l).selectAll("tspan").remove();for(var h=0;h<v.length;h++){if(1==v.length)var y=v[h];else var y=v[h]+"...";d3.select(l).append("tspan").attr("x",0).text(y)}if(l.getBBox().width>s&&(g*=s/l.getBBox().width),o>g){if(d3.select(l).selectAll("tspan").remove(),"string"==typeof d||0==d.length)return;return c=String(d.shift()),void t()}if(g=Math.floor(g),d3.select(l).attr("font-size",g),e(),l.childNodes.length*l.getBBox().height>i){var m=g*(i/(l.childNodes.length*l.getBBox().height));g=o>m?o:m,g=Math.floor(g),d3.select(l).attr("font-size",g)}else a()}e(),f(),a()}function a(){d3.select(l).selectAll("tspan").attr("dy",d3.select(l).style("font-size"))}var l=e.parent,s=e.width?e.width:2e4,i=e.height?e.height:2e4,n=e.resize,r=e.font_max?e.font_max:40,o=e.font_min?e.font_min:9,d=e.text,u=["-","/",";",":","&"],p=new RegExp("[^\\s\\"+u.join("\\")+"]+\\"+u.join("?\\")+"?","g"),c="";d3.select(l).attr("font-size")||d3.select(l).attr("font-size",o),d instanceof Array?(d=d.filter(function(e){return["string","number"].indexOf(typeof e)>=0}),c=String(d.shift())):c=String(d),t()},d3plus.variable.color=function(e,t,a){function l(t){return"object"==typeof t&&(t=t[e.id.key]),d3plus.color.random(t)}function s(e){return"string"==typeof e&&0==e.indexOf("#")&&[4,7].indexOf(e.length)>=0?!0:!1}if(e.color.key){var i=d3plus.variable.value(e,t,e.color.key,a);if(i){if(e.color.scale)return e.color.scale(i);var n=s(i);return n?i:l(i)}return"function"==typeof e.color.scale?e.style.color.missing:l(t)}return l(t)},d3plus.variable.text=function(e,t,a){if("number"!=typeof a)var a=e.depth.value;if(e.text.array&&"object"==typeof e.text.array)if(e.text.array[e.id.nesting[a]])var l=e.text.array[e.id.nesting[a]];else var l=e.text.array[Object.keys(e.text.array)[0]];else{var l=[];e.text.key&&l.push(e.text.key),l.push(e.id.nesting[a])}"string"==typeof l&&(l=[l]);var s=[];return l.forEach(function(l){var i=d3plus.variable.value(e,t,l,e.id.nesting[a]);i&&s.push(e.format(i))}),s},d3plus.variable.value=function(e,t,a,l,s){function i(e){return e.filter(function(e){return e[l]==t})[0]}function n(e){e.children?e.children.forEach(function(e){n(e)}):e[a]&&r.push(e[a])}if(!l)if(a&&"object"==typeof a){if(a[e.id.key])var l=e.id.key;else var l=Object.keys(a)[0];a=a[l]}else var l=e.id.key;if(a&&"function"==typeof a)return a(t);var r=[];if("object"==typeof t&&"undefined"!=typeof t[a])return t[a];if("object"==typeof t&&t.children){if(!s){var s="sum";"string"==typeof e.aggs.value?s=e.aggs.value:e.aggs.value[a]&&(s=e.aggs.value[a])}if(n(t),r.length){if("string"==typeof s)return d3[s](r);if("function"==typeof s)return s(r)}var o=t;t=o[l]}else{if("object"==typeof t){var o=t;t=t[l]}if(e.data.app instanceof Array)var o=i(e.data.app);if(o&&"undefined"!=typeof o[a])return o[a]}if(e.attrs.value instanceof Array)var d=i(e.attrs.value);else if(e.attrs.value[l])if(e.attrs.value[l]instanceof Array)var d=i(e.attrs.value[l]);else var d=e.attrs.value[l][t];else var d=e.attrs.value[t];return d&&"undefined"!=typeof d[a]?d[a]:null},d3plus.zoom.bounds=function(e,t,a){if(!t)var t=e.zoom.bounds;if("number"!=typeof a)var a=e.style.timing.transitions;e.zoom.size={height:t[1][1]-t[0][1],width:t[1][0]-t[0][0]};var l=e.coords.fit.value;if("auto"==l||d3plus.apps[e.type.value].requirements.indexOf("coords")<0)var s=d3.max([e.zoom.size.width/e.app_width,e.zoom.size.height/e.app_height]);else var s=e.zoom.size[l]/e["app_"+l];var i=d3.min([e.app_width,e.app_height]),n=(i-2*e.coords.padding)/i/s,r=e.zoom_behavior.scaleExtent();(r[0]==r[1]||t==e.zoom.bounds)&&e.zoom_behavior.scaleExtent([n,16*n]);var o=e.zoom_behavior.scaleExtent()[1];n>o&&(n=o),e.zoom.scale=n;var d=[];d[0]=e.app_width/2-e.zoom.size.width*n/2-t[0][0]*n,d[1]=e.app_height/2-e.zoom.size.height*n/2-t[0][1]*n,e.zoom.translate=d,e.zoom_behavior.translate(d).scale(n),e.zoom.size={height:e.zoom.bounds[1][1]-e.zoom.bounds[0][1],width:e.zoom.bounds[1][0]-e.zoom.bounds[0][0]},d3plus.zoom.transform(e,a)},d3plus.zoom.controls=function(){if(d3.select("#d3plus.utilsts.zoom_controls").remove(),!vars.small){var e=vars.parent.append("div").attr("id","d3plus.utilsts.zoom_controls").style("top",vars.margin.top+5+"px");e.append("div").attr("id","zoom_in").attr("unselectable","on").on(d3plus.evt.click,function(){vars.zoom("in")}).text("+"),e.append("div").attr("id","zoom_out").attr("unselectable","on").on(d3plus.evt.click,function(){vars.zoom("out")}).text("-"),e.append("div").attr("id","zoom_reset").attr("unselectable","on").on(d3plus.evt.click,function(){vars.zoom("reset"),vars.update()}).html("&#8634;")}},d3plus.zoom.labels=function(e){var t=e.zoom_behavior.scaleExtent()[1];e.dev.value&&d3plus.console.time("determining label visibility"),e.timing?e.g.viz.selectAll("text.d3plus_label").transition().duration(e.timing).attr("opacity",function(a){if(!a)var a={scale:t};var l=parseFloat(d3.select(this).attr("font-size"),10);return a.visible=l/a.scale*e.zoom.scale>=7,a.visible?1:0}):e.g.viz.selectAll("text.d3plus_label").attr("opacity",function(a){if(!a)var a={scale:t};var l=parseFloat(d3.select(this).attr("font-size"),10);return a.visible=l/a.scale*e.zoom.scale>=7,a.visible?1:0}),e.dev.value&&d3plus.console.timeEnd("determining label visibility")},d3plus.zoom.mouse=function(e){var t=d3.event.translate,a=d3.event.scale,l=e.zoom.bounds,s=(e.app_width-e.zoom.size.width*a)/2,i=s>0?s:0,n=s>0?e.app_width-s:e.app_width,r=(e.app_height-e.zoom.size.height*a)/2,o=r>0?r:0,d=r>0?e.app_height-r:e.app_height;if(t[0]+l[0][0]*a>i?t[0]=-l[0][0]*a+i:t[0]+l[1][0]*a<n&&(t[0]=n-l[1][0]*a),t[1]+l[0][1]*a>o?t[1]=-l[0][1]*a+o:t[1]+l[1][1]*a<d&&(t[1]=d-l[1][1]*a),e.zoom_behavior.translate(t).scale(a),e.zoom.translate=t,e.zoom.scale=a,"wheel"==d3.event.sourceEvent.type){var u=e.timing?100:500;clearTimeout(e.zoom.wheel),e.zoom.wheel=setTimeout(function(){d3plus.zoom.labels(e)},u)}else d3plus.zoom.labels(e);"dblclick"==d3.event.sourceEvent.type?d3plus.zoom.transform(e,e.style.timing.transitions):d3plus.zoom.transform(e,0)},d3plus.zoom.transform=function(e,t){if("number"!=typeof t)var t=e.timing;var a=e.zoom.translate,l=e.zoom.scale;t?e.g.viz.transition().duration(t).attr("transform","translate("+a+")scale("+l+")"):e.g.viz.attr("transform","translate("+a+")scale("+l+")")};